/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};const r=require("express");var e=t.n(r);const n=require("cors");var o=t.n(n);const i=require("helmet");var a=t.n(i);require("morgan");require("fs");const u=require("path");var c=t.n(u);const s=require("express-session");var l=t.n(s);const f=require("dotenv");var h=process.env,p=h.REDIS_PORT,d=void 0===p?6379:p,v=h.REDIS_HOST,y=void 0===v?"localhost":v,g=h.REDIS_PASSWORD,m={port:+d,host:y,password:void 0===g?"secret":g},b=process.env,w=b.POSTGRESQL_USER,x=void 0===w?"admin":w,O=b.POSTGRESQL_PASSWORD,j=void 0===O?"admin":O,L=b.POSTGRESQL_PORT,E=void 0===L?"5432":L,S=b.POSTGRESQL_HOST,P=void 0===S?"localhost":S,k=process.env.DATABASE_URL,_=(void 0===k&&"postgres://".concat(x,":").concat(j,"@").concat(P,":").concat(E),process.env),T=_.SESSION_SECRET,N=void 0===T?"secret":T,G=_.SESSION_NAME,I=void 0===G?"sid":G,R=_.SESSION_TIMEOUT,C={secret:N,name:I,cookie:{maxAge:+(void 0===R?216e5:R),secure:!0},resave:!1,saveUninitialized:!1,rolling:!0},F=process.env,U=F.PORT;(0,f.config)();const D=require("ioredis");var q=t.n(D);const A=require("connect-redis");var B=t.n(A);function Y(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const z=function(){function t(){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.RedisStore=B()(l()),this.redisClient=new(q())(m),this.redisClient.on("error",(function(t){throw console.log(t),"Error connecting with redis client"}))}var r,e,n;return r=t,(e=[{key:"redisStore",get:function(){return new this.RedisStore({client:this.redisClient})}}])&&Y(r.prototype,e),n&&Y(r,n),Object.defineProperty(r,"prototype",{writable:!1}),t}(),M=require("joi");var H=t.n(M);const W=require("bcryptjs"),Q=require("bcrypt");const $=new(require("@prisma/client").PrismaClient);function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function K(){K=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new j(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return E()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=w(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(L([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function b(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==J(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function w(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,w(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function O(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(b.prototype),u(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new b(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=L,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;O(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:L(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function V(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function X(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){V(i,n,o,a,u,"next",t)}function u(t){V(i,n,o,a,u,"throw",t)}a(void 0)}))}}function Z(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tt(t,r,e){return r&&Z(t.prototype,r),e&&Z(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function rt(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const et=tt((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),rt(this,"getUserFromEmail",(function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,o){X(K().mark((function i(){var a;return K().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,r.prisma.user.findUnique({where:{email:t},include:{shortcuts:e}});case 3:return a=i.sent,i.abrupt("return",n(a));case 7:return i.prev=7,i.t0=i.catch(0),i.abrupt("return",o(i.t0));case 10:case"end":return i.stop()}}),i,null,[[0,7]])})))()}))})),rt(this,"getUserFromId",(function(t){return new Promise((function(e,n){X(K().mark((function o(){var i;return K().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,r.prisma.user.findUnique({where:{id:t},include:{shortcuts:!0}});case 3:return i=o.sent,o.abrupt("return",e(i));case 7:return o.prev=7,o.t0=o.catch(0),o.abrupt("return",n(o.t0));case 10:case"end":return o.stop()}}),o,null,[[0,7]])})))()}))})),this.prisma=$}));function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}var ot=["password"];function it(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)e=i[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)e=i[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function at(){at=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new j(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return E()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=w(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(L([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function b(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==nt(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function w(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,w(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function O(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(b.prototype),u(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new b(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=L,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;O(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:L(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function ut(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function ct(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){ut(i,n,o,a,u,"next",t)}function u(t){ut(i,n,o,a,u,"throw",t)}a(void 0)}))}}function st(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lt(t,r,e){return r&&st(t.prototype,r),e&&st(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ft(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const ht=lt((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),ft(this,"encryptPassword",function(){var t=ct(at().mark((function t(r){var e,n;return at().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,W.genSalt)(10);case 2:return e=t.sent,t.next=5,(0,Q.hash)(r,e);case 5:return n=t.sent,t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}()),ft(this,"comparePassword",(function(t,r){return(0,Q.compare)(t,r)})),ft(this,"register",(function(t){return new Promise((function(e,n){ct(at().mark((function o(){var i,a;return at().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,r.userService.getUserFromEmail(t.email);case 3:if(!o.sent){o.next=6;break}return o.abrupt("return",n({error:"User with this email already exists",code:409}));case 6:return o.next=8,r.encryptPassword(t.password);case 8:return t.password=o.sent,o.next=11,r.prisma.user.create({data:t});case 11:return i=o.sent,a=i.id,o.abrupt("return",e(a));case 16:return o.prev=16,o.t0=o.catch(0),o.abrupt("return",n({error:o.t0,code:503}));case 19:case"end":return o.stop()}}),o,null,[[0,16]])})))()}))})),ft(this,"login",(function(t){return new Promise((function(e,n){ct(at().mark((function o(){var i,a,u,c,s;return at().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,i=t.email,o.next=4,r.userService.getUserFromEmail(i,!1);case 4:if(a=o.sent){o.next=7;break}return o.abrupt("return",n({error:"User with this email couldn't be found",code:409}));case 7:return u=t.password,c=a.password,o.next=10,r.comparePassword(u,c);case 10:if(o.sent){o.next=12;break}return o.abrupt("return",n({error:"Password is not valid",code:401}));case 12:a.password,s=it(a,ot),null,e(s),o.next=20;break;case 17:return o.prev=17,o.t0=o.catch(0),o.abrupt("return",n({error:o.t0,code:503}));case 20:case"end":return o.stop()}}),o,null,[[0,17]])})))()}))})),this.prisma=$,this.userService=new et}));function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function dt(){dt=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new j(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return E()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=w(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(L([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function b(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==pt(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function w(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,w(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function O(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(b.prototype),u(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new b(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=L,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;O(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:L(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function vt(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function yt(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){vt(i,n,o,a,u,"next",t)}function u(t){vt(i,n,o,a,u,"throw",t)}a(void 0)}))}}function gt(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function mt(t,r,e){return r&&gt(t.prototype,r),e&&gt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function bt(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const wt=mt((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),bt(this,"validateRegistrationData",(function(t){return H().object({name:H().string().min(3).max(64).trim().required(),email:H().string().email().max(128).trim().required(),password:H().string().min(6).max(256).required()}).validate(t)})),bt(this,"validateLoginData",(function(t){return H().object({email:H().string().email().max(128).trim().required(),password:H().string().min(6).max(256).required()}).validate(t)})),bt(this,"loginUserByPersistingCache",(function(t,r){t.session.oslashBeUserId=r})),bt(this,"register",function(){var t=yt(dt().mark((function t(e,n){var o,i,a,u,c,s;return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.body,!(i=r.validateRegistrationData(o).error)){t.next=4;break}return t.abrupt("return",n.status(403).json({error:i.message,data:null}));case 4:return t.prev=4,t.next=7,r.authService.register(o);case 7:return a=t.sent,r.loginUserByPersistingCache(e,a),t.abrupt("return",n.status(201).json({error:null,data:{userId:a}}));case 12:return t.prev=12,t.t0=t.catch(4),u=t.t0,c=u.error,s=u.code,t.abrupt("return",n.status(s).json({error:c,data:null}));case 16:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(r,e){return t.apply(this,arguments)}}()),bt(this,"login",function(){var t=yt(dt().mark((function t(e,n){var o,i,a,u,c,s;return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.body,i=r.validateLoginData(o).error){t.next=17;break}return t.prev=3,t.next=6,r.authService.login(o);case 6:return a=t.sent,r.loginUserByPersistingCache(e,a.id),t.abrupt("return",n.status(200).json({data:a,error:null}));case 11:return t.prev=11,t.t0=t.catch(3),u=t.t0,c=u.error,s=u.code,t.abrupt("return",n.status(s).json({error:c,data:null}));case 15:t.next=18;break;case 17:return t.abrupt("return",n.status(403).json({error:i.message,data:null}));case 18:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(r,e){return t.apply(this,arguments)}}()),bt(this,"logout",(function(t,r){t.session.destroy((function(t){return t?r.status(503).json({error:"We were not able to log you out",data:null}):(r.clearCookie(I),r.status(200).json({data:"Logged-out successfully",error:null}))}))})),bt(this,"isLoggedIn",(function(t){return!!t.session.oslashBeUserId})),this.authService=new ht}));var xt=function(t,r,e){if((new wt).isLoggedIn(t))return r.status(406).json({error:"You are already logged-in",data:null});e()},Ot=function(t,r,e){if(!(new wt).isLoggedIn(t))return r.status(406).json({error:"You must be logged-in to access this resource",data:null});e()};function jt(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Lt(t,r,e){return r&&jt(t.prototype,r),e&&jt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Et(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const St=Lt((function t(){var e=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),Et(this,"path","/"),Et(this,"initializeRoute",(function(){e.router.get("".concat(e.path),(function(t,r){r.status(200).json({error:null,data:"User auth route healthy"})})),e.router.post("".concat(e.path,"register"),xt,(function(t,r){e.authController.register(t,r)})),e.router.post("".concat(e.path,"login"),xt,(function(t,r){e.authController.login(t,r)})),e.router.get("".concat(e.path,"logout"),Ot,(function(t,r){try{e.authController.logout(t,r)}catch(t){return r.status(503).json({error:t,data:null})}}))})),this.router=(0,r.Router)(),this.authController=new wt,this.initializeRoute()}));function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(t)}function kt(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function _t(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?kt(Object(e),!0).forEach((function(r){Ct(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):kt(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function Tt(){Tt=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new j(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return E()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=w(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(L([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function b(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==Pt(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function w(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,w(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function O(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(b.prototype),u(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new b(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=L,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;O(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:L(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function Nt(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function Gt(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){Nt(i,n,o,a,u,"next",t)}function u(t){Nt(i,n,o,a,u,"throw",t)}a(void 0)}))}}function It(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Rt(t,r,e){return r&&It(t.prototype,r),e&&It(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ct(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const Ft=Rt((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),Ct(this,"searchShortcutByShortlink",(function(t,e){return new Promise((function(n,o){Gt(Tt().mark((function i(){var a;return Tt().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,r.prisma.shortcut.findUnique({where:{shortlink_userId:{shortlink:e,userId:t}}});case 3:return a=i.sent,i.abrupt("return",n(a));case 7:return i.prev=7,i.t0=i.catch(0),i.abrupt("return",o(i.t0));case 10:case"end":return i.stop()}}),i,null,[[0,7]])})))()}))})),Ct(this,"addShortcut",(function(t,e){return new Promise((function(n,o){Gt(Tt().mark((function i(){return Tt().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,r.searchShortcutByShortlink(e,t.shortlink);case 3:if(!i.sent){i.next=6;break}return i.abrupt("return",o({error:"This shortcut already exists",code:406}));case 6:return i.next=8,r.prisma.user.update({where:{id:e},data:{shortcuts:{create:_t(_t({},t),{},{visits:0})}}});case 8:return i.abrupt("return",n(t.shortlink));case 11:return i.prev=11,i.t0=i.catch(0),i.abrupt("return",o({error:i.t0,code:503}));case 14:case"end":return i.stop()}}),i,null,[[0,11]])})))()}))})),Ct(this,"listShortcuts",(function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc";return new Promise((function(o,i){Gt(Tt().mark((function a(){var u;return Tt().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,r.prisma.shortcut.findMany({where:{userId:t},orderBy:Ct({},e,n)});case 3:if(0!==(u=a.sent).length){a.next=6;break}return a.abrupt("return",i({error:"No shortcuts for this user could be found",code:404}));case 6:return a.abrupt("return",o(u));case 9:return a.prev=9,a.t0=a.catch(0),a.abrupt("return",i({error:a.t0,code:503}));case 12:case"end":return a.stop()}}),a,null,[[0,9]])})))()}))})),Ct(this,"deleteShortcut",(function(t,e){return new Promise((function(n,o){Gt(Tt().mark((function i(){return Tt().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,r.searchShortcutByShortlink(t,e);case 3:if(i.sent){i.next=6;break}return i.abrupt("return",o({error:"The requested doesn't exist and hence can't be deleted",code:406}));case 6:return i.next=8,r.prisma.shortcut.delete({where:{shortlink_userId:{userId:t,shortlink:e}}});case 8:return i.abrupt("return",n(e));case 11:return i.prev=11,i.t0=i.catch(0),i.abrupt("return",o({error:i.t0,code:503}));case 14:case"end":return i.stop()}}),i,null,[[0,11]])})))()}))})),Ct(this,"searchShortcuts",(function(t,e){return new Promise((function(n,o){Gt(Tt().mark((function i(){var a;return Tt().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,r.prisma.shortcut.findMany({where:{userId:t}});case 3:if(0!=(a=i.sent).length&&a){i.next=6;break}return i.abrupt("return",o({error:"No shortcut for this user could be found",code:404}));case 6:if(e.shortlink&&(a=a.filter((function(t){return-1!==t.shortlink.toLowerCase().indexOf(e.shortlink.toLowerCase())}))),e.visibility&&(a=a.filter((function(t){var r;return t.visibility.toLowerCase()===(null===(r=e.visibility)||void 0===r?void 0:r.toLowerCase())}))),e.tag&&(a=a.filter((function(t){return t.tags.includes(e.tag)}))),e.url&&(a=a.filter((function(t){return-1!==t.url.toLowerCase().indexOf(e.url.toLowerCase())}))),null!=e.visitsLow&&null!=e.visitsHigh&&(a=a.filter((function(t){return t.visits>=e.visitsLow&&t.visits<=e.visitsHigh}))),null!=e.visitsLow&&null==e.visitsHigh&&(a=a.filter((function(t){return t.visits>=e.visitsLow}))),null==e.visitsLow&&null!=e.visitsHigh&&(a=a.filter((function(t){return t.visits<=e.visitsHigh}))),0!=a.length&&a){i.next=15;break}return i.abrupt("return",o({error:"No shortcut for this search could be found",code:404}));case 15:if(0!=a.length&&a){i.next=17;break}return i.abrupt("return",o({error:"No shortcut for this search could be found",code:404}));case 17:return i.abrupt("return",n(a));case 20:return i.prev=20,i.t0=i.catch(0),i.abrupt("return",o({error:i.t0,code:503}));case 23:case"end":return i.stop()}}),i,null,[[0,20]])})))()}))})),Ct(this,"getUrlFromShortlink",(function(t,e){return new Promise((function(n,o){Gt(Tt().mark((function i(){var a;return Tt().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,r.searchShortcutByShortlink(t,e);case 3:if(a=i.sent){i.next=6;break}return i.abrupt("return",o({error:"".concat(e," shortlink could not be found"),code:404}));case 6:return i.next=8,r.prisma.shortcut.update({where:{shortlink_userId:{shortlink:e,userId:t}},data:{visits:{increment:1}}});case 8:return i.abrupt("return",n(a.url));case 11:return i.prev=11,i.t0=i.catch(0),i.abrupt("return",o({error:i.t0,code:503}));case 14:case"end":return i.stop()}}),i,null,[[0,11]])})))()}))})),this.prisma=$}));function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function Dt(){Dt=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new j(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return E()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=w(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(L([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function b(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==Ut(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function w(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,w(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function O(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(b.prototype),u(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new b(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=L,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;O(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:L(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function qt(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function At(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?qt(Object(e),!0).forEach((function(r){Ht(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):qt(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function Bt(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function Yt(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){Bt(i,n,o,a,u,"next",t)}function u(t){Bt(i,n,o,a,u,"throw",t)}a(void 0)}))}}function zt(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mt(t,r,e){return r&&zt(t.prototype,r),e&&zt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ht(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const Wt=Mt((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),Ht(this,"validateShortcutData",(function(t){return H().object({shortlink:H().string().trim().required(),url:H().string().uri().trim().required(),visibility:H().string().allow("Workspace","Private").optional(),description:H().string().trim().optional(),tags:H().optional()}).validate(t)})),Ht(this,"isUrlWhatwgCompliant",(function(t){return new RegExp(/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/).test(t)})),Ht(this,"addShortcut",function(){var t=Yt(Dt().mark((function t(e,n){var o,i,a,u,c,s,l,f,h;return Dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.body,i=o.tags,a=o.visibility,i||(o=At(At({},o),{},{tags:[]})),a||(o=At(At({},o),{},{visibility:"Workspace"})),!(u=r.validateShortcutData(o).error)){t.next=8;break}return t.abrupt("return",n.status(403).json({error:u.message,data:null}));case 8:if(r.isUrlWhatwgCompliant(o.url)){t.next=10;break}return t.abrupt("return",n.status(406).json({error:"This is not a valid URL",data:null}));case 10:if(c=e.session.oslashBeUserId){t.next=13;break}return t.abrupt("return",n.status(406).json({error:"You must be logged-in to access this resource",data:null}));case 13:return t.prev=13,t.next=16,r.shortcutService.addShortcut(o,c);case 16:return s=t.sent,t.abrupt("return",n.status(201).json({error:null,data:{message:"".concat(s," has been added successfully")}}));case 20:return t.prev=20,t.t0=t.catch(13),l=t.t0,f=l.error,h=l.code,t.abrupt("return",n.status(h).json({error:f,data:null}));case 24:case"end":return t.stop()}}),t,null,[[13,20]])})));return function(r,e){return t.apply(this,arguments)}}()),Ht(this,"listShortcuts",function(){var t=Yt(Dt().mark((function t(e,n){var o,i,a,u,c,s,l,f;return Dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.session.oslashBeUserId){t.next=3;break}return t.abrupt("return",n.status(403).json({error:"You are not authenticated to use this resource",data:null}));case 3:if(i=e.query,a=i.orderBy,u=i.sortBy,!a||u){t.next=7;break}return t.abrupt("return",n.status(406).json({error:"Please make sure to use sortBy query with orderBy",data:null}));case 7:if(u||(u="shortlink"),a||(a="asc"),["shortlink","createdAt","updatedAt","visits"].includes(u)){t.next=12;break}return t.abrupt("return",n.status(403).json({error:'Allowed values for sortBy are -> "shortlink", "createdAt", "updatedAt", "visits"',data:null}));case 12:if(["asc","desc"].includes(a)){t.next=15;break}return t.abrupt("return",n.status(403).json({error:'Allowed values for sortBy are -> "asc" or "desc"',data:null}));case 15:return t.prev=15,t.next=18,r.shortcutService.listShortcuts(o,u,a);case 18:return c=t.sent,t.abrupt("return",n.status(200).json({data:{shortcuts:c},error:null}));case 22:return t.prev=22,t.t0=t.catch(15),s=t.t0,l=s.error,f=s.code,t.abrupt("return",n.status(f).json({error:l,data:null}));case 26:case"end":return t.stop()}}),t,null,[[15,22]])})));return function(r,e){return t.apply(this,arguments)}}()),Ht(this,"deleteShortcut",function(){var t=Yt(Dt().mark((function t(e,n){var o,i,a,u,c;return Dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.session.oslashBeUserId){t.next=3;break}return t.abrupt("return",n.status(403).json({error:"You are not authenticated to use this resource",data:null}));case 3:if(i=e.body.shortlink){t.next=6;break}return t.abrupt("return",n.status(406).json({error:"Please provide a shortlink to be deleted",data:null}));case 6:return t.prev=6,t.next=9,r.shortcutService.deleteShortcut(o,i);case 9:return t.abrupt("return",n.status(200).json({data:"Deleted the shortlink ".concat(i," successfully"),error:null}));case 12:return t.prev=12,t.t0=t.catch(6),a=t.t0,u=a.error,c=a.code,t.abrupt("return",n.status(c).json({error:u,data:null}));case 16:case"end":return t.stop()}}),t,null,[[6,12]])})));return function(r,e){return t.apply(this,arguments)}}()),Ht(this,"validateSearchBody",(function(t){return H().object({shortlink:H().string().optional(),url:H().string().optional(),visibility:H().string().allow("Workspace","Private").optional(),tag:H().string().optional(),visitsLow:H().number().optional(),visitsHigh:H().number().optional()}).validate(t)})),Ht(this,"searchShortcuts",function(){var t=Yt(Dt().mark((function t(e,n){var o,i,a,u,c,s,l;return Dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.session.oslashBeUserId){t.next=3;break}return t.abrupt("return",n.status(403).json({error:"You are not authenticated to use this resource",data:null}));case 3:if(i=e.body,!(a=r.validateSearchBody(i).error)){t.next=7;break}return t.abrupt("return",n.status(403).json({error:a.message,data:null}));case 7:return t.prev=7,t.next=10,r.shortcutService.searchShortcuts(o,i);case 10:return u=t.sent,t.abrupt("return",n.status(200).json({data:{shortcuts:u},error:null}));case 14:return t.prev=14,t.t0=t.catch(7),c=t.t0,s=c.error,l=c.code,t.abrupt("return",n.status(l).json({error:s,data:null}));case 18:case"end":return t.stop()}}),t,null,[[7,14]])})));return function(r,e){return t.apply(this,arguments)}}()),Ht(this,"getUrlFromShortlink",function(){var t=Yt(Dt().mark((function t(e,n){var o,i,a,u,c,s;return Dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.session.oslashBeUserId){t.next=3;break}return t.abrupt("return",n.status(403).json({error:"You are not authenticated to use this resource",data:null}));case 3:if("string"==typeof(i=e.params.shortlink)){t.next=6;break}return t.abrupt("return",n.status(406).json({data:null,error:"Please pass in a valid URL"}));case 6:return t.prev=6,t.next=9,r.shortcutService.getUrlFromShortlink(o,i);case 9:return a=t.sent,t.abrupt("return",n.status(200).json({data:{url:a},error:null}));case 13:return t.prev=13,t.t0=t.catch(6),u=t.t0,c=u.error,s=u.code,t.abrupt("return",n.status(s).json({error:c,data:null}));case 17:case"end":return t.stop()}}),t,null,[[6,13]])})));return function(r,e){return t.apply(this,arguments)}}()),this.shortcutService=new Ft}));function Qt(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $t(t,r,e){return r&&Qt(t.prototype,r),e&&Qt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Jt(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const Kt=$t((function t(){var e=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),Jt(this,"path","/"),Jt(this,"initializeRoutes",(function(){e.router.get("".concat(e.path),(function(t,r){r.status(200).json({error:null,data:"Shortcut route is healthy"})})),e.router.post("".concat(e.path,"add"),Ot,(function(t,r){e.shortcutContoller.addShortcut(t,r)})),e.router.get("".concat(e.path,"o/:shortlink"),Ot,(function(t,r){e.shortcutContoller.getUrlFromShortlink(t,r)})),e.router.get("".concat(e.path,"list"),Ot,(function(t,r){e.shortcutContoller.listShortcuts(t,r)})),e.router.post("".concat(e.path,"delete"),Ot,(function(t,r){e.shortcutContoller.deleteShortcut(t,r)})),e.router.post("".concat(e.path,"search"),Ot,(function(t,r){e.shortcutContoller.searchShortcuts(t,r)}))})),this.router=(0,r.Router)(),this.shortcutContoller=new Wt,this.initializeRoutes()}));function Vt(t){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vt(t)}var Xt=["password"];function Zt(){Zt=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new j(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return E()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=w(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(L([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function b(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==Vt(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function w(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,w(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function O(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(b.prototype),u(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new b(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=L,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;O(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:L(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function tr(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function rr(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?tr(Object(e),!0).forEach((function(r){ar(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):tr(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function er(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)e=i[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)e=i[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function nr(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function or(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ir(t,r,e){return r&&or(t.prototype,r),e&&or(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ar(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const ur=ir((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),ar(this,"userDashboard",function(){var t,e=(t=Zt().mark((function t(e,n){var o,i,a;return Zt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.session.oslashBeUserId){t.next=3;break}return t.abrupt("return",n.status(406).json({error:"You must be logged-in to access this resource",data:null}));case 3:return t.prev=3,t.next=6,r.userService.getUserFromId(o);case 6:if(i=t.sent){t.next=9;break}return t.abrupt("return",n.status(403).json({error:"The request seem to be infiltarated",data:null}));case 9:return i.password,a=er(i,Xt),t.abrupt("return",n.status(201).json({error:null,data:{user:rr({},a)}}));case 14:return t.prev=14,t.t0=t.catch(3),t.abrupt("return",n.status(503).json({error:t.t0,data:null}));case 17:case"end":return t.stop()}}),t,null,[[3,14]])})),function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){nr(i,n,o,a,u,"next",t)}function u(t){nr(i,n,o,a,u,"throw",t)}a(void 0)}))});return function(t,r){return e.apply(this,arguments)}}()),this.userService=new et}));function cr(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function sr(t,r,e){return r&&cr(t.prototype,r),e&&cr(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function lr(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const fr=sr((function t(){var e=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),lr(this,"path","/"),lr(this,"initializeRoutes",(function(){e.router.get("".concat(e.path),(function(t,r){r.status(200).json({error:null,data:"User dashboard route is healthy"})})),e.router.get("".concat(e.path,"dashboard"),Ot,(function(t,r){e.userContoller.userDashboard(t,r)}))})),this.router=(0,r.Router)(),this.userContoller=new ur,this.initializeRoutes()}));function hr(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function pr(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?hr(Object(e),!0).forEach((function(r){yr(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):hr(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function dr(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function vr(t,r,e){return r&&dr(t.prototype,r),e&&dr(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function yr(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}(new(vr((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),yr(this,"logPath",c().join(__dirname,"..","logs","access.log")),yr(this,"listen",(function(){r.app.listen(r.port,(function(){console.log("Server is up on the port: ".concat(r.port))}))})),yr(this,"initializeMiddlewares",(function(){r.app.use(o()()),r.app.use(e().json()),r.app.use(a()())})),yr(this,"initializeRoutes",(function(){r.app.use("/auth",r.userAuthRoute.router),r.app.use("/user",r.userRoute.router),r.app.use("/shortcut",r.shortcutRoute.router)})),yr(this,"handleMiscRoutes",(function(){r.app.get("/",(function(t,r){r.status(200).json({error:null,data:{server:"Base-Healthy"}})})),r.app.all("*",(function(t,r){r.status(404).json({error:"Requested route doesn't exist - 404",data:null})})),r.app.use((function(t,r,e){r.status(500).json({error:"Something broke on our end!",data:null})}))})),yr(this,"configureExpressSessionMiddleware",(function(){r.app.use(l()(pr(pr({},C),{},{store:r.redisStore})))})),this.app=e()(),this.port=+U||4e3,this.redisStore=(new z).redisStore,this.userAuthRoute=new St,this.shortcutRoute=new Kt,this.userRoute=new fr,this.configureExpressSessionMiddleware(),this.initializeMiddlewares(),this.initializeRoutes(),this.handleMiscRoutes()})))).listen()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFDekMsRUFBSytELElBQUlFLElBQUksUUFBUyxFQUFLSyxVQUFVdEUsUUFDckMsRUFBSytELElBQUlFLElBQUksWUFBYSxFQUFLTSxjQUFjdkUsT0FDOUMsSUExRGMsNEJBNERZLFdBSXpCLEVBQUsrRCxJQUFJN0ssSUFBSSxLQUFLLFNBQUN1RixFQUFjRSxHQUMvQkEsRUFBSUksT0FBTyxLQUFLQyxLQUFLLENBQ25CbkQsTUFBTyxLQUNQNEIsS0FBTSxDQUNKK0csT0FBUSxpQkFHYixJQUtELEVBQUtULElBQUlVLElBQUksS0FBSyxTQUFDaEcsRUFBY0UsR0FDL0JBLEVBQUlJLE9BQU8sS0FBS0MsS0FBSyxDQUNuQm5ELE1BQU8sc0NBQ1A0QixLQUFNLE1BRVQsSUFFRCxFQUFLc0csSUFBSUUsS0FDUCxTQUFDeEYsRUFBY0UsRUFBZWtCLEdBQzVCbEIsRUFBSUksT0FBTyxLQUFLQyxLQUFLLENBQ25CbkQsTUFBTyw4QkFDUDRCLEtBQU0sTUFFVCxHQUVKLElBM0ZjLDZDQWdHNkIsV0FDMUMsRUFBS3NHLElBQUlFLElBQ1B4SSxJQUFRLFNBQ0hmLEdBREUsSUFJTGdLLE1BQU8sRUFBS0MsY0FHakIsSUF4R0NySixLQUFLeUksSUFBTUksTUFFWDdJLEtBQUt2QixNQUFRb0IsR0FBUyxJQUd0QkcsS0FBS3FKLFlBQWEsSUFBSXRKLEdBQWlCc0osV0FDdkNySixLQUFLK0ksY0FBZ0IsSUFBSXRFLEdBQ3pCekUsS0FBS2lKLGNBQWdCLElBQUlsQixHQUN6Qi9ILEtBQUtnSixVQUFZLElBQUlaLEdBRXJCcEksS0FBS3NKLG9DQUNMdEosS0FBS3VKLHdCQUNMdkosS0FBS2lJLG1CQUNMakksS0FBS3dKLGtCQUNOLE1EN0NDZCIsInNvdXJjZXMiOlsid2VicGFjazovL29zbGFzaC1iZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvd2VicGFjay9ydW50aW1lL2NvbXBhdCBnZXQgZGVmYXVsdCBleHBvcnQiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJleHByZXNzXCIiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL2V4dGVybmFsIGNvbW1vbmpzIFwiY29yc1wiIiwid2VicGFjazovL29zbGFzaC1iZS9leHRlcm5hbCBjb21tb25qcyBcImhlbG1ldFwiIiwid2VicGFjazovL29zbGFzaC1iZS9leHRlcm5hbCBjb21tb25qcyBcIm1vcmdhblwiIiwid2VicGFjazovL29zbGFzaC1iZS9leHRlcm5hbCBub2RlLWNvbW1vbmpzIFwiZnNcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgbm9kZS1jb21tb25qcyBcInBhdGhcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJleHByZXNzLXNlc3Npb25cIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJkb3RlbnZcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29uZmlnL2NhY2hlLmNvbmZpZy50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29uZmlnL2RiLmNvbmZpZy50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29uZmlnL3Nlc3Npb24uY29uZmlnLnRzIiwid2VicGFjazovL29zbGFzaC1iZS8uL3NyYy9jb25maWcvYXBwLmNvbmZpZy50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29uZmlnL2luZGV4LnRzIiwid2VicGFjazovL29zbGFzaC1iZS9leHRlcm5hbCBjb21tb25qcyBcImlvcmVkaXNcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJjb25uZWN0LXJlZGlzXCIiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlLy4vc3JjL3NlcnZpY2VzL3JlZGlzL3JlZGlzLnNlcnZpY2UudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL2V4dGVybmFsIGNvbW1vbmpzIFwiam9pXCIiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL2V4dGVybmFsIGNvbW1vbmpzIFwiYmNyeXB0anNcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJiY3J5cHRcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvdXRpbHMvcHJpc21hLnV0aWwudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL2V4dGVybmFsIGNvbW1vbmpzIFwiQHByaXNtYS9jbGllbnRcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvc2VydmljZXMvdXNlci91c2VyLnNlcnZpY2UudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlLy4vc3JjL3NlcnZpY2VzL2F1dGgvYXV0aC5zZXJ2aWNlLnRzIiwid2VicGFjazovL29zbGFzaC1iZS8uL3NyYy9jb250cm9sbGVycy9hdXRoL2F1dGguY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvbWlkZGxld2FyZXMvYXV0aC9hdXRoLm1pZGRsZXdhcmUudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlLy4vc3JjL3JvdXRlcy9hdXRoL2F1dGgucm91dGUudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlLy4vc3JjL3NlcnZpY2VzL3Nob3J0Y3V0cy9zaG9ydGN1dC5zZXJ2aWNlLnRzIiwid2VicGFjazovL29zbGFzaC1iZS8uL3NyYy9jb250cm9sbGVycy9zaG9ydGN1dHMvc2hvcnRjdXRzLmNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlLy4vc3JjL3JvdXRlcy9zaG9ydGN1dHMvc2hvcnRjdXRzLnJvdXRlLnRzIiwid2VicGFjazovL29zbGFzaC1iZS8uL3NyYy9jb250cm9sbGVycy91c2VyL3VzZXIuY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvcm91dGVzL3VzZXIvdXNlci5yb3V0ZS50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlLy4vc3JjL2FwcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbl9fd2VicGFja19yZXF1aXJlX18ubiA9IChtb2R1bGUpID0+IHtcblx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG5cdFx0KCkgPT4gKG1vZHVsZVsnZGVmYXVsdCddKSA6XG5cdFx0KCkgPT4gKG1vZHVsZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsgYTogZ2V0dGVyIH0pO1xuXHRyZXR1cm4gZ2V0dGVyO1xufTsiLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJleHByZXNzXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiY29yc1wiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcImhlbG1ldFwiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcIm1vcmdhblwiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcImZzXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwicGF0aFwiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcImV4cHJlc3Mtc2Vzc2lvblwiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcImRvdGVudlwiKTsiLCJpbXBvcnQgeyBSZWRpc09wdGlvbnMgfSBmcm9tIFwiaW9yZWRpc1wiO1xuXG5jb25zdCB7XG4gIFJFRElTX1BPUlQgPSA2Mzc5LFxuICBSRURJU19IT1NUID0gXCJsb2NhbGhvc3RcIiwgLy9hbHNvIHJlZmVyZW5jZXMgYXMgUkVESVNfVVJMIC8vdXNpbmcgcmVkaXMgYXMgdmFsdWUgZGVmYXVsdHMgdG8gdGhlIGRvY2tlciBpbWFnZSB0aGF0IHdlIGhhdmVcbiAgUkVESVNfUEFTU1dPUkQgPSBcInNlY3JldFwiLFxufSA9IHByb2Nlc3MuZW52O1xuXG5leHBvcnQgY29uc3QgUkVESVNfT1BUSU9OUzogUmVkaXNPcHRpb25zID0ge1xuICBwb3J0OiArUkVESVNfUE9SVCxcbiAgaG9zdDogUkVESVNfSE9TVCxcbiAgcGFzc3dvcmQ6IFJFRElTX1BBU1NXT1JELFxufTtcbiIsImV4cG9ydCBjb25zdCB7XG4gIFBPU1RHUkVTUUxfVVNFUiA9IFwiYWRtaW5cIixcbiAgUE9TVEdSRVNRTF9QQVNTV09SRCA9IFwiYWRtaW5cIixcbiAgUE9TVEdSRVNRTF9QT1JUID0gXCI1NDMyXCIsXG4gIFBPU1RHUkVTUUxfSE9TVCA9IFwibG9jYWxob3N0XCIsXG59ID0gcHJvY2Vzcy5lbnY7XG5cbmV4cG9ydCBjb25zdCB7XG4gIERBVEFCQVNFX1VSTCA9IGBwb3N0Z3JlczovLyR7UE9TVEdSRVNRTF9VU0VSfToke1BPU1RHUkVTUUxfUEFTU1dPUkR9QCR7UE9TVEdSRVNRTF9IT1NUfToke1BPU1RHUkVTUUxfUE9SVH1gLFxufSA9IHByb2Nlc3MuZW52O1xuIiwiaW1wb3J0IHsgU2Vzc2lvbk9wdGlvbnMgfSBmcm9tIFwiZXhwcmVzcy1zZXNzaW9uXCI7XG5cbmNvbnN0IFNJWF9IT1VSUyA9IDEwMDAgKiA2MCAqIDYwICogNjtcblxuZXhwb3J0IGNvbnN0IHtcbiAgU0VTU0lPTl9TRUNSRVQgPSBcInNlY3JldFwiLFxuICBTRVNTSU9OX05BTUUgPSBcInNpZFwiLFxuICBTRVNTSU9OX1RJTUVPVVQgPSBTSVhfSE9VUlMsXG59ID0gcHJvY2Vzcy5lbnY7XG5cbmV4cG9ydCBjb25zdCBTRVNTSU9OX09QVElPTlM6IFNlc3Npb25PcHRpb25zID0ge1xuICBzZWNyZXQ6IFNFU1NJT05fU0VDUkVULFxuICBuYW1lOiBTRVNTSU9OX05BTUUsXG4gIGNvb2tpZToge1xuICAgIG1heEFnZTogK1NFU1NJT05fVElNRU9VVCxcbiAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIixcbiAgfSxcbiAgcmVzYXZlOiBmYWxzZSxcbiAgc2F2ZVVuaW5pdGlhbGl6ZWQ6IGZhbHNlLFxuICByb2xsaW5nOiB0cnVlLCAvL3JvbGwgdGhlIHNlc3Npb24gaS5lLiBrZWVwIGl0IGFsaXZlIGV2ZW4gYWZ0ZXIgc2l4IGhvdXJzIGlmIHRoZSB1c2VyIGlzIGFjdGl2ZVxufTtcbiIsImV4cG9ydCBjb25zdCB7IE5PREVfRU5WLCBQT1JUIH0gPSBwcm9jZXNzLmVudjtcbiIsImltcG9ydCB7IGNvbmZpZyB9IGZyb20gXCJkb3RlbnZcIjtcbmNvbmZpZygpO1xuXG5leHBvcnQgKiBmcm9tIFwiLi9jYWNoZS5jb25maWdcIjtcbmV4cG9ydCAqIGZyb20gXCIuL2RiLmNvbmZpZ1wiO1xuZXhwb3J0ICogZnJvbSBcIi4vc2Vzc2lvbi5jb25maWdcIjtcbmV4cG9ydCAqIGZyb20gXCIuL2FwcC5jb25maWdcIjtcbiIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiaW9yZWRpc1wiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcImNvbm5lY3QtcmVkaXNcIik7IiwiaW1wb3J0IFJlZGlzIGZyb20gXCJpb3JlZGlzXCI7XG5pbXBvcnQgY29ubmVjdFJlZGlzLCB7IFJlZGlzU3RvcmUgfSBmcm9tIFwiY29ubmVjdC1yZWRpc1wiO1xuaW1wb3J0IHsgUkVESVNfT1BUSU9OUyB9IGZyb20gXCIuLi8uLi9jb25maWdcIjtcbmltcG9ydCBzZXNzaW9uIGZyb20gXCJleHByZXNzLXNlc3Npb25cIjtcblxuY2xhc3MgQ29uZmlndXJlUmVkaXMge1xuICBwcml2YXRlIFJlZGlzU3RvcmU6IFJlZGlzU3RvcmU7XG4gIHByaXZhdGUgcmVkaXNDbGllbnQ6IFJlZGlzO1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICAvL2Nvbm5lY3RSZWRpcyBpcyBhIGNsYXNzIHRoYXQgbWFrZXMgdXNlIG9mIGV4cHJlc3Mtc2Vzc2lvbidzIHNlc3Npb24gdG8gY29ubmVjdCB0byByZWRpc1xuICAgIHRoaXMuUmVkaXNTdG9yZSA9IGNvbm5lY3RSZWRpcyhzZXNzaW9uKTtcblxuICAgIC8vY29uZmlndXJlIGEgbmV3IHJlZGlzIGNsaWVudCBmcm9tIGlvcmVkaXNcbiAgICB0aGlzLnJlZGlzQ2xpZW50ID0gbmV3IFJlZGlzKFJFRElTX09QVElPTlMpO1xuXG4gICAgdGhpcy5yZWRpc0NsaWVudC5vbihcImVycm9yXCIsIGVycm9yID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIHRocm93IFwiRXJyb3IgY29ubmVjdGluZyB3aXRoIHJlZGlzIGNsaWVudFwiO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIGEgbmV3IHJlZGlzIHN0b3JlIHRvIHdvcmsgd2l0aCB0aGUgZXhwcmVzcy1zZXNzaW9uIG1pZGRsZXdhcmVcbiAgICovXG4gIHB1YmxpYyBnZXQgcmVkaXNTdG9yZSAoKTogUmVkaXNTdG9yZSB7XG4gICAgLy9jcmVhdGluZyBhIG5ldyBpbnN0YW5jZSBvZiByZWRpcyBzdG9yZSBjbGFzcyB3aXRoIG91ciBwcmUtY29uZmlndXJlZCByZWRpcyBjbGllbnRcbiAgICByZXR1cm4gbmV3IHRoaXMuUmVkaXNTdG9yZSh7IGNsaWVudDogdGhpcy5yZWRpc0NsaWVudCB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDb25maWd1cmVSZWRpcztcbiIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiam9pXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiYmNyeXB0anNcIik7IiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJiY3J5cHRcIik7IiwiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5cbmNvbnN0IHByaXNtYUNsaWVudDogUHJpc21hQ2xpZW50ID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5leHBvcnQgZGVmYXVsdCBwcmlzbWFDbGllbnQ7XG4iLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcIkBwcmlzbWEvY2xpZW50XCIpOyIsImltcG9ydCB7IFByaXNtYUNsaWVudCwgVXNlciB9IGZyb20gXCJAcHJpc21hL2NsaWVudFwiO1xuaW1wb3J0IHByaXNtYUNsaWVudCBmcm9tIFwiLi4vLi4vdXRpbHMvcHJpc21hLnV0aWxcIjtcblxuY2xhc3MgVXNlclNlcnZpY2Uge1xuICBwcml2YXRlIHByaXNtYTogUHJpc21hQ2xpZW50O1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLnByaXNtYSA9IHByaXNtYUNsaWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gZW1haWwgLSB1c2VyIGVtYWlsXG4gICAqIEByZXR1cm5zIC0gUHJvbWlzZSB0aGF0IGVpdGhlciByZXNvbHZlcyB0byB0aGUgdXNlciBkYXRhIG9yIG51bGxcbiAgICovXG4gIHB1YmxpYyBnZXRVc2VyRnJvbUVtYWlsID0gKFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgaW5jbHVkZVNob3J0Y3V0czogYm9vbGVhbiA9IGZhbHNlLFxuICApOiBQcm9taXNlPFVzZXIgfCBudWxsPiA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPFVzZXIgfCBudWxsPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAvKipcbiAgICAgICAqIElJRkUgdG8gcHJldmVudCB0aGUgYXBwbGljYXRpb24gZnJvbSBsZXQgZ28gb2YgZXJyb3JzXG4gICAgICAgKi9cbiAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHNob3J0Y3V0czogaW5jbHVkZVNob3J0Y3V0cyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUodXNlcik7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBpZCAtIHVzZXIgaWQgdGhhdCBpcyBmb3VuZCBpbiB0aGUgY29va2llc1xuICAgKiBAcmV0dXJucyAtIFByb21pc2UgdGhhdCBlaXRoZXIgcmVzb2x2ZXMgdG8gdGhlIHVzZXIgZGF0YSBvciBudWxsXG4gICAqL1xuICBwdWJsaWMgZ2V0VXNlckZyb21JZCA9IChpZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyIHwgbnVsbD4gPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxVc2VyIHwgbnVsbD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgc2hvcnRjdXRzOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh1c2VyKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgVXNlclNlcnZpY2U7XG4iLCJpbXBvcnQgeyBnZW5TYWx0IH0gZnJvbSBcImJjcnlwdGpzXCI7XG5pbXBvcnQgeyBjb21wYXJlLCBoYXNoIH0gZnJvbSBcImJjcnlwdFwiO1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50LCBVc2VyIH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5pbXBvcnQge1xuICBTZXJ2aWNlRXJyb3IsXG4gIFVzZXJMb2dpbkRhdGEsXG4gIFVzZXJSZWdpc3RyYXRpb25EYXRhLFxuICBVc2VyV2l0aG91dFBhc3N3b3JkLFxufSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlc1wiO1xuaW1wb3J0IFVzZXJTZXJ2aWNlIGZyb20gXCIuLi91c2VyL3VzZXIuc2VydmljZVwiO1xuaW1wb3J0IHByaXNtYUNsaWVudCBmcm9tIFwiLi4vLi4vdXRpbHMvcHJpc21hLnV0aWxcIjtcblxuY2xhc3MgQXV0aFNlcnZpY2Uge1xuICBwcml2YXRlIHByaXNtYTogUHJpc21hQ2xpZW50O1xuICBwcml2YXRlIHVzZXJTZXJ2aWNlOiBVc2VyU2VydmljZTtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5wcmlzbWEgPSBwcmlzbWFDbGllbnQ7XG4gICAgdGhpcy51c2VyU2VydmljZSA9IG5ldyBVc2VyU2VydmljZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBwYXNzd29yZCAtIHBhc3N3b3JkIHJlY2lldmVkIHZpYSBQT1NUIHJlcXVlc3RcbiAgICogQHJldHVybnMgcGFzc3dvcmQgaGFzaGVkIHdpdGggYSBzYWx0IG9mIDEwXG4gICAqL1xuICBwcml2YXRlIGVuY3J5cHRQYXNzd29yZCA9IGFzeW5jIChcbiAgICBwYXNzd29yZDogc3RyaW5nLFxuICApOiBQcm9taXNlPHN0cmluZz4gPT4ge1xuICAgIGNvbnN0IHNhbHQgPSBhd2FpdCBnZW5TYWx0KDEwKTtcbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2gocGFzc3dvcmQsIHNhbHQpO1xuICAgIHJldHVybiBoYXNoZWRQYXNzd29yZDtcbiAgfTtcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHVzZXJQYXNzd29yZCAtIHBhc3N3b3JkIHJlY2lldmVkIHZpYSBQT1NUIHJlcXVlc3RcbiAgICogQHBhcmFtIGRiUGFzc3dvcmQgLSBwYXNzd29yZCBzdG9yZWQgaW4gdGhlIGRhdGFiYXNlXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBwcml2YXRlIGNvbXBhcmVQYXNzd29yZCA9IChcbiAgICB1c2VyUGFzc3dvcmQ6IHN0cmluZyxcbiAgICBkYlBhc3N3b3JkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIHJldHVybiBjb21wYXJlKHVzZXJQYXNzd29yZCwgZGJQYXNzd29yZCk7XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBkYXRhIC0gbmFtZSwgZW1haWwsIHBhc3N3b3JkIHJlY2lldmVkIGluIHJlcXVlc3QgYm9keVxuICAgKiBAcmV0dXJucyAtIHVzZXJJZCBvZiB0aGUgcmVnaXN0ZXJlZCB1c2VyXG4gICAqL1xuICBwdWJsaWMgcmVnaXN0ZXIgPSAoZGF0YTogVXNlclJlZ2lzdHJhdGlvbkRhdGEpOiBQcm9taXNlPHN0cmluZz4gPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8qKlxuICAgICAgICogYXN5bmMgSUlGRSAtIHRvIGVzY2FwZSBwcm9taXNlIGV4ZWN1dG9yIGZ1bmN0aW9uIGJlaW5nIGFzeW5jXG4gICAgICAgKiB0aGlzIGlzIG5lY2Vzc2FyeSB0byBjYXRjaCBlcnJvcnNcbiAgICAgICAqL1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB1c2VyOiBVc2VyIHwgbnVsbCA9IGF3YWl0IHRoaXMudXNlclNlcnZpY2UuZ2V0VXNlckZyb21FbWFpbChcbiAgICAgICAgICAgIGRhdGEuZW1haWwsXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIElmIHRoZSB1c2VyIHdpdGggdGhlIHNhbWUgZW1haWwgZXhpc3RzLCBkbyBub3QgcmVnaXN0ZXIgdGhlIHVzZXJcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdCh7XG4gICAgICAgICAgICAgIGVycm9yOiBcIlVzZXIgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzXCIsXG4gICAgICAgICAgICAgIGNvZGU6IDQwOSxcbiAgICAgICAgICAgIH0gYXMgU2VydmljZUVycm9yKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBFbmNyeXB0aW5nIHRoZSBwYXNzd29yZCBiZWZvcmUgc2F2aW5nIGl0IGluIHRoZSBEQlxuICAgICAgICAgICAqL1xuICAgICAgICAgIGRhdGEucGFzc3dvcmQgPSBhd2FpdCB0aGlzLmVuY3J5cHRQYXNzd29yZChkYXRhLnBhc3N3b3JkKTtcbiAgICAgICAgICBjb25zdCB7IGlkIH0gPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoaWQpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHJldHVybiByZWplY3Qoe1xuICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICBjb2RlOiA1MDMsXG4gICAgICAgICAgfSBhcyBTZXJ2aWNlRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gZGF0YSBlbWFpbCwgcGFzc3dvcmRcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIHJlc29sdmUgdmFsdWUgb2YgVXNlcldpdGhvdXRQYXNzd29yZFxuICAgKi9cbiAgcHVibGljIGxvZ2luID0gKGRhdGE6IFVzZXJMb2dpbkRhdGEpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8VXNlcldpdGhvdXRQYXNzd29yZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB7IGVtYWlsIH0gPSBkYXRhO1xuICAgICAgICAgIGNvbnN0IHVzZXI6IFVzZXIgfCBudWxsID0gYXdhaXQgdGhpcy51c2VyU2VydmljZS5nZXRVc2VyRnJvbUVtYWlsKFxuICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogSWYgdGhlIHVzZXIgd2l0aCB0aGUgc2FtZSBlbWFpbCBleGlzdHMsIGRvIG5vdCByZWdpc3RlciB0aGUgdXNlclxuICAgICAgICAgICAqL1xuICAgICAgICAgIGlmICghdXNlcikge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdCh7XG4gICAgICAgICAgICAgIGVycm9yOiBcIlVzZXIgd2l0aCB0aGlzIGVtYWlsIGNvdWxkbid0IGJlIGZvdW5kXCIsXG4gICAgICAgICAgICAgIGNvZGU6IDQwOSxcbiAgICAgICAgICAgIH0gYXMgU2VydmljZUVycm9yKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBDb21wYXJpbmcgdGhlIHBhc3N3b3JkIGZvciBlcXVhbGl0eVxuICAgICAgICAgICAqL1xuICAgICAgICAgIGNvbnN0IHVzZXJQYXNzd29yZCA9IGRhdGEucGFzc3dvcmQsXG4gICAgICAgICAgICBkYlBhc3N3b3JkID0gdXNlci5wYXNzd29yZDtcblxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICEoYXdhaXQgdGhpcy5jb21wYXJlUGFzc3dvcmQodXNlclBhc3N3b3JkLCBkYlBhc3N3b3JkKSlcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3Qoe1xuICAgICAgICAgICAgICBlcnJvcjogXCJQYXNzd29yZCBpcyBub3QgdmFsaWRcIixcbiAgICAgICAgICAgICAgY29kZTogNDAxLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy9leHRyYWN0aW5nIHBhc3N3b3JkIGZyb20gdGhlIHVzZXJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XG4gICAgICAgICAgbGV0IHsgcGFzc3dvcmQsIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IHVzZXI7XG4gICAgICAgICAgcGFzc3dvcmQgPSAobnVsbCBhcyB1bmtub3duKSBhcyBzdHJpbmc7XG5cbiAgICAgICAgICByZXNvbHZlKHVzZXJXaXRob3V0UGFzc3dvcmQpOyAvL3NlbmRpbmcgYmFjayB0aGUgdXNlciBkYXRhXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdCh7XG4gICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgIGNvZGU6IDUwMyxcbiAgICAgICAgICB9IGFzIFNlcnZpY2VFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfSk7XG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IEF1dGhTZXJ2aWNlO1xuIiwiaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IEpvaSwgeyBWYWxpZGF0aW9uRXJyb3IsIFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tIFwiam9pXCI7XG5pbXBvcnQgeyBTRVNTSU9OX05BTUUgfSBmcm9tIFwiLi4vLi4vY29uZmlnXCI7XG5pbXBvcnQge1xuICBHZW5lcmFsQXBpUmVzcG9uc2UsXG4gIFNlcnZpY2VFcnJvcixcbiAgVXNlckxvZ2luRGF0YSxcbiAgVXNlclJlZ2lzdHJhdGlvbkRhdGEsXG4gIFVzZXJXaXRob3V0UGFzc3dvcmQsXG59IGZyb20gXCIuLi8uLi9pbnRlcmZhY2VzXCI7XG5pbXBvcnQgQXV0aFNlcnZpY2UgZnJvbSBcIi4uLy4uL3NlcnZpY2VzL2F1dGgvYXV0aC5zZXJ2aWNlXCI7XG5cbi8qKlxuICogRGVjbHJhdGl2ZSBtZXJnaW5nXG4gKi9cbmRlY2xhcmUgbW9kdWxlIFwiZXhwcmVzcy1zZXNzaW9uXCIge1xuICBpbnRlcmZhY2UgU2Vzc2lvbiB7XG4gICAgb3NsYXNoQmVVc2VySWQ6IHN0cmluZztcbiAgfVxufVxuXG5jbGFzcyBBdXRoQ29udHJvbGxlciB7XG4gIHByaXZhdGUgYXV0aFNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHRoaXMuYXV0aFNlcnZpY2UgPSBuZXcgQXV0aFNlcnZpY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdXNlclJlZ2lzdHJhdGlvbkRhdGEgLSBhbiBvYmplY3Qgd2l0aCBuYW1lLCBlbWFpbCwgYW5kIHBhc3N3b3JkID0+IHJlcXVpcmVkIGZvciByZWdpc3RyYXRpb25cbiAgICogQHJldHVybnMgLSBWYWxpZGF0aW9uUmVzdWx0IHdpdGggZXJyb3IgbWVzc2FnZVxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZVJlZ2lzdHJhdGlvbkRhdGEgPSAoXG4gICAgdXNlclJlZ2lzdHJhdGlvbkRhdGE6IFVzZXJSZWdpc3RyYXRpb25EYXRhLFxuICApOiBWYWxpZGF0aW9uUmVzdWx0ID0+IHtcbiAgICBjb25zdCBzY2hlbWEgPSBKb2kub2JqZWN0KHtcbiAgICAgIG5hbWU6IEpvaS5zdHJpbmcoKVxuICAgICAgICAubWluKDMpXG4gICAgICAgIC5tYXgoNjQpXG4gICAgICAgIC50cmltKClcbiAgICAgICAgLnJlcXVpcmVkKCksXG4gICAgICBlbWFpbDogSm9pLnN0cmluZygpXG4gICAgICAgIC5lbWFpbCgpXG4gICAgICAgIC5tYXgoMTI4KVxuICAgICAgICAudHJpbSgpXG4gICAgICAgIC5yZXF1aXJlZCgpLFxuICAgICAgcGFzc3dvcmQ6IEpvaS5zdHJpbmcoKVxuICAgICAgICAubWluKDYpXG4gICAgICAgIC5tYXgoMjU2KVxuICAgICAgICAucmVxdWlyZWQoKSxcbiAgICB9KTtcblxuICAgIHJldHVybiBzY2hlbWEudmFsaWRhdGUodXNlclJlZ2lzdHJhdGlvbkRhdGEpO1xuICB9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdXNlclJlZ2lzdHJhdGlvbkRhdGEgLSBlbWFpbCwgcGFzc3dvcmRcbiAgICogQHJldHVybnMgVmFsaWRhdGlvblJlc3VsdCB3aXRoIGVycm9yIG1lc3NhZ2VcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVMb2dpbkRhdGEgPSAoXG4gICAgdXNlclJlZ2lzdHJhdGlvbkRhdGE6IFVzZXJMb2dpbkRhdGEsXG4gICk6IFZhbGlkYXRpb25SZXN1bHQgPT4ge1xuICAgIGNvbnN0IHNjaGVtYSA9IEpvaS5vYmplY3Qoe1xuICAgICAgZW1haWw6IEpvaS5zdHJpbmcoKVxuICAgICAgICAuZW1haWwoKVxuICAgICAgICAubWF4KDEyOClcbiAgICAgICAgLnRyaW0oKVxuICAgICAgICAucmVxdWlyZWQoKSxcbiAgICAgIHBhc3N3b3JkOiBKb2kuc3RyaW5nKClcbiAgICAgICAgLm1pbig2KVxuICAgICAgICAubWF4KDI1NilcbiAgICAgICAgLnJlcXVpcmVkKCksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gc2NoZW1hLnZhbGlkYXRlKHVzZXJSZWdpc3RyYXRpb25EYXRhKTtcbiAgfTtcblxuICAvKipcbiAgICogVGhpcyBmdW5jdGlvbiBoZWxwcyBpbiBhdHRlc3RpbmcgXCJzaWRcIiBjb29raWUgdGhhdCB0ZWxscyB0aGUgc2Vzc2lvbi1JRCBhcyBpdCBpcyBzdG9yZWQgaW4gcmVkaXMgY2FjaGVcbiAgICogU2lkIGlzIGFsc28gYXR0YWNoZWQgdG8gZXZlcnkgcmVxdWVzdCB0aGVyZWFmdGVyLiBIZW5jZSwgcGVyc2lzdGluZyB0aGUgbG9naW5cbiAgICogQHBhcmFtIHJlcSAtIEV4cHJlc3MgcmVxdWVzdFxuICAgKiBAcGFyYW0gaWQgLSB1c2VySWRcbiAgICovXG4gIHByaXZhdGUgbG9naW5Vc2VyQnlQZXJzaXN0aW5nQ2FjaGUgPSAocmVxOiBSZXF1ZXN0LCBpZDogc3RyaW5nKSA9PiB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICByZXEuc2Vzc2lvbiEub3NsYXNoQmVVc2VySWQgPSBpZDsgLy9zZXR0aW5nIHVzZXJJZCB0byBiZSBlcXVhbCB0byBpZFxuICB9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gcmVxIEV4cHJlc3MgcmVxdWVzdFxuICAgKiBAcGFyYW0gcmVzIEV4cHJlc3MgcmVzcG9uc2VcbiAgICogQHJldHVybnMgcmVzLnN0YXR1cy5qc29uKHsuLi59KVxuICAgKi9cbiAgcHVibGljIHJlZ2lzdGVyID0gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIC8qKlxuICAgICAqIHZhbGlkYXRpbmcgdXNlciByZWdpc3RyYXRpb24gZGF0YSBhbmQgc2FuaXRpemluZyB0aGUgcmVxIGJvZHlcbiAgICAgKi9cbiAgICBjb25zdCB1c2VyUmVnaXN0cmF0aW9uRGF0YTogVXNlclJlZ2lzdHJhdGlvbkRhdGEgPSByZXEuYm9keTtcblxuICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvcjpcbiAgICAgIHwgVmFsaWRhdGlvbkVycm9yXG4gICAgICB8IG51bGxcbiAgICAgIHwgdW5kZWZpbmVkID0gdGhpcy52YWxpZGF0ZVJlZ2lzdHJhdGlvbkRhdGEoXG4gICAgICB1c2VyUmVnaXN0cmF0aW9uRGF0YSxcbiAgICApLmVycm9yO1xuXG4gICAgLyoqXG4gICAgICogSWYgdGhlcmUgYXJlIG5vIHZhbGlkYXRpb24gZXJyb3JzLCByZWdpc3RlciB0aGUgdXNlclxuICAgICAqIEVsc2UsIG5vdGlmeSB2aWEgQVBJIHJlc3BvbnNlXG4gICAgICovXG4gICAgaWYgKHZhbGlkYXRpb25FcnJvcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IHZhbGlkYXRpb25FcnJvci5tZXNzYWdlLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBpZCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UucmVnaXN0ZXIoXG4gICAgICAgIHVzZXJSZWdpc3RyYXRpb25EYXRhLFxuICAgICAgKTtcblxuICAgICAgLy9sb2dnaW5nLWluIHRoZSB1c2VyIGluIGFmdGVyIHRoZSB1c2VyIGhhcyByZWdpc3RlcmVkXG4gICAgICB0aGlzLmxvZ2luVXNlckJ5UGVyc2lzdGluZ0NhY2hlKHJlcSwgaWQpO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVzZXJJZDogaWQsXG4gICAgICAgIH0sXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfSBjYXRjaCAoc2VydmljZUVycm9yKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGVycm9yLFxuICAgICAgICBjb2RlLFxuICAgICAgfTogU2VydmljZUVycm9yID0gc2VydmljZUVycm9yIGFzIFNlcnZpY2VFcnJvcjtcblxuICAgICAgLyoqXG4gICAgICAgKiBVc2luZyB0aGUgcmVzcG9uc2UgY29kZSByZWNpZXZlZCBmcm9tIEF1dGhTZXJ2aWNlXG4gICAgICAgKi9cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKGNvZGUpLmpzb24oe1xuICAgICAgICBlcnJvcixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSByZXEgRXhwcmVzcyByZXF1ZXN0XG4gICAqIEBwYXJhbSByZXMgRXhwcmVzcyByZXNwb25zZVxuICAgKiBAcmV0dXJucyByZXMuc3RhdHVzLmpzb24gLSBtZXNzYWdlIHRvIGJlIHNlbnQgYmFjayBmcm9tIHRoZSBBUElcbiAgICovXG4gIHB1YmxpYyBsb2dpbiA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICBjb25zdCB1c2VyTG9naW5EYXRhOiBVc2VyTG9naW5EYXRhID0gcmVxLmJvZHk7XG5cbiAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3I6XG4gICAgICB8IFZhbGlkYXRpb25FcnJvclxuICAgICAgfCBudWxsXG4gICAgICB8IHVuZGVmaW5lZCA9IHRoaXMudmFsaWRhdGVMb2dpbkRhdGEodXNlckxvZ2luRGF0YSkuZXJyb3I7XG5cbiAgICBpZiAoIXZhbGlkYXRpb25FcnJvcikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlcjogVXNlcldpdGhvdXRQYXNzd29yZCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UubG9naW4oXG4gICAgICAgICAgdXNlckxvZ2luRGF0YSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLy0tbG9naW4gbG9naWMtLVxuICAgICAgICB0aGlzLmxvZ2luVXNlckJ5UGVyc2lzdGluZ0NhY2hlKHJlcSwgdXNlci5pZCk7XG5cbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgICBkYXRhOiB1c2VyLFxuICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG5cbiAgICAgICAgLy8tLXJlcXVlc3QgcmVzcG9uc2UtLVxuICAgICAgfSBjYXRjaCAoc2VydmljZUVycm9yKSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICBjb2RlLFxuICAgICAgICB9OiBTZXJ2aWNlRXJyb3IgPSBzZXJ2aWNlRXJyb3IgYXMgU2VydmljZUVycm9yO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2luZyB0aGUgcmVzcG9uc2UgY29kZSByZWNpZXZlZCBmcm9tIEF1dGhTZXJ2aWNlXG4gICAgICAgICAqL1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhjb2RlKS5qc29uKHtcbiAgICAgICAgICBlcnJvcixcbiAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgIGVycm9yOiB2YWxpZGF0aW9uRXJyb3IubWVzc2FnZSxcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSByZXEgRXhwcmVzcyByZXF1ZXN0XG4gICAqIEBwYXJhbSByZXMgRXhwcmVzcyBzZXNzaW9uXG4gICAqIEByZXR1cm5zIEEgcHJvbWlzZSB0byB0ZWxsIGlmIHRoZSBjb29raWUgaGFzIGJlZW4gY2xlYXJlZCBvciBub3RcbiAgICovXG4gIHB1YmxpYyBsb2dvdXQgPSAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgLyoqXG4gICAgICogRGVsZXRpbmcgdGhlIHNlc3Npb24gYW5kIHRodXMsIHRoZSBjb3JyZXNwb25kaW5nIGNvb2tpZVxuICAgICAqL1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgcmVxLnNlc3Npb24hLmRlc3Ryb3koZXJyID0+IHtcbiAgICAgIGlmICghZXJyKSB7XG4gICAgICAgIHJlcy5jbGVhckNvb2tpZShTRVNTSU9OX05BTUUpO1xuICAgICAgICAvKipcbiAgICAgICAgICogU2VuZGluZyBiYWNrIHRoZSByZXNwb25zZSBpZiB0aGUgdXNlciBpcyBzdWNjZXNzZnVsbHkgbG9nZ2VkLW91dFxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgICBkYXRhOiBcIkxvZ2dlZC1vdXQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAzKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwiV2Ugd2VyZSBub3QgYWJsZSB0byBsb2cgeW91IG91dFwiLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gIHB1YmxpYyBpc0xvZ2dlZEluID0gKHJlcTogUmVxdWVzdCkgPT4gISFyZXEuc2Vzc2lvbiEub3NsYXNoQmVVc2VySWQ7IC8vaWYgdGhlIHVzZXJJZCBpcyBub3QgcHJlc2VudFxufVxuXG5leHBvcnQgZGVmYXVsdCBBdXRoQ29udHJvbGxlcjtcbiIsImltcG9ydCB7IE5leHRGdW5jdGlvbiwgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IEF1dGhDb250cm9sbGVyIGZyb20gXCIuLi8uLi9jb250cm9sbGVycy9hdXRoL2F1dGguY29udHJvbGxlclwiO1xuaW1wb3J0IHsgR2VuZXJhbEFwaVJlc3BvbnNlIH0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXNcIjtcblxuZXhwb3J0IGNvbnN0IGlzTG9nZ2VkSW4gPSAoXG4gIHJlcTogUmVxdWVzdCxcbiAgcmVzOiBSZXNwb25zZSxcbiAgbmV4dDogTmV4dEZ1bmN0aW9uLFxuKSA9PiB7XG4gIGNvbnN0IGF1dGhDb250cm9sbGVyID0gbmV3IEF1dGhDb250cm9sbGVyKCk7XG5cbiAgLyoqXG4gICAqIElmIGEgY29va2llIGlzIGFscmVhZHkgYXR0YWNoZWQgdG8gdGhlIHJlcXVlc3QsIHRoYXQgbWVhbnNcbiAgICogdGhlIHVzZXIgaXMgYWxyZWFkeSBsb2dnZWQgaW5cbiAgICovXG4gIGlmIChhdXRoQ29udHJvbGxlci5pc0xvZ2dlZEluKHJlcSkpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDYpLmpzb24oe1xuICAgICAgZXJyb3I6IFwiWW91IGFyZSBhbHJlYWR5IGxvZ2dlZC1pblwiLFxuICAgICAgZGF0YTogbnVsbCxcbiAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gIH1cblxuICBuZXh0KCk7XG59O1xuXG4vL21pZGRsZXdhcmUgZm9yIGF1dGhlbnRpY2F0ZWQgcmVxdWVzdHNcbmV4cG9ydCBjb25zdCBub3RMb2dnZWRJbiA9IChcbiAgcmVxOiBSZXF1ZXN0LFxuICByZXM6IFJlc3BvbnNlLFxuICBuZXh0OiBOZXh0RnVuY3Rpb24sXG4pID0+IHtcbiAgY29uc3QgYXV0aENvbnRyb2xsZXIgPSBuZXcgQXV0aENvbnRyb2xsZXIoKTtcblxuICBpZiAoIWF1dGhDb250cm9sbGVyLmlzTG9nZ2VkSW4ocmVxKSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNikuanNvbih7XG4gICAgICBlcnJvcjogXCJZb3UgbXVzdCBiZSBsb2dnZWQtaW4gdG8gYWNjZXNzIHRoaXMgcmVzb3VyY2VcIixcbiAgICAgIGRhdGE6IG51bGwsXG4gICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICB9XG5cbiAgbmV4dCgpO1xufTtcbiIsImltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IEF1dGhDb250cm9sbGVyIGZyb20gXCIuLi8uLi9jb250cm9sbGVycy9hdXRoL2F1dGguY29udHJvbGxlclwiO1xuaW1wb3J0IHsgR2VuZXJhbEFwaVJlc3BvbnNlIH0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXNcIjtcbmltcG9ydCB7XG4gIGlzTG9nZ2VkSW4sXG4gIG5vdExvZ2dlZEluLFxufSBmcm9tIFwiLi4vLi4vbWlkZGxld2FyZXMvYXV0aC9hdXRoLm1pZGRsZXdhcmVcIjtcblxuY2xhc3MgQXV0aFJvdXRlIHtcbiAgcHJpdmF0ZSBwYXRoOiBzdHJpbmcgPSBcIi9cIjtcbiAgcHVibGljIHJvdXRlcjogUm91dGVyO1xuICBwcml2YXRlIGF1dGhDb250cm9sbGVyO1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLnJvdXRlciA9IFJvdXRlcigpO1xuICAgIHRoaXMuYXV0aENvbnRyb2xsZXIgPSBuZXcgQXV0aENvbnRyb2xsZXIoKTtcblxuICAgIC8vaW5pdGlhbGl6aW5nIGFsbCB0aGUgYXV0aGVudGljYXRpb24gcm91dGVzXG4gICAgdGhpcy5pbml0aWFsaXplUm91dGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVJvdXRlID0gKCk6IHZvaWQgPT4ge1xuICAgIC8vYmFzZSByb3V0ZSB0byBjaGVjayByb3V0ZSBoZWFsdGhcbiAgICB0aGlzLnJvdXRlci5nZXQoYCR7dGhpcy5wYXRofWAsIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIGRhdGE6IFwiVXNlciBhdXRoIHJvdXRlIGhlYWx0aHlcIixcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9KTtcblxuICAgIC8vcG9zdCByb3V0ZSB0byByZWdpc3RlciB0aGUgdXNlclxuICAgIHRoaXMucm91dGVyLnBvc3QoXG4gICAgICBgJHt0aGlzLnBhdGh9cmVnaXN0ZXJgLFxuICAgICAgaXNMb2dnZWRJbixcbiAgICAgIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgLy9yZXF1ZXN0IGZvcndhcmRpbmcgdG8gaGFuZGxlIHRoZSByZXF1ZXN0IGVsZW1lbnRzIGluIHRoZSBBdXRoQ29udHJvbGxlclxuICAgICAgICB0aGlzLmF1dGhDb250cm9sbGVyLnJlZ2lzdGVyKHJlcSwgcmVzKTtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIC8vcG9zdCByb3V0ZSB0byBsb2dpbiB0aGUgdXNlclxuICAgIHRoaXMucm91dGVyLnBvc3QoXG4gICAgICBgJHt0aGlzLnBhdGh9bG9naW5gLFxuICAgICAgaXNMb2dnZWRJbiwgLy9hdHRhY2hpbmcgYSBtaWRkbGV3YXJlIHdpdGggdGhlIGxvZ2luIHJlcXVlc3QgdGhhdCB3b3VsZCBwcmV2ZW50IHVzZXIgZnJvbSBjcmVhdGluZyBtdWx0aXBsZSBzZXNzaW9uc1xuICAgICAgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICAvL3JlcXVlc3QgZm9yd2FyZGluZyB0byBoYW5kbGUgdGhlIHJlcXVlc3QgZWxlbWVudHMgaW4gdGhlIEF1dGhDb250cm9sbGVyXG5cbiAgICAgICAgdGhpcy5hdXRoQ29udHJvbGxlci5sb2dpbihyZXEsIHJlcyk7XG4gICAgICB9LFxuICAgICk7XG5cbiAgICAvL2dldCByb3V0ZSB0byBsb2dvdXQgdGhlIHVzZXJcbiAgICB0aGlzLnJvdXRlci5nZXQoXG4gICAgICBgJHt0aGlzLnBhdGh9bG9nb3V0YCxcbiAgICAgIG5vdExvZ2dlZEluLCAvL2F0dGFjaGluZyBhIG1pZGRsZXdhcmUgd2l0aCB0aGUgbG9nb3V0IHRoYXQgd291bGQgcHJldmVudCBsb2dvdXQgaWYgbm90IGxvZ2dlZC1pblxuICAgICAgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICAvL3JlcXVlc3QgZm9yd2FyZGluZyB0byBoYW5kbGUgdGhlIHJlcXVlc3QgZWxlbWVudHMgaW4gdGhlIEF1dGhDb250cm9sbGVyXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy5hdXRoQ29udHJvbGxlci5sb2dvdXQocmVxLCByZXMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMykuanNvbih7XG4gICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICk7XG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IEF1dGhSb3V0ZTtcbiIsIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24gKi9cbi8qIGVzbGludC1kaXNhYmxlIGNhbWVsY2FzZSAqL1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50LCBTaG9ydGN1dCB9IGZyb20gXCJAcHJpc21hL2NsaWVudFwiO1xuaW1wb3J0IHtcbiAgU2VhcmNoU2hvcnRjdXRPcHRpb25zLFxuICBTZXJ2aWNlRXJyb3IsXG4gIFNob3J0Y3V0RGF0YSxcbiAgU29ydGluZ09wdGlvbnMsXG4gIFNvcnRpbmdPcmRlcnMsXG59IGZyb20gXCIuLi8uLi9pbnRlcmZhY2VzXCI7XG5pbXBvcnQgcHJpc21hQ2xpZW50IGZyb20gXCIuLi8uLi91dGlscy9wcmlzbWEudXRpbFwiO1xuXG5jbGFzcyBTaG9ydGN1dFNlcnZpY2Uge1xuICBwcml2YXRlIHByaXNtYTogUHJpc21hQ2xpZW50O1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLnByaXNtYSA9IHByaXNtYUNsaWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSBzaG9ydGxpbmtcbiAgICogQHJldHVybnNcbiAgICovXG4gIHB1YmxpYyBzZWFyY2hTaG9ydGN1dEJ5U2hvcnRsaW5rID0gKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHNob3J0bGluazogc3RyaW5nLFxuICApID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8U2hvcnRjdXQgfCBudWxsPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHNob3J0Y3V0OiBTaG9ydGN1dCB8IG51bGwgPSBhd2FpdCB0aGlzLnByaXNtYS5zaG9ydGN1dC5maW5kVW5pcXVlKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2VcbiAgICAgICAgICAgICAgICBzaG9ydGxpbmtfdXNlcklkOiB7XG4gICAgICAgICAgICAgICAgICBzaG9ydGxpbmssXG4gICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHJldHVybiByZXNvbHZlKHNob3J0Y3V0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHNob3J0Y3V0RGF0YVxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBwdWJsaWMgYWRkU2hvcnRjdXQgPSAoXG4gICAgc2hvcnRjdXREYXRhOiBTaG9ydGN1dERhdGEsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICkgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogY2hlY2sgaWYgdGhlIHNob3J0Y3V0IGlzIGFscmVhZHkgYXZhaWxhYmxlIGZvciB0aGF0IHBhcnRpY3VsYXIgdXNlciBvciBub3RcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBjb25zdCBzaG9ydGN1dEZyb21TaG9ydGxpbms6IFNob3J0Y3V0IHwgbnVsbCA9IGF3YWl0IHRoaXMuc2VhcmNoU2hvcnRjdXRCeVNob3J0bGluayhcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHNob3J0Y3V0RGF0YS5zaG9ydGxpbmssXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmIChzaG9ydGN1dEZyb21TaG9ydGxpbmspIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3Qoe1xuICAgICAgICAgICAgICBlcnJvcjogXCJUaGlzIHNob3J0Y3V0IGFscmVhZHkgZXhpc3RzXCIsXG4gICAgICAgICAgICAgIGNvZGU6IDQwNixcbiAgICAgICAgICAgIH0gYXMgU2VydmljZUVycm9yKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBhZGRpbmcgYSBuZXcgc2hvcnRjdXQgaWYgdGhlIG5vIHNob3J0Y3V0IHdhcyBmb3VuZFxuICAgICAgICAgICAqL1xuICAgICAgICAgIGF3YWl0IHRoaXMucHJpc21hLnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIGlkOiB1c2VySWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBzaG9ydGN1dHM6IHtcbiAgICAgICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgIC4uLnNob3J0Y3V0RGF0YSxcbiAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICogSW5pdGlhbGlzaW5nIHZpc2l0cyB3aXRoIDAgYXQgdGhlIHRpbWUgb2YgY3JlYXRpb25cbiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgdmlzaXRzOiAwLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoc2hvcnRjdXREYXRhLnNob3J0bGluayk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdCh7XG4gICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgIGNvZGU6IDUwMyxcbiAgICAgICAgICB9IGFzIFNlcnZpY2VFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIExpc3QgYWxsIHRoZSB1c2VyIHNob3J0Y3V0cyB3aXRoIHRoZSBvcHRpb25hbCBzb3J0aW5nIGZpbHRlcnNcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gc29ydEJ5XG4gICAqIEBwYXJhbSBvcmRlckJ5XG4gICAqL1xuICBwdWJsaWMgbGlzdFNob3J0Y3V0cyA9IChcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBzb3J0Qnk6IFNvcnRpbmdPcHRpb25zLFxuICAgIG9yZGVyQnk6IFNvcnRpbmdPcmRlcnMgPSBcImFzY1wiLFxuICApID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8U2hvcnRjdXRbXSB8IFtdIHwgbnVsbD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBTb3J0aW5nIGJhc2VkIG9uIHRoZSBvcHRpb25zIHByb3ZpZGVkXG4gICAgICAgICAgICovXG4gICAgICAgICAgY29uc3Qgc2hvcnRjdXRzOlxuICAgICAgICAgICAgfCBTaG9ydGN1dFtdXG4gICAgICAgICAgICB8IFtdID0gYXdhaXQgdGhpcy5wcmlzbWEuc2hvcnRjdXQuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICAgICAgW3NvcnRCeV06IG9yZGVyQnksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKHNob3J0Y3V0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3Qoe1xuICAgICAgICAgICAgICBlcnJvcjogXCJObyBzaG9ydGN1dHMgZm9yIHRoaXMgdXNlciBjb3VsZCBiZSBmb3VuZFwiLFxuICAgICAgICAgICAgICBjb2RlOiA0MDQsXG4gICAgICAgICAgICB9IGFzIFNlcnZpY2VFcnJvcik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoc2hvcnRjdXRzKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KHtcbiAgICAgICAgICAgIGVycm9yLFxuICAgICAgICAgICAgY29kZTogNTAzLFxuICAgICAgICAgIH0gYXMgU2VydmljZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gc2hvcnRsaW5rXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBwdWJsaWMgZGVsZXRlU2hvcnRjdXQgPSAodXNlcklkOiBzdHJpbmcsIHNob3J0bGluazogc3RyaW5nKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBVc2VycyBzaG91bGQgb25seSBiZSBhYmxlIHRvIGRlbGV0ZSB0aGVpciBvd24gc2hvdGN1dHNcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBjb25zdCBzaG9ydGN1dDogU2hvcnRjdXQgfCBudWxsID0gYXdhaXQgdGhpcy5zZWFyY2hTaG9ydGN1dEJ5U2hvcnRsaW5rKFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgc2hvcnRsaW5rLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBVc2VycyBjYW4ndCBkZWxldGUgYSBzaG90Y3V0IHRoYXQgaXMgbm90IHByZXNlbnRcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBpZiAoIXNob3J0Y3V0KSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KHtcbiAgICAgICAgICAgICAgZXJyb3I6XG4gICAgICAgICAgICAgICAgXCJUaGUgcmVxdWVzdGVkIGRvZXNuJ3QgZXhpc3QgYW5kIGhlbmNlIGNhbid0IGJlIGRlbGV0ZWRcIixcbiAgICAgICAgICAgICAgY29kZTogNDA2LFxuICAgICAgICAgICAgfSBhcyBTZXJ2aWNlRXJyb3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIERlbGV0aW5nIGEgc2hvcnRjdXQgdXBvbiByZXF1ZXN0XG4gICAgICAgICAgICovXG4gICAgICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuc2hvcnRjdXQuZGVsZXRlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIHNob3J0bGlua191c2VySWQ6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgc2hvcnRsaW5rLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHJldHVybiByZXNvbHZlKHNob3J0bGluayk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdCh7XG4gICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgIGNvZGU6IDUwMyxcbiAgICAgICAgICB9IGFzIFNlcnZpY2VFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICogQHBhcmFtIHNlYXJjaE9wdGlvbnNcbiAgICogQHJldHVybnNcbiAgICovXG4gIHB1YmxpYyBzZWFyY2hTaG9ydGN1dHMgPSAoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgc2VhcmNoT3B0aW9uczogU2VhcmNoU2hvcnRjdXRPcHRpb25zLFxuICApID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8U2hvcnRjdXRbXSB8IG51bGw+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogQ29sbGVjdGluZyBhbGwgdGhlIHNob3J0Y3V0cyBvZiBhIHBhcnRpY3VsYXIgdXNlclxuICAgICAgICAgICAqIFJlZHVjZSBkYXRhYmFzZSBjYWxscyBmb3Igb3B0aW1pc2F0aW9uXG4gICAgICAgICAgICovXG4gICAgICAgICAgbGV0IHNob3J0Y3V0czpcbiAgICAgICAgICAgIHwgU2hvcnRjdXRbXVxuICAgICAgICAgICAgfCBudWxsID0gYXdhaXQgdGhpcy5wcmlzbWEuc2hvcnRjdXQuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmIChzaG9ydGN1dHMubGVuZ3RoID09IDAgfHwgIXNob3J0Y3V0cykge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdCh7XG4gICAgICAgICAgICAgIGVycm9yOiBcIk5vIHNob3J0Y3V0IGZvciB0aGlzIHVzZXIgY291bGQgYmUgZm91bmRcIixcbiAgICAgICAgICAgICAgY29kZTogNDA0LFxuICAgICAgICAgICAgfSBhcyBTZXJ2aWNlRXJyb3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIEZpbHRlcmluZyBzaG9ydGN1dCB0aGF0IGNvbnRhaW5zIHRoZSBnaXZlbiBzdHJpbmcgZnJvbSBzaG9ydGxpbmtcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBpZiAoc2VhcmNoT3B0aW9uc1tcInNob3J0bGlua1wiXSkge1xuICAgICAgICAgICAgc2hvcnRjdXRzID0gc2hvcnRjdXRzLmZpbHRlcihzaG9ydGN1dCA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgc2hvcnRjdXQuc2hvcnRsaW5rLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcbiAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICAgICAgICBzZWFyY2hPcHRpb25zW1wic2hvcnRsaW5rXCJdIS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICkgIT09IC0xXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBGaWx0ZXJpbmcgdmlzaWJpbGl0eSBiZXR3ZWVuIFdvcmtzcGFjZSBvciBQcml2YXRlXG4gICAgICAgICAgICovXG4gICAgICAgICAgaWYgKHNlYXJjaE9wdGlvbnNbXCJ2aXNpYmlsaXR5XCJdKSB7XG4gICAgICAgICAgICBzaG9ydGN1dHMgPSBzaG9ydGN1dHMuZmlsdGVyKHNob3J0Y3V0ID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICBzaG9ydGN1dC52aXNpYmlsaXR5LnRvTG93ZXJDYXNlKCkgPT09XG4gICAgICAgICAgICAgICAgc2VhcmNoT3B0aW9uc1tcInZpc2liaWxpdHlcIl0/LnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIEZpbHRlcnRpbmcgZnJvbSB0aGUgdGFnc1xuICAgICAgICAgICAqL1xuICAgICAgICAgIGlmIChzZWFyY2hPcHRpb25zW1widGFnXCJdKSB7XG4gICAgICAgICAgICBzaG9ydGN1dHMgPSBzaG9ydGN1dHMuZmlsdGVyKHNob3J0Y3V0ID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHNob3J0Y3V0LnRhZ3MuaW5jbHVkZXMoc2VhcmNoT3B0aW9uc1tcInRhZ1wiXSEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogRmlsdGVyaW5nIHNob3J0Y3V0IHRoYXQgY29udGFpbnMgdGhlIGdpdmVuIHN0cmluZyBmcm9tIHVybFxuICAgICAgICAgICAqL1xuICAgICAgICAgIGlmIChzZWFyY2hPcHRpb25zW1widXJsXCJdKSB7XG4gICAgICAgICAgICBzaG9ydGN1dHMgPSBzaG9ydGN1dHMuZmlsdGVyKHNob3J0Y3V0ID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICBzaG9ydGN1dC51cmwudG9Mb3dlckNhc2UoKS5pbmRleE9mKFxuICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgICAgICAgICAgICAgIHNlYXJjaE9wdGlvbnNbXCJ1cmxcIl0hLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgKSAhPT0gLTFcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIENoZWNraW5nIGFnYWluc3QgdW5kZWZpbmVkIGJlY2F1c2Ugb2YgMCBjYXNlXG4gICAgICAgICAgICogaWYgMCBpcyBwYXNzZWQgYnkgdGhlIHVzZXIsIGl0IHdpbGwgYWxzbyBnaXZlIGZhbHNlXG4gICAgICAgICAgICovXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgc2VhcmNoT3B0aW9uc1tcInZpc2l0c0xvd1wiXSAhPSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgIHNlYXJjaE9wdGlvbnNbXCJ2aXNpdHNIaWdoXCJdICE9IHVuZGVmaW5lZFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgc2hvcnRjdXRzID0gc2hvcnRjdXRzLmZpbHRlcihzaG9ydGN1dCA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgc2hvcnRjdXQudmlzaXRzID49IHNlYXJjaE9wdGlvbnNbXCJ2aXNpdHNMb3dcIl0hICYmXG4gICAgICAgICAgICAgICAgc2hvcnRjdXQudmlzaXRzIDw9IHNlYXJjaE9wdGlvbnNbXCJ2aXNpdHNIaWdoXCJdIVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogSWYgdmlzaXRzTG93IGlzIHN1cHBsaWVkIGJ1dCBub3QgdmlzaXRzSGlnaCwgZ2l2ZSBhbGwgdGhlIHZhbHVlcyBncmVhdGVyXG4gICAgICAgICAgICovXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgc2VhcmNoT3B0aW9uc1tcInZpc2l0c0xvd1wiXSAhPSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgIHNlYXJjaE9wdGlvbnNbXCJ2aXNpdHNIaWdoXCJdID09IHVuZGVmaW5lZFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgc2hvcnRjdXRzID0gc2hvcnRjdXRzLmZpbHRlcihzaG9ydGN1dCA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBzaG9ydGN1dC52aXNpdHMgPj0gc2VhcmNoT3B0aW9uc1tcInZpc2l0c0xvd1wiXSE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBJZiB2aXNpdHNIaWcgaXMgc3VwcGxpZWQgYnV0IG5vdCB2aXNpdHNMb3csIGdpdmUgYWxsIHRoZSB2YWx1ZXMgc21hbGxlclxuICAgICAgICAgICAqL1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHNlYXJjaE9wdGlvbnNbXCJ2aXNpdHNMb3dcIl0gPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICBzZWFyY2hPcHRpb25zW1widmlzaXRzSGlnaFwiXSAhPSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHNob3J0Y3V0cyA9IHNob3J0Y3V0cy5maWx0ZXIoc2hvcnRjdXQgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gc2hvcnRjdXQudmlzaXRzIDw9IHNlYXJjaE9wdGlvbnNbXCJ2aXNpdHNIaWdoXCJdITtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChzaG9ydGN1dHMubGVuZ3RoID09IDAgfHwgIXNob3J0Y3V0cykge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdCh7XG4gICAgICAgICAgICAgIGVycm9yOiBcIk5vIHNob3J0Y3V0IGZvciB0aGlzIHNlYXJjaCBjb3VsZCBiZSBmb3VuZFwiLFxuICAgICAgICAgICAgICBjb2RlOiA0MDQsXG4gICAgICAgICAgICB9IGFzIFNlcnZpY2VFcnJvcik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHNob3J0Y3V0cy5sZW5ndGggPT0gMCB8fCAhc2hvcnRjdXRzKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KHtcbiAgICAgICAgICAgICAgZXJyb3I6IFwiTm8gc2hvcnRjdXQgZm9yIHRoaXMgc2VhcmNoIGNvdWxkIGJlIGZvdW5kXCIsXG4gICAgICAgICAgICAgIGNvZGU6IDQwNCxcbiAgICAgICAgICAgIH0gYXMgU2VydmljZUVycm9yKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShzaG9ydGN1dHMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHJldHVybiByZWplY3Qoe1xuICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICBjb2RlOiA1MDMsXG4gICAgICAgICAgfSBhcyBTZXJ2aWNlRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSBzaG9ydGxpbmtcbiAgICogQHJldHVybnNcbiAgICovXG4gIHB1YmxpYyBnZXRVcmxGcm9tU2hvcnRsaW5rID0gKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHNob3J0bGluazogc3RyaW5nLFxuICApID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHNob3J0Y3V0OiBTaG9ydGN1dCB8IG51bGwgPSBhd2FpdCB0aGlzLnNlYXJjaFNob3J0Y3V0QnlTaG9ydGxpbmsoXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICBzaG9ydGxpbmssXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmICghc2hvcnRjdXQpIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3Qoe1xuICAgICAgICAgICAgICBlcnJvcjogYCR7c2hvcnRsaW5rfSBzaG9ydGxpbmsgY291bGQgbm90IGJlIGZvdW5kYCxcbiAgICAgICAgICAgICAgY29kZTogNDA0LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogSWYgdGhlIGhpdCBoYXMgYmVlbiBzdWNjZXNzZnVsLCB1cGRhdGUgdGhlIHZpc2l0IGNvdW50ZXJcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBhd2FpdCB0aGlzLnByaXNtYS5zaG9ydGN1dC51cGRhdGUoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgc2hvcnRsaW5rX3VzZXJJZDoge1xuICAgICAgICAgICAgICAgIHNob3J0bGluayxcbiAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICB2aXNpdHM6IHtcbiAgICAgICAgICAgICAgICBpbmNyZW1lbnQ6IDEsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoc2hvcnRjdXQudXJsKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KHtcbiAgICAgICAgICAgIGVycm9yLFxuICAgICAgICAgICAgY29kZTogNTAzLFxuICAgICAgICAgIH0gYXMgU2VydmljZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgU2hvcnRjdXRTZXJ2aWNlO1xuIiwiaW1wb3J0IHsgU2hvcnRjdXQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCBKb2ksIHsgVmFsaWRhdGlvbkVycm9yLCBWYWxpZGF0aW9uUmVzdWx0IH0gZnJvbSBcImpvaVwiO1xuaW1wb3J0IHtcbiAgR2VuZXJhbEFwaVJlc3BvbnNlLFxuICBMaXN0U29ydGluZ1F1ZXJpZXMsXG4gIFNlYXJjaFNob3J0Y3V0T3B0aW9ucyxcbiAgU2VydmljZUVycm9yLFxuICBTaG9ydGN1dERhdGEsXG4gIFNob3J0Y3V0VmlzaWJpbGl0eSxcbn0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXNcIjtcbmltcG9ydCBTaG9ydGN1dFNlcnZpY2UgZnJvbSBcIi4uLy4uL3NlcnZpY2VzL3Nob3J0Y3V0cy9zaG9ydGN1dC5zZXJ2aWNlXCI7XG5cbmNsYXNzIFNob3J0Y3V0Q29udHJvbGxlciB7XG4gIHByaXZhdGUgc2hvcnRjdXRTZXJ2aWNlO1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLnNob3J0Y3V0U2VydmljZSA9IG5ldyBTaG9ydGN1dFNlcnZpY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gc2hvcnRjdXREYXRhXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlU2hvcnRjdXREYXRhID0gKFxuICAgIHNob3J0Y3V0RGF0YTogU2hvcnRjdXREYXRhLFxuICApOiBWYWxpZGF0aW9uUmVzdWx0ID0+IHtcbiAgICBjb25zdCBzY2hlbWEgPSBKb2kub2JqZWN0KHtcbiAgICAgIHNob3J0bGluazogSm9pLnN0cmluZygpXG4gICAgICAgIC50cmltKClcbiAgICAgICAgLnJlcXVpcmVkKCksXG4gICAgICB1cmw6IEpvaS5zdHJpbmcoKVxuICAgICAgICAudXJpKClcbiAgICAgICAgLnRyaW0oKVxuICAgICAgICAucmVxdWlyZWQoKSxcbiAgICAgIHZpc2liaWxpdHk6IEpvaS5zdHJpbmcoKVxuICAgICAgICAuYWxsb3coXCJXb3Jrc3BhY2VcIiwgXCJQcml2YXRlXCIpXG4gICAgICAgIC5vcHRpb25hbCgpLFxuICAgICAgZGVzY3JpcHRpb246IEpvaS5zdHJpbmcoKVxuICAgICAgICAudHJpbSgpXG4gICAgICAgIC5vcHRpb25hbCgpLFxuICAgICAgdGFnczogSm9pLm9wdGlvbmFsKCksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gc2NoZW1hLnZhbGlkYXRlKHNob3J0Y3V0RGF0YSk7XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB1cmxcbiAgICogQHJldHVybnNcbiAgICovXG4gIHByaXZhdGUgaXNVcmxXaGF0d2dDb21wbGlhbnQgPSAodXJsOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICBjb25zdCBwYXR0ZXJuOiBSZWdFeHAgPSBuZXcgUmVnRXhwKFxuICAgICAgL14oPzooPzpodHRwcz98ZnRwKTpcXC9cXC8pPyg/Oig/ISg/OjEwfDEyNykoPzpcXC5cXGR7MSwzfSl7M30pKD8hKD86MTY5XFwuMjU0fDE5MlxcLjE2OCkoPzpcXC5cXGR7MSwzfSl7Mn0pKD8hMTcyXFwuKD86MVs2LTldfDJcXGR8M1swLTFdKSg/OlxcLlxcZHsxLDN9KXsyfSkoPzpbMS05XVxcZD98MVxcZFxcZHwyWzAxXVxcZHwyMlswLTNdKSg/OlxcLig/OjE/XFxkezEsMn18MlswLTRdXFxkfDI1WzAtNV0pKXsyfSg/OlxcLig/OlsxLTldXFxkP3wxXFxkXFxkfDJbMC00XVxcZHwyNVswLTRdKSl8KD86KD86W2EtelxcdTAwYTEtXFx1ZmZmZjAtOV0tKikqW2EtelxcdTAwYTEtXFx1ZmZmZjAtOV0rKSg/OlxcLig/OlthLXpcXHUwMGExLVxcdWZmZmYwLTldLSopKlthLXpcXHUwMGExLVxcdWZmZmYwLTldKykqKD86XFwuKD86W2EtelxcdTAwYTEtXFx1ZmZmZl17Mix9KSkpKD86OlxcZHsyLDV9KT8oPzpcXC9cXFMqKT8kLyxcbiAgICApO1xuXG4gICAgcmV0dXJuIHBhdHRlcm4udGVzdCh1cmwpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAcGFyYW0gcmVxIEV4cHJlc3MgcmVxdWVzdFxuICAgKiBAcGFyYW0gcmVzIEV4cHJlc3MgcmVzcG9uc2VcbiAgICovXG4gIHB1YmxpYyBhZGRTaG9ydGN1dCA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICBsZXQgc2hvcnRjdXREYXRhOiBTaG9ydGN1dERhdGEgPSByZXEuYm9keTtcbiAgICBjb25zdCBzaG9ydGN1dFRhZ3M6IHN0cmluZ1tdIHwgdW5kZWZpbmVkID0gc2hvcnRjdXREYXRhW1widGFnc1wiXTtcbiAgICBjb25zdCB2aXNpYmlsaXR5OiBTaG9ydGN1dFZpc2liaWxpdHkgfCB1bmRlZmluZWQgPVxuICAgICAgc2hvcnRjdXREYXRhW1widmlzaWJpbGl0eVwiXTtcblxuICAgIC8qKlxuICAgICAqIElmIHRhZ3MgYXJlIG5vdCBmb3VuZCBpbiB0aGUgcmVxdWVzdCBib2R5LCBkZWZhdWx0IGl0IHRvIGFueSBlbXB0eSBhcnJheVxuICAgICAqL1xuICAgIGlmICghc2hvcnRjdXRUYWdzKSB7XG4gICAgICBzaG9ydGN1dERhdGEgPSB7IC4uLnNob3J0Y3V0RGF0YSwgdGFnczogW10gfSBhcyBTaG9ydGN1dERhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgdmlzaWJpbGl0eSBpcyBub3QgZm91bmQgaW4gdGhlIHJlcSBib2R5LCBkZWZhdWx0IGl0IHRvIFdvcmtzcGFjZVxuICAgICAqL1xuICAgIGlmICghdmlzaWJpbGl0eSkge1xuICAgICAgc2hvcnRjdXREYXRhID0ge1xuICAgICAgICAuLi5zaG9ydGN1dERhdGEsXG4gICAgICAgIHZpc2liaWxpdHk6IFwiV29ya3NwYWNlXCIsXG4gICAgICB9IGFzIFNob3J0Y3V0RGF0YTtcbiAgICB9XG5cbiAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3I6XG4gICAgICB8IFZhbGlkYXRpb25FcnJvclxuICAgICAgfCBudWxsXG4gICAgICB8IHVuZGVmaW5lZCA9IHRoaXMudmFsaWRhdGVTaG9ydGN1dERhdGEoc2hvcnRjdXREYXRhKS5lcnJvcjtcblxuICAgIGlmICh2YWxpZGF0aW9uRXJyb3IpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgIGVycm9yOiB2YWxpZGF0aW9uRXJyb3IubWVzc2FnZSxcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJZiBVUkwgaXMgbm90IFdIQVRXRyBjb21wbGlhbnQsIHdlIHJldHVyblxuICAgICAqL1xuICAgIGlmICghdGhpcy5pc1VybFdoYXR3Z0NvbXBsaWFudChzaG9ydGN1dERhdGEudXJsKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA2KS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwiVGhpcyBpcyBub3QgYSB2YWxpZCBVUkxcIixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgIGNvbnN0IHVzZXJJZDogc3RyaW5nID0gcmVxLnNlc3Npb24hLm9zbGFzaEJlVXNlcklkO1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDYpLmpzb24oe1xuICAgICAgICBlcnJvcjogXCJZb3UgbXVzdCBiZSBsb2dnZWQtaW4gdG8gYWNjZXNzIHRoaXMgcmVzb3VyY2VcIixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLyoqXG4gICAgICAgKiBUcnlpbmcgdG8gYWRkIHRoZSBzaG9ydGN1dCBpbiB0aGUgREJcbiAgICAgICAqL1xuICAgICAgY29uc3Qgc2hvcnR1cmwgPSBhd2FpdCB0aGlzLnNob3J0Y3V0U2VydmljZS5hZGRTaG9ydGN1dChcbiAgICAgICAgc2hvcnRjdXREYXRhLFxuICAgICAgICB1c2VySWQsXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG1lc3NhZ2U6IGAke3Nob3J0dXJsfSBoYXMgYmVlbiBhZGRlZCBzdWNjZXNzZnVsbHlgLFxuICAgICAgICB9LFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0gY2F0Y2ggKHNlcnZpY2VFcnJvcikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBlcnJvcixcbiAgICAgICAgY29kZSxcbiAgICAgIH06IFNlcnZpY2VFcnJvciA9IHNlcnZpY2VFcnJvciBhcyBTZXJ2aWNlRXJyb3I7XG5cbiAgICAgIC8qKlxuICAgICAgICogVXNpbmcgdGhlIHJlc3BvbnNlIGNvZGUgcmVjaWV2ZWQgZnJvbSBTaG9ydGN1dFNlcnZpY2VcbiAgICAgICAqL1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoY29kZSkuanNvbih7XG4gICAgICAgIGVycm9yLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHJlcVxuICAgKiBAcGFyYW0gcmVzXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBwdWJsaWMgbGlzdFNob3J0Y3V0cyA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgIGNvbnN0IHVzZXJJZDogc3RyaW5nID0gcmVxLnNlc3Npb24hLm9zbGFzaEJlVXNlcklkO1xuXG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgIGVycm9yOiBcIllvdSBhcmUgbm90IGF1dGhlbnRpY2F0ZWQgdG8gdXNlIHRoaXMgcmVzb3VyY2VcIixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXFRdWVyaWVzOiBMaXN0U29ydGluZ1F1ZXJpZXMgPSByZXEucXVlcnk7XG4gICAgbGV0IHsgb3JkZXJCeSwgc29ydEJ5IH0gPSByZXFRdWVyaWVzO1xuXG4gICAgLyoqXG4gICAgICogaWYgb25seSBvcmRlciBieSBpcyBwcmVzZW50XG4gICAgICovXG4gICAgaWYgKG9yZGVyQnkgJiYgIXNvcnRCeSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA2KS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwiUGxlYXNlIG1ha2Ugc3VyZSB0byB1c2Ugc29ydEJ5IHF1ZXJ5IHdpdGggb3JkZXJCeVwiLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlZmF1bHRpbmcgaXQgdG8gc2hvcnRsaW5rIGFzY2VuZGluZyBvcmRlclxuICAgICAqL1xuICAgIGlmICghc29ydEJ5KSB7XG4gICAgICBzb3J0QnkgPSBcInNob3J0bGlua1wiO1xuICAgIH1cbiAgICBpZiAoIW9yZGVyQnkpIHtcbiAgICAgIG9yZGVyQnkgPSBcImFzY1wiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNraW5nIGZvciB0aGUgY29ycmVjdG5lc3Mgb2YgcXVlcmllc1xuICAgICAqL1xuICAgIGNvbnN0IGFsbG93ZWRTb3J0QnlWYWx1ZXMgPSBbXG4gICAgICBcInNob3J0bGlua1wiLFxuICAgICAgXCJjcmVhdGVkQXRcIixcbiAgICAgIFwidXBkYXRlZEF0XCIsXG4gICAgICBcInZpc2l0c1wiLFxuICAgIF07XG4gICAgaWYgKCFhbGxvd2VkU29ydEJ5VmFsdWVzLmluY2x1ZGVzKHNvcnRCeSkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgIGVycm9yOlxuICAgICAgICAgICdBbGxvd2VkIHZhbHVlcyBmb3Igc29ydEJ5IGFyZSAtPiBcInNob3J0bGlua1wiLCBcImNyZWF0ZWRBdFwiLCBcInVwZGF0ZWRBdFwiLCBcInZpc2l0c1wiJyxcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICBjb25zdCBhbGxvd2VkT3JkZXJCeVZhbHVlcyA9IFtcImFzY1wiLCBcImRlc2NcIl07XG4gICAgaWYgKCFhbGxvd2VkT3JkZXJCeVZhbHVlcy5pbmNsdWRlcyhvcmRlckJ5KSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdBbGxvd2VkIHZhbHVlcyBmb3Igc29ydEJ5IGFyZSAtPiBcImFzY1wiIG9yIFwiZGVzY1wiJyxcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2hvcnRjdXRzOlxuICAgICAgICB8IFNob3J0Y3V0W11cbiAgICAgICAgfCBbXVxuICAgICAgICB8IG51bGwgPSBhd2FpdCB0aGlzLnNob3J0Y3V0U2VydmljZS5saXN0U2hvcnRjdXRzKFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHNvcnRCeSxcbiAgICAgICAgb3JkZXJCeSxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzaG9ydGN1dHMsXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0gY2F0Y2ggKHNlcnZpY2VFcnJvcikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBlcnJvcixcbiAgICAgICAgY29kZSxcbiAgICAgIH06IFNlcnZpY2VFcnJvciA9IHNlcnZpY2VFcnJvciBhcyBTZXJ2aWNlRXJyb3I7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKGNvZGUpLmpzb24oe1xuICAgICAgICBlcnJvcixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSByZXFcbiAgICogQHBhcmFtIHJlc1xuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgcHVibGljIGRlbGV0ZVNob3J0Y3V0ID0gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgY29uc3QgdXNlcklkOiBzdHJpbmcgPSByZXEuc2Vzc2lvbiEub3NsYXNoQmVVc2VySWQ7XG5cbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwiWW91IGFyZSBub3QgYXV0aGVudGljYXRlZCB0byB1c2UgdGhpcyByZXNvdXJjZVwiLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH1cblxuICAgIGNvbnN0IHsgc2hvcnRsaW5rIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghc2hvcnRsaW5rKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDYpLmpzb24oe1xuICAgICAgICBlcnJvcjogXCJQbGVhc2UgcHJvdmlkZSBhIHNob3J0bGluayB0byBiZSBkZWxldGVkXCIsXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2hvcnRjdXRTZXJ2aWNlLmRlbGV0ZVNob3J0Y3V0KHVzZXJJZCwgc2hvcnRsaW5rKTtcblxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgZGF0YTogYERlbGV0ZWQgdGhlIHNob3J0bGluayAke3Nob3J0bGlua30gc3VjY2Vzc2Z1bGx5YCxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfSBjYXRjaCAoc2VydmljZUVycm9yKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGVycm9yLFxuICAgICAgICBjb2RlLFxuICAgICAgfTogU2VydmljZUVycm9yID0gc2VydmljZUVycm9yIGFzIFNlcnZpY2VFcnJvcjtcblxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoY29kZSkuanNvbih7XG4gICAgICAgIGVycm9yLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIHZhbGlkYXRlU2VhcmNoQm9keSA9IChcbiAgICBzZWFyY2hPcHRpb25zOiBTZWFyY2hTaG9ydGN1dE9wdGlvbnMsXG4gICk6IFZhbGlkYXRpb25SZXN1bHQgPT4ge1xuICAgIGNvbnN0IHNjaGVtYSA9IEpvaS5vYmplY3Qoe1xuICAgICAgc2hvcnRsaW5rOiBKb2kuc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICAgIHVybDogSm9pLnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICB2aXNpYmlsaXR5OiBKb2kuc3RyaW5nKClcbiAgICAgICAgLmFsbG93KFwiV29ya3NwYWNlXCIsIFwiUHJpdmF0ZVwiKVxuICAgICAgICAub3B0aW9uYWwoKSxcbiAgICAgIHRhZzogSm9pLnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgICB2aXNpdHNMb3c6IEpvaS5udW1iZXIoKS5vcHRpb25hbCgpLFxuICAgICAgdmlzaXRzSGlnaDogSm9pLm51bWJlcigpLm9wdGlvbmFsKCksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gc2NoZW1hLnZhbGlkYXRlKHNlYXJjaE9wdGlvbnMpO1xuICB9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gcmVxXG4gICAqIEBwYXJhbSByZXNcbiAgICogQHJldHVybnNcbiAgICovXG4gIHB1YmxpYyBzZWFyY2hTaG9ydGN1dHMgPSBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICBjb25zdCB1c2VySWQ6IHN0cmluZyA9IHJlcS5zZXNzaW9uIS5vc2xhc2hCZVVzZXJJZDtcblxuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICBlcnJvcjogXCJZb3UgYXJlIG5vdCBhdXRoZW50aWNhdGVkIHRvIHVzZSB0aGlzIHJlc291cmNlXCIsXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2lsbCBnZXQgYWxsIHRoZSByZXN1bHRzIGlmIG5vIGJvZHkgaXMgcHJvdmlkZWRcbiAgICAgKi9cbiAgICBjb25zdCBzZWFyY2hPcHRpb25zOiBTZWFyY2hTaG9ydGN1dE9wdGlvbnMgPSByZXEuYm9keTtcbiAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3I6XG4gICAgICB8IFZhbGlkYXRpb25FcnJvclxuICAgICAgfCBudWxsXG4gICAgICB8IHVuZGVmaW5lZCA9IHRoaXMudmFsaWRhdGVTZWFyY2hCb2R5KHNlYXJjaE9wdGlvbnMpLmVycm9yO1xuXG4gICAgaWYgKHZhbGlkYXRpb25FcnJvcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IHZhbGlkYXRpb25FcnJvci5tZXNzYWdlLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzaG9ydGN1dHM6XG4gICAgICAgIHwgU2hvcnRjdXRbXVxuICAgICAgICB8IG51bGwgPSBhd2FpdCB0aGlzLnNob3J0Y3V0U2VydmljZS5zZWFyY2hTaG9ydGN1dHMoXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgc2VhcmNoT3B0aW9ucyxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzaG9ydGN1dHMsXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0gY2F0Y2ggKHNlcnZpY2VFcnJvcikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBlcnJvcixcbiAgICAgICAgY29kZSxcbiAgICAgIH06IFNlcnZpY2VFcnJvciA9IHNlcnZpY2VFcnJvciBhcyBTZXJ2aWNlRXJyb3I7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKGNvZGUpLmpzb24oe1xuICAgICAgICBlcnJvcixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG4gIH07XG5cbiAgcHVibGljIGdldFVybEZyb21TaG9ydGxpbmsgPSBhc3luYyAoXG4gICAgcmVxOiBSZXF1ZXN0LFxuICAgIHJlczogUmVzcG9uc2UsXG4gICkgPT4ge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgY29uc3QgdXNlcklkOiBzdHJpbmcgPSByZXEuc2Vzc2lvbiEub3NsYXNoQmVVc2VySWQ7XG5cbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwiWW91IGFyZSBub3QgYXV0aGVudGljYXRlZCB0byB1c2UgdGhpcyByZXNvdXJjZVwiLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH1cblxuICAgIGNvbnN0IHsgc2hvcnRsaW5rIH0gPSByZXEucGFyYW1zO1xuXG4gICAgaWYgKCEodHlwZW9mIHNob3J0bGluayA9PT0gXCJzdHJpbmdcIikpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNikuanNvbih7XG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgIGVycm9yOiBcIlBsZWFzZSBwYXNzIGluIGEgdmFsaWQgVVJMXCIsXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2hpbmcgdXJsIGZyb20gc2hvcnRsaW5rIC0gaW5jcmVtZW50IHRoZSBjb3VudFxuICAgICAqL1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1cmwgPSBhd2FpdCB0aGlzLnNob3J0Y3V0U2VydmljZS5nZXRVcmxGcm9tU2hvcnRsaW5rKFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHNob3J0bGluayxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1cmwsXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0gY2F0Y2ggKHNlcnZpY2VFcnJvcikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBlcnJvcixcbiAgICAgICAgY29kZSxcbiAgICAgIH06IFNlcnZpY2VFcnJvciA9IHNlcnZpY2VFcnJvciBhcyBTZXJ2aWNlRXJyb3I7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKGNvZGUpLmpzb24oe1xuICAgICAgICBlcnJvcixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9XG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNob3J0Y3V0Q29udHJvbGxlcjtcbiIsImltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBSb3V0ZXIgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IFNob3J0Y3V0Q29udHJvbGxlciBmcm9tIFwiLi4vLi4vY29udHJvbGxlcnMvc2hvcnRjdXRzL3Nob3J0Y3V0cy5jb250cm9sbGVyXCI7XG5pbXBvcnQgeyBHZW5lcmFsQXBpUmVzcG9uc2UgfSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHsgbm90TG9nZ2VkSW4gfSBmcm9tIFwiLi4vLi4vbWlkZGxld2FyZXMvYXV0aC9hdXRoLm1pZGRsZXdhcmVcIjtcblxuY2xhc3MgU2hvcnRjdXRSb3V0ZSB7XG4gIHByaXZhdGUgc2hvcnRjdXRDb250b2xsZXI6IFNob3J0Y3V0Q29udHJvbGxlcjtcbiAgcHJpdmF0ZSBwYXRoOiBzdHJpbmcgPSBcIi9cIjtcbiAgcHVibGljIHJvdXRlcjogUm91dGVyO1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLnJvdXRlciA9IFJvdXRlcigpO1xuICAgIHRoaXMuc2hvcnRjdXRDb250b2xsZXIgPSBuZXcgU2hvcnRjdXRDb250cm9sbGVyKCk7XG4gICAgdGhpcy5pbml0aWFsaXplUm91dGVzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVSb3V0ZXMgPSAoKTogdm9pZCA9PiB7XG4gICAgdGhpcy5yb3V0ZXIuZ2V0KGAke3RoaXMucGF0aH1gLCAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICBkYXRhOiBcIlNob3J0Y3V0IHJvdXRlIGlzIGhlYWx0aHlcIixcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9KTtcblxuICAgIHRoaXMucm91dGVyLnBvc3QoXG4gICAgICBgJHt0aGlzLnBhdGh9YWRkYCxcbiAgICAgIG5vdExvZ2dlZEluLFxuICAgICAgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICB0aGlzLnNob3J0Y3V0Q29udG9sbGVyLmFkZFNob3J0Y3V0KHJlcSwgcmVzKTtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHRoaXMucm91dGVyLmdldChcbiAgICAgIGAke3RoaXMucGF0aH1vLzpzaG9ydGxpbmtgLFxuICAgICAgbm90TG9nZ2VkSW4sXG4gICAgICAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHRoaXMuc2hvcnRjdXRDb250b2xsZXIuZ2V0VXJsRnJvbVNob3J0bGluayhyZXEsIHJlcyk7XG4gICAgICB9LFxuICAgICk7XG5cbiAgICB0aGlzLnJvdXRlci5nZXQoXG4gICAgICBgJHt0aGlzLnBhdGh9bGlzdGAsXG4gICAgICBub3RMb2dnZWRJbixcbiAgICAgIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgdGhpcy5zaG9ydGN1dENvbnRvbGxlci5saXN0U2hvcnRjdXRzKHJlcSwgcmVzKTtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHRoaXMucm91dGVyLnBvc3QoXG4gICAgICBgJHt0aGlzLnBhdGh9ZGVsZXRlYCxcbiAgICAgIG5vdExvZ2dlZEluLFxuICAgICAgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICB0aGlzLnNob3J0Y3V0Q29udG9sbGVyLmRlbGV0ZVNob3J0Y3V0KHJlcSwgcmVzKTtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHRoaXMucm91dGVyLnBvc3QoXG4gICAgICBgJHt0aGlzLnBhdGh9c2VhcmNoYCxcbiAgICAgIG5vdExvZ2dlZEluLFxuICAgICAgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICB0aGlzLnNob3J0Y3V0Q29udG9sbGVyLnNlYXJjaFNob3J0Y3V0cyhyZXEsIHJlcyk7XG4gICAgICB9LFxuICAgICk7XG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNob3J0Y3V0Um91dGU7XG4iLCJpbXBvcnQgeyBVc2VyIH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5pbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgeyBHZW5lcmFsQXBpUmVzcG9uc2UgfSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlc1wiO1xuaW1wb3J0IFVzZXJTZXJ2aWNlIGZyb20gXCIuLi8uLi9zZXJ2aWNlcy91c2VyL3VzZXIuc2VydmljZVwiO1xuXG5jbGFzcyBVc2VyQ29udHJvbGxlciB7XG4gIHByaXZhdGUgdXNlclNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHRoaXMudXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UoKTtcbiAgfVxuXG4gIHB1YmxpYyB1c2VyRGFzaGJvYXJkID0gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgY29uc3QgdXNlcklkOiBzdHJpbmcgPSByZXEuc2Vzc2lvbiEub3NsYXNoQmVVc2VySWQ7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNikuanNvbih7XG4gICAgICAgIGVycm9yOiBcIllvdSBtdXN0IGJlIGxvZ2dlZC1pbiB0byBhY2Nlc3MgdGhpcyByZXNvdXJjZVwiLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvKipcbiAgICAgICAqIFRyeWluZyB0byBhZGQgdGhlIHNob3J0Y3V0IGluIHRoZSBEQlxuICAgICAgICovXG4gICAgICBjb25zdCB1c2VyOiBVc2VyID0gKGF3YWl0IHRoaXMudXNlclNlcnZpY2UuZ2V0VXNlckZyb21JZChcbiAgICAgICAgdXNlcklkLFxuICAgICAgKSkgYXMgVXNlcjtcblxuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgZXJyb3I6IFwiVGhlIHJlcXVlc3Qgc2VlbSB0byBiZSBpbmZpbHRhcmF0ZWRcIixcbiAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItY29uc3RcbiAgICAgIGxldCB7IHBhc3N3b3JkLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgICAgcGFzc3dvcmQgPSAobnVsbCBhcyB1bmtub3duKSBhcyBzdHJpbmc7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgLi4udXNlcldpdGhvdXRQYXNzd29yZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvKipcbiAgICAgICAqIFVzaW5nIHRoZSByZXNwb25zZSBjb2RlIHJlY2lldmVkIGZyb20gQXV0aFNlcnZpY2VcbiAgICAgICAqL1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAzKS5qc29uKHtcbiAgICAgICAgZXJyb3IsXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBVc2VyQ29udHJvbGxlcjtcbiIsImltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBSb3V0ZXIgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IFVzZXJDb250cm9sbGVyIGZyb20gXCIuLi8uLi9jb250cm9sbGVycy91c2VyL3VzZXIuY29udHJvbGxlclwiO1xuaW1wb3J0IHsgR2VuZXJhbEFwaVJlc3BvbnNlIH0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXNcIjtcbmltcG9ydCB7IG5vdExvZ2dlZEluIH0gZnJvbSBcIi4uLy4uL21pZGRsZXdhcmVzL2F1dGgvYXV0aC5taWRkbGV3YXJlXCI7XG5cbmNsYXNzIFVzZXJSb3V0ZSB7XG4gIHByaXZhdGUgdXNlckNvbnRvbGxlcjogVXNlckNvbnRyb2xsZXI7XG4gIHByaXZhdGUgcGF0aDogc3RyaW5nID0gXCIvXCI7XG4gIHB1YmxpYyByb3V0ZXI6IFJvdXRlcjtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5yb3V0ZXIgPSBSb3V0ZXIoKTtcbiAgICB0aGlzLnVzZXJDb250b2xsZXIgPSBuZXcgVXNlckNvbnRyb2xsZXIoKTtcbiAgICB0aGlzLmluaXRpYWxpemVSb3V0ZXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVJvdXRlcyA9ICgpOiB2b2lkID0+IHtcbiAgICB0aGlzLnJvdXRlci5nZXQoYCR7dGhpcy5wYXRofWAsIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIGRhdGE6IFwiVXNlciBkYXNoYm9hcmQgcm91dGUgaXMgaGVhbHRoeVwiLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5yb3V0ZXIuZ2V0KFxuICAgICAgYCR7dGhpcy5wYXRofWRhc2hib2FyZGAsXG4gICAgICBub3RMb2dnZWRJbixcbiAgICAgIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgdGhpcy51c2VyQ29udG9sbGVyLnVzZXJEYXNoYm9hcmQocmVxLCByZXMpO1xuICAgICAgfSxcbiAgICApO1xuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBVc2VyUm91dGU7XG4iLCJpbXBvcnQgQXBwIGZyb20gXCIuL2FwcFwiO1xuY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuXG5hcHAubGlzdGVuKCk7XG5cblxuXG5cblxuXG4vLyBpbXBvcnQgZXhwcmVzcywgeyBBcHBsaWNhdGlvbiB9IGZyb20gXCJleHByZXNzXCI7XG4vLyBpbXBvcnQgY29ycyBmcm9tIFwiY29yc1wiO1xuLy8gaW1wb3J0IGhlbG1ldCBmcm9tIFwiaGVsbWV0XCI7XG4vLyBpbXBvcnQgbW9yZ2FuIGZyb20gXCJtb3JnYW5cIjtcbi8vIGltcG9ydCBmcyBmcm9tIFwiZnNcIjtcbi8vIGltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG4vLyBpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwicmVkaXNcIjtcbi8vIGltcG9ydCBzZXNzaW9uIGZyb20gXCJleHByZXNzLXNlc3Npb25cIjtcbi8vIGltcG9ydCBjb25uZWN0UmVkaXMsIHsgUmVkaXNTdG9yZSB9IGZyb20gXCJjb25uZWN0LXJlZGlzXCI7XG4vLyBpbXBvcnQge1xuLy8gICBOT0RFX0VOVixcbi8vICAgUE9SVCxcbi8vICAgUkVESVNfT1BUSU9OUyxcbi8vICAgU0VTU0lPTl9PUFRJT05TLFxuLy8gfSBmcm9tIFwiLi9jb25maWdcIjtcbi8vIGltcG9ydCB7IFJlZGlzQ2xpZW50VHlwZSB9IGZyb20gXCJAcmVkaXMvY2xpZW50XCI7XG5cbi8vIGNsYXNzIEFwcCB7XG4vLyAgIHByaXZhdGUgYXBwOiBBcHBsaWNhdGlvbjtcbi8vICAgcHJpdmF0ZSBwb3J0OiBudW1iZXI7XG4vLyAgIHByaXZhdGUgbG9nUGF0aDogc3RyaW5nID0gcGF0aC5qb2luKFxuLy8gICAgIF9fZGlybmFtZSxcbi8vICAgICBcIi4uXCIsXG4vLyAgICAgXCJsb2dzXCIsXG4vLyAgICAgXCJhY2Nlc3MubG9nXCIsXG4vLyAgICk7XG4vLyAgIHByaXZhdGUgcmVkaXNTdG9yZTogUmVkaXNTdG9yZTtcbi8vICAgcHJpdmF0ZSByZWRpc0NsaWVudDogUmVkaXNDbGllbnRUeXBlO1xuXG4vLyAgIGNvbnN0cnVjdG9yICgpIHtcbi8vICAgICB0aGlzLmFwcCA9IGV4cHJlc3MoKTtcbi8vICAgICB0aGlzLnBvcnQgPSArUE9SVCEgfHwgNDAwMDtcbi8vICAgICB0aGlzLnJlZGlzU3RvcmUgPSBjb25uZWN0UmVkaXMoc2Vzc2lvbik7XG4vLyAgICAgdGhpcy5yZWRpc0NsaWVudCA9IGNyZWF0ZUNsaWVudChSRURJU19PUFRJT05TKTtcblxuLy8gICAgIHRoaXMuaW5pdGlhbGl6ZU1pZGRsZXdhcmVzKCk7XG4vLyAgICAgdGhpcy5oYW5kbGVNaXNjUm91dGVzKCk7XG4vLyAgIH1cblxuLy8gICBwdWJsaWMgbGlzdGVuICgpIHtcbi8vICAgICB0aGlzLmFwcC5saXN0ZW4odGhpcy5wb3J0LCAoKSA9PiB7XG4vLyAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuLy8gICAgICAgY29uc29sZS5sb2coYFNlcnZlciBpcyB1cCBvbiB0aGUgcG9ydDogJHt0aGlzLnBvcnR9YCk7XG4vLyAgICAgfSk7XG4vLyAgIH1cblxuLy8gICBwcml2YXRlIGluaXRpYWxpemVNaWRkbGV3YXJlcyAoKSB7XG4vLyAgICAgdGhpcy5hcHAudXNlKGNvcnMoKSk7XG4vLyAgICAgdGhpcy5hcHAudXNlKGV4cHJlc3MuanNvbigpKTtcblxuLy8gICAgIC8qKlxuLy8gICAgICAqIFNlY3VyaXR5IGhlYWRlcnMgdG8gYmUgYXR0YWNoZWQgd2l0aCByZXF1ZXN0c1xuLy8gICAgICAqL1xuLy8gICAgIHRoaXMuYXBwLnVzZShoZWxtZXQoKSk7XG5cbi8vICAgICAvKipcbi8vICAgICAgKiBGb3IgbG9nIHJlbGF0ZWQgc2VydmljZXMgLSBvbmx5IGZvciBkZXYgc2VydmVyXG4vLyAgICAgICovXG4vLyAgICAgaWYgKE5PREVfRU5WID09IFwiZGV2ZWxvcG1lbnRcIiB8fCBOT0RFX0VOViA9PSBcInRlc3RcIikge1xuLy8gICAgICAgY29uc3QgYWNjZXNzTG9nU3RyZWFtOiBmcy5Xcml0ZVN0cmVhbSA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKFxuLy8gICAgICAgICB0aGlzLmxvZ1BhdGgsXG4vLyAgICAgICAgIHtcbi8vICAgICAgICAgICBmbGFnczogXCJhXCIsXG4vLyAgICAgICAgIH0sXG4vLyAgICAgICApO1xuLy8gICAgICAgdGhpcy5hcHAudXNlKFxuLy8gICAgICAgICBtb3JnYW4oXCJjb21tb25cIiwge1xuLy8gICAgICAgICAgIHN0cmVhbTogYWNjZXNzTG9nU3RyZWFtLFxuLy8gICAgICAgICB9KSxcbi8vICAgICAgICk7XG4vLyAgICAgfVxuLy8gICB9XG5cbi8vICAgcHJpdmF0ZSBoYW5kbGVNaXNjUm91dGVzID0gKCkgPT4ge1xuLy8gICAgIC8qKlxuLy8gICAgICAqIEJhc2Ugcm91dGUgLSB0byBjaGVjayBBUEkgaGVhbHRoXG4vLyAgICAgICovXG4vLyAgICAgdGhpcy5hcHAuZ2V0KFwiL1wiLCAocmVxLCByZXMpID0+IHtcbi8vICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbi8vICAgICAgICAgZXJyb3I6IG51bGwsXG4vLyAgICAgICAgIGRhdGE6IHtcbi8vICAgICAgICAgICBzZXJ2ZXI6IFwiQmFzZS1IZWFsdGh5XCIsXG4vLyAgICAgICAgIH0sXG4vLyAgICAgICB9KTtcbi8vICAgICB9KTtcblxuLy8gICAgIC8qKlxuLy8gICAgICAqIEhhbmRsaW5nIGFsbCB1bmRlZmluZWQgcm91dGVzXG4vLyAgICAgICovXG4vLyAgICAgdGhpcy5hcHAuYWxsKFwiKlwiLCAocmVxLCByZXMpID0+IHtcbi8vICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbi8vICAgICAgICAgZXJyb3I6IFwiUmVxdWVzdGVkIHJvdXRlIGRvZXNuJ3QgZXhpc3QgLSA0MDRcIixcbi8vICAgICAgICAgZGF0YTogbnVsbCxcbi8vICAgICAgIH0pO1xuLy8gICAgIH0pO1xuLy8gICB9O1xuXG4vLyAgIHByaXZhdGUgY29uZmlndXJlUmVkaXMgPSAoKSA9PiB7XG4vLyAgICAgdGhpcy5hcHAudXNlKFxuLy8gICAgICAgc2Vzc2lvbih7XG4vLyAgICAgICAgIC4uLlNFU1NJT05fT1BUSU9OUyxcbi8vICAgICAgICAgc3RvcmU6IG5ldyB0aGlzLnJlZGlzU3RvcmUoeyBjbGllbnQ6IHRoaXMucmVkaXNDbGllbnQgfSksXG4vLyAgICAgICB9KSxcbi8vICAgICApO1xuLy8gICB9O1xuLy8gfVxuXG4vLyBleHBvcnQgZGVmYXVsdCBBcHA7XG4iLCJpbXBvcnQgZXhwcmVzcywge1xuICBBcHBsaWNhdGlvbixcbiAgTmV4dEZ1bmN0aW9uLFxuICBSZXF1ZXN0LFxuICBSZXNwb25zZSxcbn0gZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCBjb3JzIGZyb20gXCJjb3JzXCI7XG5pbXBvcnQgaGVsbWV0IGZyb20gXCJoZWxtZXRcIjtcbmltcG9ydCBtb3JnYW4gZnJvbSBcIm1vcmdhblwiO1xuaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCBzZXNzaW9uIGZyb20gXCJleHByZXNzLXNlc3Npb25cIjtcbmltcG9ydCB7IE5PREVfRU5WLCBQT1JULCBTRVNTSU9OX09QVElPTlMgfSBmcm9tIFwiLi9jb25maWdcIjtcbmltcG9ydCBDb25maWd1cmVSZWRpcyBmcm9tIFwiLi9zZXJ2aWNlcy9yZWRpcy9yZWRpcy5zZXJ2aWNlXCI7XG5pbXBvcnQgQXV0aFJvdXRlIGZyb20gXCIuL3JvdXRlcy9hdXRoL2F1dGgucm91dGVcIjtcbmltcG9ydCB7IEdlbmVyYWxBcGlSZXNwb25zZSB9IGZyb20gXCIuL2ludGVyZmFjZXNcIjtcbmltcG9ydCBTaG9ydGN1dFJvdXRlIGZyb20gXCIuL3JvdXRlcy9zaG9ydGN1dHMvc2hvcnRjdXRzLnJvdXRlXCI7XG5pbXBvcnQgVXNlclJvdXRlIGZyb20gXCIuL3JvdXRlcy91c2VyL3VzZXIucm91dGVcIjtcblxuY2xhc3MgQXBwIHtcbiAgcHJpdmF0ZSBhcHA6IEFwcGxpY2F0aW9uO1xuICBwcml2YXRlIHBvcnQ6IG51bWJlcjtcbiAgcHJpdmF0ZSBsb2dQYXRoOiBzdHJpbmcgPSBwYXRoLmpvaW4oXG4gICAgX19kaXJuYW1lLFxuICAgIFwiLi5cIixcbiAgICBcImxvZ3NcIixcbiAgICBcImFjY2Vzcy5sb2dcIixcbiAgKTtcbiAgcHJpdmF0ZSByZWRpc1N0b3JlO1xuICBwcml2YXRlIHVzZXJBdXRoUm91dGU6IEF1dGhSb3V0ZTtcbiAgcHJpdmF0ZSBzaG9ydGN1dFJvdXRlOiBTaG9ydGN1dFJvdXRlO1xuICBwcml2YXRlIHVzZXJSb3V0ZTogVXNlclJvdXRlO1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLmFwcCA9IGV4cHJlc3MoKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgIHRoaXMucG9ydCA9ICtQT1JUISB8fCA0MDAwO1xuXG4gICAgLy9jb25maWd1cmluZyByZWRpcyBhbmQgZmV0Y2hpbmcgdGhlIHZhbHVlIG9mIHJlZGlzU3RvcmUgdGhhdCBpcyBuZXdseSBjb25maWd1cmVkIHdpdGggZXhwcmVzcy1zZXNzaW9uXG4gICAgdGhpcy5yZWRpc1N0b3JlID0gbmV3IENvbmZpZ3VyZVJlZGlzKCkucmVkaXNTdG9yZTtcbiAgICB0aGlzLnVzZXJBdXRoUm91dGUgPSBuZXcgQXV0aFJvdXRlKCk7XG4gICAgdGhpcy5zaG9ydGN1dFJvdXRlID0gbmV3IFNob3J0Y3V0Um91dGUoKTtcbiAgICB0aGlzLnVzZXJSb3V0ZSA9IG5ldyBVc2VyUm91dGUoKTtcblxuICAgIHRoaXMuY29uZmlndXJlRXhwcmVzc1Nlc3Npb25NaWRkbGV3YXJlKCk7IC8vbXVzdCByZW1haW4gb24gVE9QXG4gICAgdGhpcy5pbml0aWFsaXplTWlkZGxld2FyZXMoKTtcbiAgICB0aGlzLmluaXRpYWxpemVSb3V0ZXMoKTtcbiAgICB0aGlzLmhhbmRsZU1pc2NSb3V0ZXMoKTtcbiAgfVxuXG4gIHB1YmxpYyBsaXN0ZW4gPSAoKTogdm9pZCA9PiB7XG4gICAgdGhpcy5hcHAubGlzdGVuKHRoaXMucG9ydCwgKCkgPT4ge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgIGNvbnNvbGUubG9nKGBTZXJ2ZXIgaXMgdXAgb24gdGhlIHBvcnQ6ICR7dGhpcy5wb3J0fWApO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBUbyBoYW5kbGUgYWxsIG1pZGRsZXdhcmUtcmVsYXRlZCBwYXJ0cyAtIG1ha2luZyBpdCBtb2R1bGFyIHRvIG1ha2UgaXQgZWFzaWVyIHRvIHRlc3RcbiAgICovXG4gIHByaXZhdGUgaW5pdGlhbGl6ZU1pZGRsZXdhcmVzID0gKCk6IHZvaWQgPT4ge1xuICAgIHRoaXMuYXBwLnVzZShjb3JzKCkpO1xuICAgIHRoaXMuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5cbiAgICAvKipcbiAgICAgKiBTZWN1cml0eSBoZWFkZXJzIHRvIGJlIGF0dGFjaGVkIHdpdGggcmVxdWVzdHNcbiAgICAgKi9cbiAgICB0aGlzLmFwcC51c2UoaGVsbWV0KCkpO1xuXG4gICAgLyoqXG4gICAgICogRm9yIGxvZyByZWxhdGVkIHNlcnZpY2VzIC0gb25seSBmb3IgZGV2IHNlcnZlclxuICAgICAqL1xuICAgIGlmIChOT0RFX0VOViA9PSBcImRldmVsb3BtZW50XCIgfHwgTk9ERV9FTlYgPT0gXCJ0ZXN0XCIpIHtcbiAgICAgIGNvbnN0IGFjY2Vzc0xvZ1N0cmVhbTogZnMuV3JpdGVTdHJlYW0gPSBmcy5jcmVhdGVXcml0ZVN0cmVhbShcbiAgICAgICAgdGhpcy5sb2dQYXRoLFxuICAgICAgICB7XG4gICAgICAgICAgZmxhZ3M6IFwiYVwiLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICAgIHRoaXMuYXBwLnVzZShcbiAgICAgICAgbW9yZ2FuKFwiY29tbW9uXCIsIHtcbiAgICAgICAgICBzdHJlYW06IGFjY2Vzc0xvZ1N0cmVhbSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIGluaXRpYWxpemVSb3V0ZXMgPSAoKTogdm9pZCA9PiB7XG4gICAgdGhpcy5hcHAudXNlKFwiL2F1dGhcIiwgdGhpcy51c2VyQXV0aFJvdXRlLnJvdXRlcik7XG4gICAgdGhpcy5hcHAudXNlKFwiL3VzZXJcIiwgdGhpcy51c2VyUm91dGUucm91dGVyKTtcbiAgICB0aGlzLmFwcC51c2UoXCIvc2hvcnRjdXRcIiwgdGhpcy5zaG9ydGN1dFJvdXRlLnJvdXRlcik7XG4gIH07XG5cbiAgcHJpdmF0ZSBoYW5kbGVNaXNjUm91dGVzID0gKCk6IHZvaWQgPT4ge1xuICAgIC8qKlxuICAgICAqIEJhc2Ugcm91dGUgLSB0byBjaGVjayBBUEkgaGVhbHRoXG4gICAgICovXG4gICAgdGhpcy5hcHAuZ2V0KFwiL1wiLCAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc2VydmVyOiBcIkJhc2UtSGVhbHRoeVwiLFxuICAgICAgICB9LFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogSGFuZGxpbmcgYWxsIHVuZGVmaW5lZCByb3V0ZXNcbiAgICAgKi9cbiAgICB0aGlzLmFwcC5hbGwoXCIqXCIsIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwiUmVxdWVzdGVkIHJvdXRlIGRvZXNuJ3QgZXhpc3QgLSA0MDRcIixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9KTtcblxuICAgIHRoaXMuYXBwLnVzZShcbiAgICAgIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgZXJyb3I6IFwiU29tZXRoaW5nIGJyb2tlIG9uIG91ciBlbmQhXCIsXG4gICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgICAgfSxcbiAgICApO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmluZyBhIG1pZGRsZXdhcmUgZm9yIGV4cHJlc3Mgc2Vzc2lvbiB0byB3b3JrIHdpdGggcmVkaXMgY2FjaGVcbiAgICovXG4gIHByaXZhdGUgY29uZmlndXJlRXhwcmVzc1Nlc3Npb25NaWRkbGV3YXJlID0gKCk6IHZvaWQgPT4ge1xuICAgIHRoaXMuYXBwLnVzZShcbiAgICAgIHNlc3Npb24oe1xuICAgICAgICAuLi5TRVNTSU9OX09QVElPTlMsXG5cbiAgICAgICAgLy9tYWtpbmcgdXNlIG9mIHJlZGlzU3RvcmUgaW5zdGFudGlhdGVkIGZyb20gY2FjaGUgc2VydmljZVxuICAgICAgICBzdG9yZTogdGhpcy5yZWRpc1N0b3JlLFxuICAgICAgfSksXG4gICAgKTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBwO1xuIl0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGUiLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJleHBvcnRzIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicmVxdWlyZSIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19QT1JUIiwiUkVESVNfSE9TVCIsIlJFRElTX1BBU1NXT1JEIiwiUkVESVNfT1BUSU9OUyIsInBvcnQiLCJob3N0IiwicGFzc3dvcmQiLCJQT1NUR1JFU1FMX1VTRVIiLCJQT1NUR1JFU1FMX1BBU1NXT1JEIiwiUE9TVEdSRVNRTF9QT1JUIiwiUE9TVEdSRVNRTF9IT1NUIiwiREFUQUJBU0VfVVJMIiwiU0VTU0lPTl9TRUNSRVQiLCJTRVNTSU9OX05BTUUiLCJTRVNTSU9OX1RJTUVPVVQiLCJTRVNTSU9OX09QVElPTlMiLCJzZWNyZXQiLCJuYW1lIiwiY29va2llIiwibWF4QWdlIiwic2VjdXJlIiwicmVzYXZlIiwic2F2ZVVuaW5pdGlhbGl6ZWQiLCJyb2xsaW5nIiwiUE9SVCIsImNvbmZpZyIsIkNvbmZpZ3VyZVJlZGlzIiwidGhpcyIsIlJlZGlzU3RvcmUiLCJjb25uZWN0UmVkaXMiLCJzZXNzaW9uIiwicmVkaXNDbGllbnQiLCJSZWRpcyIsIm9uIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiY2xpZW50IiwiUHJpc21hQ2xpZW50IiwiaSIsIlVzZXJTZXJ2aWNlIiwiZW1haWwiLCJpbmNsdWRlU2hvcnRjdXRzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwcmlzbWEiLCJ1c2VyIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiaW5jbHVkZSIsInNob3J0Y3V0cyIsImlkIiwicHJpc21hQ2xpZW50IiwiQXV0aFNlcnZpY2UiLCJnZW5TYWx0Iiwic2FsdCIsImhhc2giLCJoYXNoZWRQYXNzd29yZCIsInVzZXJQYXNzd29yZCIsImRiUGFzc3dvcmQiLCJjb21wYXJlIiwiZGF0YSIsInVzZXJTZXJ2aWNlIiwiZ2V0VXNlckZyb21FbWFpbCIsImNvZGUiLCJlbmNyeXB0UGFzc3dvcmQiLCJjcmVhdGUiLCJjb21wYXJlUGFzc3dvcmQiLCJ1c2VyV2l0aG91dFBhc3N3b3JkIiwiQXV0aENvbnRyb2xsZXIiLCJ1c2VyUmVnaXN0cmF0aW9uRGF0YSIsIkpvaSIsIm1pbiIsIm1heCIsInRyaW0iLCJyZXF1aXJlZCIsInZhbGlkYXRlIiwicmVxIiwib3NsYXNoQmVVc2VySWQiLCJyZXMiLCJib2R5IiwidmFsaWRhdGlvbkVycm9yIiwidmFsaWRhdGVSZWdpc3RyYXRpb25EYXRhIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJhdXRoU2VydmljZSIsInJlZ2lzdGVyIiwibG9naW5Vc2VyQnlQZXJzaXN0aW5nQ2FjaGUiLCJ1c2VySWQiLCJ1c2VyTG9naW5EYXRhIiwidmFsaWRhdGVMb2dpbkRhdGEiLCJsb2dpbiIsImRlc3Ryb3kiLCJlcnIiLCJjbGVhckNvb2tpZSIsImlzTG9nZ2VkSW4iLCJuZXh0Iiwibm90TG9nZ2VkSW4iLCJBdXRoUm91dGUiLCJyb3V0ZXIiLCJwYXRoIiwicG9zdCIsImF1dGhDb250cm9sbGVyIiwibG9nb3V0IiwiUm91dGVyIiwiaW5pdGlhbGl6ZVJvdXRlIiwiU2hvcnRjdXRTZXJ2aWNlIiwic2hvcnRsaW5rIiwic2hvcnRjdXQiLCJzaG9ydGxpbmtfdXNlcklkIiwic2hvcnRjdXREYXRhIiwic2VhcmNoU2hvcnRjdXRCeVNob3J0bGluayIsInVwZGF0ZSIsInZpc2l0cyIsInNvcnRCeSIsIm9yZGVyQnkiLCJmaW5kTWFueSIsImxlbmd0aCIsInNlYXJjaE9wdGlvbnMiLCJmaWx0ZXIiLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJ2aXNpYmlsaXR5IiwidGFncyIsImluY2x1ZGVzIiwidXJsIiwidW5kZWZpbmVkIiwiaW5jcmVtZW50IiwiU2hvcnRjdXRDb250cm9sbGVyIiwidXJpIiwiYWxsb3ciLCJvcHRpb25hbCIsImRlc2NyaXB0aW9uIiwiUmVnRXhwIiwidGVzdCIsInNob3J0Y3V0VGFncyIsInZhbGlkYXRlU2hvcnRjdXREYXRhIiwiaXNVcmxXaGF0d2dDb21wbGlhbnQiLCJzaG9ydGN1dFNlcnZpY2UiLCJhZGRTaG9ydGN1dCIsInNob3J0dXJsIiwicmVxUXVlcmllcyIsInF1ZXJ5IiwibGlzdFNob3J0Y3V0cyIsImRlbGV0ZVNob3J0Y3V0IiwidGFnIiwidmlzaXRzTG93IiwidmlzaXRzSGlnaCIsInZhbGlkYXRlU2VhcmNoQm9keSIsInNlYXJjaFNob3J0Y3V0cyIsInBhcmFtcyIsImdldFVybEZyb21TaG9ydGxpbmsiLCJTaG9ydGN1dFJvdXRlIiwic2hvcnRjdXRDb250b2xsZXIiLCJpbml0aWFsaXplUm91dGVzIiwiVXNlckNvbnRyb2xsZXIiLCJnZXRVc2VyRnJvbUlkIiwiVXNlclJvdXRlIiwidXNlckNvbnRvbGxlciIsInVzZXJEYXNoYm9hcmQiLCJBcHAiLCJfX2Rpcm5hbWUiLCJhcHAiLCJsaXN0ZW4iLCJ1c2UiLCJjb3JzIiwiZXhwcmVzcyIsImhlbG1ldCIsInVzZXJBdXRoUm91dGUiLCJ1c2VyUm91dGUiLCJzaG9ydGN1dFJvdXRlIiwic2VydmVyIiwiYWxsIiwic3RvcmUiLCJyZWRpc1N0b3JlIiwiY29uZmlndXJlRXhwcmVzc1Nlc3Npb25NaWRkbGV3YXJlIiwiaW5pdGlhbGl6ZU1pZGRsZXdhcmVzIiwiaGFuZGxlTWlzY1JvdXRlcyJdLCJzb3VyY2VSb290IjoiIn0=