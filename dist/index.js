/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};const r=require("express");var e=t.n(r);const n=require("cors");var o=t.n(n);const i=require("helmet");var a=t.n(i);require("morgan"),require("fs");const u=require("path");var c=t.n(u);const s=require("express-session");var l=t.n(s);const f=require("dotenv");var h=process.env,p=h.REDIS_PORT,d=void 0===p?6379:p,v=h.REDIS_HOST,y=void 0===v?"localhost":v,g=h.REDIS_PASSWORD,m={port:+d,host:y,password:void 0===g?"secret":g},w=process.env,b=w.POSTGRESQL_USER,x=void 0===b?"admin":b,E=w.POSTGRESQL_PASSWORD,L=void 0===E?"admin":E,O=w.POSTGRESQL_PORT,j=void 0===O?"5432":O,S=w.POSTGRESQL_HOST,P=void 0===S?"localhost":S,_=(void 0===process.env.DATABASE_URL&&"postgres://".concat(x,":").concat(L,"@").concat(P,":").concat(j),process.env),k=_.SESSION_SECRET,T=void 0===k?"secret":k,R=_.SESSION_NAME,G=void 0===R?"sid":R,N=_.SESSION_TIMEOUT,I={secret:T,name:G,cookie:{maxAge:+(void 0===N?216e5:N),secure:!0},resave:!1,saveUninitialized:!1,rolling:!0},q=process.env.PORT;(0,f.config)();const C=require("ioredis");var F=t.n(C);const U=require("connect-redis");var A=t.n(U);function D(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const M=function(){function t(){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.RedisStore=A()(l()),this.redisClient=new(F())(m),this.redisClient.on("error",(function(t){throw console.log(t),"Error connecting with redis client"}))}var r,e;return r=t,(e=[{key:"redisStore",get:function(){return new this.RedisStore({client:this.redisClient})}}])&&D(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),t}(),Y=require("joi");var z=t.n(Y);const B=require("bcryptjs"),Q=require("bcrypt"),H=require("@prisma/client");function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}var J=["password"];function K(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)e=i[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)e=i[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function V(){V=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new L(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=b(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(O([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function w(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==W(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function b(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,b(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function E(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function O(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:j}}function j(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(w.prototype),u(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new w(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;E(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:O(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function X(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function Z(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){X(i,n,o,a,u,"next",t)}function u(t){X(i,n,o,a,u,"throw",t)}a(void 0)}))}}function $(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tt(t,r,e){return r&&$(t.prototype,r),e&&$(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function rt(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const et=tt((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),rt(this,"encryptPassword",function(){var t=Z(V().mark((function t(r){var e,n;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,B.genSalt)(10);case 2:return e=t.sent,t.next=5,(0,Q.hash)(r,e);case 5:return n=t.sent,t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}()),rt(this,"comparePassword",(function(t,r){return(0,Q.compare)(t,r)})),rt(this,"getUserFromEmail",(function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(n,o){Z(V().mark((function i(){var a;return V().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,r.prisma.user.findUnique({where:{email:t},include:{shortcuts:e}});case 3:return a=i.sent,i.abrupt("return",n(a));case 7:return i.prev=7,i.t0=i.catch(0),i.abrupt("return",o(i.t0));case 10:case"end":return i.stop()}}),i,null,[[0,7]])})))()}))})),rt(this,"register",(function(t){return new Promise((function(e,n){Z(V().mark((function o(){var i,a;return V().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,r.getUserFromEmail(t.email);case 3:if(!o.sent){o.next=6;break}return o.abrupt("return",n({error:"User with this email already exists",code:409}));case 6:return o.next=8,r.encryptPassword(t.password);case 8:return t.password=o.sent,o.next=11,r.prisma.user.create({data:t});case 11:return i=o.sent,a=i.id,o.abrupt("return",e(a));case 16:return o.prev=16,o.t0=o.catch(0),o.abrupt("return",n({error:o.t0,code:503}));case 19:case"end":return o.stop()}}),o,null,[[0,16]])})))()}))})),rt(this,"login",(function(t){return new Promise((function(e,n){Z(V().mark((function o(){var i,a,u,c,s;return V().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,i=t.email,o.next=4,r.getUserFromEmail(i,!0);case 4:if(a=o.sent){o.next=7;break}return o.abrupt("return",n({error:"User with this email couldn't be found",code:409}));case 7:return u=t.password,c=a.password,o.next=10,r.comparePassword(u,c);case 10:if(o.sent){o.next=12;break}return o.abrupt("return",n({error:"Password is not valid",code:401}));case 12:a.password,s=K(a,J),e(s),o.next=20;break;case 17:return o.prev=17,o.t0=o.catch(0),o.abrupt("return",n({error:o.t0,code:503}));case 20:case"end":return o.stop()}}),o,null,[[0,17]])})))()}))})),this.prisma=new H.PrismaClient}));function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function ot(){ot=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new L(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=b(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(O([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function w(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==nt(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function b(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,b(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function E(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function O(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:j}}function j(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(w.prototype),u(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new w(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;E(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:O(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function it(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function at(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){it(i,n,o,a,u,"next",t)}function u(t){it(i,n,o,a,u,"throw",t)}a(void 0)}))}}function ut(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ct(t,r,e){return r&&ut(t.prototype,r),e&&ut(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function st(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const lt=ct((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),st(this,"validateRegistrationData",(function(t){return z().object({name:z().string().min(3).max(64).trim().required(),email:z().string().email().max(128).trim().required(),password:z().string().min(6).max(256).required()}).validate(t)})),st(this,"validateLoginData",(function(t){return z().object({email:z().string().email().max(128).trim().required(),password:z().string().min(6).max(256).required()}).validate(t)})),st(this,"loginUserByPersistingCache",(function(t,r){t.session.oslashBeUserId=r})),st(this,"register",function(){var t=at(ot().mark((function t(e,n){var o,i,a,u,c,s;return ot().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.body,i=r.validateRegistrationData(o).error){t.next=17;break}return t.prev=3,t.next=6,r.authService.register(o);case 6:return a=t.sent,r.loginUserByPersistingCache(e,a),t.abrupt("return",n.status(201).json({error:null,data:{userId:a}}));case 11:return t.prev=11,t.t0=t.catch(3),u=t.t0,c=u.error,s=u.code,t.abrupt("return",n.status(503|s).json({error:c,data:null}));case 15:t.next=18;break;case 17:return t.abrupt("return",n.status(403).json({error:i.message,data:null}));case 18:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(r,e){return t.apply(this,arguments)}}()),st(this,"login",function(){var t=at(ot().mark((function t(e,n){var o,i,a,u,c,s;return ot().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.body,i=r.validateLoginData(o).error){t.next=17;break}return t.prev=3,t.next=6,r.authService.login(o);case 6:return a=t.sent,r.loginUserByPersistingCache(e,a.id),t.abrupt("return",n.status(200).json({data:a,error:null}));case 11:return t.prev=11,t.t0=t.catch(3),u=t.t0,c=u.error,s=u.code,t.abrupt("return",n.status(503|s).json({error:c,data:null}));case 15:t.next=18;break;case 17:return t.abrupt("return",n.status(403).json({error:i.message,data:null}));case 18:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(r,e){return t.apply(this,arguments)}}()),st(this,"logout",(function(t,r){t.session.destroy((function(t){return t?r.status(503).json({error:"We were not able to log you out",data:null}):(r.clearCookie(G),r.status(200).json({data:"Logged-out successfully",error:null}))}))})),st(this,"isLoggedIn",(function(t){return!!t.session.oslashBeUserId})),this.authService=new et}));var ft=function(t,r,e){if((new lt).isLoggedIn(t))return r.status(406).json({error:"You are already logged-in",data:null});e()},ht=function(t,r,e){if(!(new lt).isLoggedIn(t))return r.status(406).json({error:"You are not logged-in",data:null});e()};function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function dt(){dt=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(t){u=function(t,r,e){return t[r]=e}}function c(t,r,e,n){var o=r&&r.prototype instanceof f?r:f,i=Object.create(o.prototype),a=new L(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=b(a,e);if(u){if(u===l)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=s(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,a),i}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function h(){}function p(){}var d={};u(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(O([])));y&&y!==r&&e.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(r){u(t,r,(function(t){return this._invoke(r,t)}))}))}function w(t,r){function n(o,i,a,u){var c=s(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==pt(f)&&e.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):r.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;this._invoke=function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}}function b(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,b(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}function x(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function E(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function O(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:j}}function j(){return{value:void 0,done:!0}}return h.prototype=p,u(g,"constructor",p),u(p,"constructor",h),h.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(w.prototype),u(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new w(c(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),l},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),l}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;E(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:O(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),l}},t}function vt(t,r,e,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void e(t)}u.done?r(c):Promise.resolve(c).then(n,o)}function yt(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function gt(t,r,e){return r&&yt(t.prototype,r),e&&yt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function mt(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}const wt=gt((function t(){var e=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),mt(this,"path","/"),mt(this,"initializeRoute",(function(){e.router.get("".concat(e.path),(function(t,r){r.status(200).json({error:null,data:"User auth route - healthy"})})),e.router.post("".concat(e.path,"register"),ft,(function(t,r){e.authController.register(t,r)})),e.router.post("".concat(e.path,"login"),ft,(function(t,r){e.authController.login(t,r)})),e.router.post("".concat(e.path,"logout"),ht,function(){var t,r=(t=dt().mark((function t(r,n){return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,e.authController.logout(r,n),t.next=7;break;case 4:return t.prev=4,t.t0=t.catch(0),t.abrupt("return",n.status(503).json({error:t.t0,data:null}));case 7:case"end":return t.stop()}}),t,null,[[0,4]])})),function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function a(t){vt(i,n,o,a,u,"next",t)}function u(t){vt(i,n,o,a,u,"throw",t)}a(void 0)}))});return function(t,e){return r.apply(this,arguments)}}())})),this.router=(0,r.Router)(),this.authController=new lt,this.initializeRoute()}));function bt(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function xt(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?bt(Object(e),!0).forEach((function(r){Ot(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):bt(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function Et(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Lt(t,r,e){return r&&Et(t.prototype,r),e&&Et(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ot(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}(new(Lt((function t(){var r=this;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),Ot(this,"logPath",c().join(__dirname,"..","logs","access.log")),Ot(this,"listen",(function(){r.app.listen(r.port,(function(){console.log("Server is up on the port: ".concat(r.port))}))})),Ot(this,"initializeMiddlewares",(function(){r.app.use(o()()),r.app.use(e().json()),r.app.use(a()())})),Ot(this,"initializeRoutes",(function(){r.app.use("/auth",r.userAuthRoute.router)})),Ot(this,"handleMiscRoutes",(function(){r.app.get("/",(function(t,r){r.status(200).json({error:null,data:{server:"Base-Healthy"}})})),r.app.all("*",(function(t,r){r.status(404).json({error:"Requested route doesn't exist - 404",data:null})})),r.app.use((function(t,r,e){r.status(500).json({error:"Something broke on our end!",data:null})}))})),Ot(this,"configureExpressSessionMiddleware",(function(){r.app.use(l()(xt(xt({},I),{},{store:r.redisStore})))})),this.app=e()(),this.port=+q||4e3,this.redisStore=(new M).redisStore,this.userAuthRoute=new wt,this.configureExpressSessionMiddleware(),this.initializeMiddlewares(),this.initializeRoutes(),this.handleMiscRoutes()})))).listen()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0osSUFBSUUsSUFBSUcsTUFrQmQsSUFsRGMsNEJBb0RZLFdBQ3pCLEVBQUtMLElBQUlFLElBQUksUUFBUyxFQUFLSSxjQUFjZixPQUMxQyxJQXREYyw0QkF3RFksV0FJekIsRUFBS1MsSUFBSXBILElBQUksS0FBSyxTQUFDb0YsRUFBY0UsR0FDL0JBLEVBQUlPLE9BQU8sS0FBS0MsS0FBSyxDQUNuQm5ELE1BQU8sS0FDUHdCLEtBQU0sQ0FDSndELE9BQVEsaUJBR2IsSUFLRCxFQUFLUCxJQUFJUSxJQUFJLEtBQUssU0FBQ3hDLEVBQWNFLEdBQy9CQSxFQUFJTyxPQUFPLEtBQUtDLEtBQUssQ0FDbkJuRCxNQUFPLHNDQUNQd0IsS0FBTSxNQUVULElBRUQsRUFBS2lELElBQUlFLEtBQ1AsU0FBQ2xDLEVBQWNFLEVBQWVrQixHQUM1QmxCLEVBQUlPLE9BQU8sS0FBS0MsS0FBSyxDQUNuQm5ELE1BQU8sOEJBQ1B3QixLQUFNLE1BRVQsR0FFSixJQXZGYyw2Q0E0RjZCLFdBQzFDLEVBQUtpRCxJQUFJRSxJQUNQL0UsSUFBUSxHQUFELE1BQ0ZmLEdBREUsSUFJTHFHLE1BQU8sRUFBS0MsY0FHakIsSUFwR0MxRixLQUFLZ0YsSUFBTUksTUFFWHBGLEtBQUt2QixNQUFRb0IsR0FBUyxJQUd0QkcsS0FBSzBGLFlBQWEsSUFBSTNGLEdBQWlCMkYsV0FDdkMxRixLQUFLc0YsY0FBZ0IsSUFBSWhCLEdBRXpCdEUsS0FBSzJGLG9DQUNMM0YsS0FBSzRGLHdCQUNMNUYsS0FBSzZGLG1CQUNMN0YsS0FBSzhGLGtCQUNOLE1EdkNDYiIsInNvdXJjZXMiOlsid2VicGFjazovL29zbGFzaC1iZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvd2VicGFjay9ydW50aW1lL2NvbXBhdCBnZXQgZGVmYXVsdCBleHBvcnQiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJleHByZXNzXCIiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL2V4dGVybmFsIGNvbW1vbmpzIFwiY29yc1wiIiwid2VicGFjazovL29zbGFzaC1iZS9leHRlcm5hbCBjb21tb25qcyBcImhlbG1ldFwiIiwid2VicGFjazovL29zbGFzaC1iZS9leHRlcm5hbCBjb21tb25qcyBcIm1vcmdhblwiIiwid2VicGFjazovL29zbGFzaC1iZS9leHRlcm5hbCBub2RlLWNvbW1vbmpzIFwiZnNcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgbm9kZS1jb21tb25qcyBcInBhdGhcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJleHByZXNzLXNlc3Npb25cIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJkb3RlbnZcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29uZmlnL2NhY2hlLmNvbmZpZy50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29uZmlnL2RiLmNvbmZpZy50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29uZmlnL3Nlc3Npb24uY29uZmlnLnRzIiwid2VicGFjazovL29zbGFzaC1iZS8uL3NyYy9jb25maWcvYXBwLmNvbmZpZy50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29uZmlnL2luZGV4LnRzIiwid2VicGFjazovL29zbGFzaC1iZS9leHRlcm5hbCBjb21tb25qcyBcImlvcmVkaXNcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJjb25uZWN0LXJlZGlzXCIiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlLy4vc3JjL3NlcnZpY2VzL3JlZGlzL3JlZGlzLnNlcnZpY2UudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL2V4dGVybmFsIGNvbW1vbmpzIFwiam9pXCIiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlL2V4dGVybmFsIGNvbW1vbmpzIFwiYmNyeXB0anNcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJiY3J5cHRcIiIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvZXh0ZXJuYWwgY29tbW9uanMgXCJAcHJpc21hL2NsaWVudFwiIiwid2VicGFjazovL29zbGFzaC1iZS8uL3NyYy9zZXJ2aWNlcy9hdXRoL2F1dGguc2VydmljZS50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvY29udHJvbGxlcnMvYXV0aC9hdXRoLmNvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vb3NsYXNoLWJlLy4vc3JjL21pZGRsZXdhcmVzL2F1dGgvYXV0aC5taWRkbGV3YXJlLnRzIiwid2VicGFjazovL29zbGFzaC1iZS8uL3NyYy9yb3V0ZXMvYXV0aC9hdXRoLnJvdXRlLnRzIiwid2VicGFjazovL29zbGFzaC1iZS8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9vc2xhc2gtYmUvLi9zcmMvYXBwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcImV4cHJlc3NcIik7IiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJjb3JzXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiaGVsbWV0XCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwibW9yZ2FuXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiZnNcIik7IiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJwYXRoXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiZXhwcmVzcy1zZXNzaW9uXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiZG90ZW52XCIpOyIsImltcG9ydCB7IFJlZGlzT3B0aW9ucyB9IGZyb20gXCJpb3JlZGlzXCI7XG5cbmNvbnN0IHtcbiAgUkVESVNfUE9SVCA9IDYzNzksXG4gIFJFRElTX0hPU1QgPSBcImxvY2FsaG9zdFwiLCAvL2Fsc28gcmVmZXJlbmNlcyBhcyBSRURJU19VUkwgLy91c2luZyByZWRpcyBhcyB2YWx1ZSBkZWZhdWx0cyB0byB0aGUgZG9ja2VyIGltYWdlIHRoYXQgd2UgaGF2ZVxuICBSRURJU19QQVNTV09SRCA9IFwic2VjcmV0XCIsXG59ID0gcHJvY2Vzcy5lbnY7XG5cbmV4cG9ydCBjb25zdCBSRURJU19PUFRJT05TOiBSZWRpc09wdGlvbnMgPSB7XG4gIHBvcnQ6ICtSRURJU19QT1JULFxuICBob3N0OiBSRURJU19IT1NULFxuICBwYXNzd29yZDogUkVESVNfUEFTU1dPUkQsXG59O1xuIiwiZXhwb3J0IGNvbnN0IHtcbiAgUE9TVEdSRVNRTF9VU0VSID0gXCJhZG1pblwiLFxuICBQT1NUR1JFU1FMX1BBU1NXT1JEID0gXCJhZG1pblwiLFxuICBQT1NUR1JFU1FMX1BPUlQgPSBcIjU0MzJcIixcbiAgUE9TVEdSRVNRTF9IT1NUID0gXCJsb2NhbGhvc3RcIixcbn0gPSBwcm9jZXNzLmVudjtcblxuZXhwb3J0IGNvbnN0IHtcbiAgREFUQUJBU0VfVVJMID0gYHBvc3RncmVzOi8vJHtQT1NUR1JFU1FMX1VTRVJ9OiR7UE9TVEdSRVNRTF9QQVNTV09SRH1AJHtQT1NUR1JFU1FMX0hPU1R9OiR7UE9TVEdSRVNRTF9QT1JUfWAsXG59ID0gcHJvY2Vzcy5lbnY7XG4iLCJpbXBvcnQgeyBTZXNzaW9uT3B0aW9ucyB9IGZyb20gXCJleHByZXNzLXNlc3Npb25cIjtcblxuY29uc3QgU0lYX0hPVVJTID0gMTAwMCAqIDYwICogNjAgKiA2O1xuXG5leHBvcnQgY29uc3Qge1xuICBTRVNTSU9OX1NFQ1JFVCA9IFwic2VjcmV0XCIsXG4gIFNFU1NJT05fTkFNRSA9IFwic2lkXCIsXG4gIFNFU1NJT05fVElNRU9VVCA9IFNJWF9IT1VSUyxcbn0gPSBwcm9jZXNzLmVudjtcblxuZXhwb3J0IGNvbnN0IFNFU1NJT05fT1BUSU9OUzogU2Vzc2lvbk9wdGlvbnMgPSB7XG4gIHNlY3JldDogU0VTU0lPTl9TRUNSRVQsXG4gIG5hbWU6IFNFU1NJT05fTkFNRSxcbiAgY29va2llOiB7XG4gICAgbWF4QWdlOiArU0VTU0lPTl9USU1FT1VULFxuICAgIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiLFxuICB9LFxuICByZXNhdmU6IGZhbHNlLFxuICBzYXZlVW5pbml0aWFsaXplZDogZmFsc2UsXG4gIHJvbGxpbmc6IHRydWUsIC8vcm9sbCB0aGUgc2Vzc2lvbiBpLmUuIGtlZXAgaXQgYWxpdmUgZXZlbiBhZnRlciBzaXggaG91cnMgaWYgdGhlIHVzZXIgaXMgYWN0aXZlXG59O1xuIiwiZXhwb3J0IGNvbnN0IHsgTk9ERV9FTlYsIFBPUlQgfSA9IHByb2Nlc3MuZW52O1xuIiwiaW1wb3J0IHsgY29uZmlnIH0gZnJvbSBcImRvdGVudlwiO1xuY29uZmlnKCk7XG5cbmV4cG9ydCAqIGZyb20gXCIuL2NhY2hlLmNvbmZpZ1wiO1xuZXhwb3J0ICogZnJvbSBcIi4vZGIuY29uZmlnXCI7XG5leHBvcnQgKiBmcm9tIFwiLi9zZXNzaW9uLmNvbmZpZ1wiO1xuZXhwb3J0ICogZnJvbSBcIi4vYXBwLmNvbmZpZ1wiO1xuIiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJpb3JlZGlzXCIpOyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSByZXF1aXJlKFwiY29ubmVjdC1yZWRpc1wiKTsiLCJpbXBvcnQgUmVkaXMgZnJvbSBcImlvcmVkaXNcIjtcbmltcG9ydCBjb25uZWN0UmVkaXMsIHsgUmVkaXNTdG9yZSB9IGZyb20gXCJjb25uZWN0LXJlZGlzXCI7XG5pbXBvcnQgeyBSRURJU19PUFRJT05TIH0gZnJvbSBcIi4uLy4uL2NvbmZpZ1wiO1xuaW1wb3J0IHNlc3Npb24gZnJvbSBcImV4cHJlc3Mtc2Vzc2lvblwiO1xuXG5jbGFzcyBDb25maWd1cmVSZWRpcyB7XG4gIHByaXZhdGUgUmVkaXNTdG9yZTogUmVkaXNTdG9yZTtcbiAgcHJpdmF0ZSByZWRpc0NsaWVudDogUmVkaXM7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIC8vY29ubmVjdFJlZGlzIGlzIGEgY2xhc3MgdGhhdCBtYWtlcyB1c2Ugb2YgZXhwcmVzcy1zZXNzaW9uJ3Mgc2Vzc2lvbiB0byBjb25uZWN0IHRvIHJlZGlzXG4gICAgdGhpcy5SZWRpc1N0b3JlID0gY29ubmVjdFJlZGlzKHNlc3Npb24pO1xuXG4gICAgLy9jb25maWd1cmUgYSBuZXcgcmVkaXMgY2xpZW50IGZyb20gaW9yZWRpc1xuICAgIHRoaXMucmVkaXNDbGllbnQgPSBuZXcgUmVkaXMoUkVESVNfT1BUSU9OUyk7XG5cbiAgICB0aGlzLnJlZGlzQ2xpZW50Lm9uKFwiZXJyb3JcIiwgZXJyb3IgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgdGhyb3cgXCJFcnJvciBjb25uZWN0aW5nIHdpdGggcmVkaXMgY2xpZW50XCI7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgYSBuZXcgcmVkaXMgc3RvcmUgdG8gd29yayB3aXRoIHRoZSBleHByZXNzLXNlc3Npb24gbWlkZGxld2FyZVxuICAgKi9cbiAgcHVibGljIGdldCByZWRpc1N0b3JlICgpOiBSZWRpc1N0b3JlIHtcbiAgICAvL2NyZWF0aW5nIGEgbmV3IGluc3RhbmNlIG9mIHJlZGlzIHN0b3JlIGNsYXNzIHdpdGggb3VyIHByZS1jb25maWd1cmVkIHJlZGlzIGNsaWVudFxuICAgIHJldHVybiBuZXcgdGhpcy5SZWRpc1N0b3JlKHsgY2xpZW50OiB0aGlzLnJlZGlzQ2xpZW50IH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENvbmZpZ3VyZVJlZGlzO1xuIiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJqb2lcIik7IiwiY29uc3QgX19XRUJQQUNLX05BTUVTUEFDRV9PQkpFQ1RfXyA9IHJlcXVpcmUoXCJiY3J5cHRqc1wiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcImJjcnlwdFwiKTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0gcmVxdWlyZShcIkBwcmlzbWEvY2xpZW50XCIpOyIsImltcG9ydCB7IGdlblNhbHQgfSBmcm9tIFwiYmNyeXB0anNcIjtcbmltcG9ydCB7IGNvbXBhcmUsIGhhc2ggfSBmcm9tIFwiYmNyeXB0XCI7XG5pbXBvcnQgeyBQcmlzbWFDbGllbnQsIFVzZXIgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCB7XG4gIFNlcnZpY2VFcnJvcixcbiAgVXNlckxvZ2luRGF0YSxcbiAgVXNlclJlZ2lzdHJhdGlvbkRhdGEsXG4gIFVzZXJXaXRob3V0UGFzc3dvcmQsXG59IGZyb20gXCIuLi8uLi9pbnRlcmZhY2VzXCI7XG5cbmNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBwcmlzbWE6IFByaXNtYUNsaWVudDtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5wcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHBhc3N3b3JkIC0gcGFzc3dvcmQgcmVjaWV2ZWQgdmlhIFBPU1QgcmVxdWVzdFxuICAgKiBAcmV0dXJucyBwYXNzd29yZCBoYXNoZWQgd2l0aCBhIHNhbHQgb2YgMTBcbiAgICovXG4gIHByaXZhdGUgZW5jcnlwdFBhc3N3b3JkID0gYXN5bmMgKFxuICAgIHBhc3N3b3JkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8c3RyaW5nPiA9PiB7XG4gICAgY29uc3Qgc2FsdCA9IGF3YWl0IGdlblNhbHQoMTApO1xuICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgaGFzaChwYXNzd29yZCwgc2FsdCk7XG4gICAgcmV0dXJuIGhhc2hlZFBhc3N3b3JkO1xuICB9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdXNlclBhc3N3b3JkIC0gcGFzc3dvcmQgcmVjaWV2ZWQgdmlhIFBPU1QgcmVxdWVzdFxuICAgKiBAcGFyYW0gZGJQYXNzd29yZCAtIHBhc3N3b3JkIHN0b3JlZCBpbiB0aGUgZGF0YWJhc2VcbiAgICogQHJldHVybnNcbiAgICovXG4gIHByaXZhdGUgY29tcGFyZVBhc3N3b3JkID0gKFxuICAgIHVzZXJQYXNzd29yZDogc3RyaW5nLFxuICAgIGRiUGFzc3dvcmQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgcmV0dXJuIGNvbXBhcmUodXNlclBhc3N3b3JkLCBkYlBhc3N3b3JkKTtcbiAgfTtcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGVtYWlsIC0gdXNlciBlbWFpbFxuICAgKiBAcmV0dXJucyAtIFByb21pc2UgdGhhdCBlaXRoZXIgcmVzb2x2ZXMgdG8gdGhlIHVzZXIgZGF0YSBvciBudWxsXG4gICAqL1xuICBwcml2YXRlIGdldFVzZXJGcm9tRW1haWwgPSAoXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBpbmNsdWRlU2hvcnRjdXRzOiBib29sZWFuID0gZmFsc2UsXG4gICk6IFByb21pc2U8VXNlciB8IG51bGw+ID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8VXNlciB8IG51bGw+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8qKlxuICAgICAgICogSUlGRSB0byBwcmV2ZW50IHRoZSBhcHBsaWNhdGlvbiBmcm9tIGxldCBnbyBvZiBlcnJvcnNcbiAgICAgICAqL1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgc2hvcnRjdXRzOiBpbmNsdWRlU2hvcnRjdXRzLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh1c2VyKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGRhdGEgLSBuYW1lLCBlbWFpbCwgcGFzc3dvcmQgcmVjaWV2ZWQgaW4gcmVxdWVzdCBib2R5XG4gICAqIEByZXR1cm5zIC0gdXNlcklkIG9mIHRoZSByZWdpc3RlcmVkIHVzZXJcbiAgICovXG4gIHB1YmxpYyByZWdpc3RlciA9IChkYXRhOiBVc2VyUmVnaXN0cmF0aW9uRGF0YSk6IFByb21pc2U8c3RyaW5nPiA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgLyoqXG4gICAgICAgKiBhc3luYyBJSUZFIC0gdG8gZXNjYXBlIHByb21pc2UgZXhlY3V0b3IgZnVuY3Rpb24gYmVpbmcgYXN5bmNcbiAgICAgICAqIHRoaXMgaXMgbmVjZXNzYXJ5IHRvIGNhdGNoIGVycm9yc1xuICAgICAgICovXG4gICAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHVzZXI6IFVzZXIgfCBudWxsID0gYXdhaXQgdGhpcy5nZXRVc2VyRnJvbUVtYWlsKFxuICAgICAgICAgICAgZGF0YS5lbWFpbCxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogSWYgdGhlIHVzZXIgd2l0aCB0aGUgc2FtZSBlbWFpbCBleGlzdHMsIGRvIG5vdCByZWdpc3RlciB0aGUgdXNlclxuICAgICAgICAgICAqL1xuICAgICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KHtcbiAgICAgICAgICAgICAgZXJyb3I6IFwiVXNlciB3aXRoIHRoaXMgZW1haWwgYWxyZWFkeSBleGlzdHNcIixcbiAgICAgICAgICAgICAgY29kZTogNDA5LFxuICAgICAgICAgICAgfSBhcyBTZXJ2aWNlRXJyb3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIEVuY3J5cHRpbmcgdGhlIHBhc3N3b3JkIGJlZm9yZSBzYXZpbmcgaXQgaW4gdGhlIERCXG4gICAgICAgICAgICovXG4gICAgICAgICAgZGF0YS5wYXNzd29yZCA9IGF3YWl0IHRoaXMuZW5jcnlwdFBhc3N3b3JkKGRhdGEucGFzc3dvcmQpO1xuICAgICAgICAgIGNvbnN0IHsgaWQgfSA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShpZCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdCh7XG4gICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgIGNvZGU6IDUwMyxcbiAgICAgICAgICB9IGFzIFNlcnZpY2VFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgcHVibGljIGxvZ2luID0gKGRhdGE6IFVzZXJMb2dpbkRhdGEpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8VXNlcldpdGhvdXRQYXNzd29yZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB7IGVtYWlsIH0gPSBkYXRhO1xuICAgICAgICAgIGNvbnN0IHVzZXI6IFVzZXIgfCBudWxsID0gYXdhaXQgdGhpcy5nZXRVc2VyRnJvbUVtYWlsKFxuICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBJZiB0aGUgdXNlciB3aXRoIHRoZSBzYW1lIGVtYWlsIGV4aXN0cywgZG8gbm90IHJlZ2lzdGVyIHRoZSB1c2VyXG4gICAgICAgICAgICovXG4gICAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KHtcbiAgICAgICAgICAgICAgZXJyb3I6IFwiVXNlciB3aXRoIHRoaXMgZW1haWwgY291bGRuJ3QgYmUgZm91bmRcIixcbiAgICAgICAgICAgICAgY29kZTogNDA5LFxuICAgICAgICAgICAgfSBhcyBTZXJ2aWNlRXJyb3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vcGFzc3dvcmQgbWF0Y2hpbmdcbiAgICAgICAgICBjb25zdCB1c2VyUGFzc3dvcmQgPSBkYXRhLnBhc3N3b3JkLFxuICAgICAgICAgICAgZGJQYXNzd29yZCA9IHVzZXIucGFzc3dvcmQ7XG5cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAhKGF3YWl0IHRoaXMuY29tcGFyZVBhc3N3b3JkKHVzZXJQYXNzd29yZCwgZGJQYXNzd29yZCkpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KHtcbiAgICAgICAgICAgICAgZXJyb3I6IFwiUGFzc3dvcmQgaXMgbm90IHZhbGlkXCIsXG4gICAgICAgICAgICAgIGNvZGU6IDQwMSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vZXh0cmFjdGluZyBwYXNzd29yZCBmcm9tIHRoZSB1c2VyXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci1jb25zdFxuICAgICAgICAgIGxldCB7IHBhc3N3b3JkLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgICAgICAgIHBhc3N3b3JkID0gKG51bGwgYXMgdW5rbm93bikgYXMgc3RyaW5nO1xuICAgICAgICAgIFxuICAgICAgICAgIHJlc29sdmUodXNlcldpdGhvdXRQYXNzd29yZCk7IC8vc2VuZGluZyBiYWNrIHRoZSB1c2VyIGRhdGFcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KHtcbiAgICAgICAgICAgIGVycm9yLFxuICAgICAgICAgICAgY29kZTogNTAzLFxuICAgICAgICAgIH0gYXMgU2VydmljZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgQXV0aFNlcnZpY2U7XG4iLCJpbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgSm9pLCB7IFZhbGlkYXRpb25FcnJvciwgVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gXCJqb2lcIjtcbmltcG9ydCB7IFNFU1NJT05fTkFNRSB9IGZyb20gXCIuLi8uLi9jb25maWdcIjtcbmltcG9ydCB7XG4gIEdlbmVyYWxBcGlSZXNwb25zZSxcbiAgU2VydmljZUVycm9yLFxuICBVc2VyTG9naW5EYXRhLFxuICBVc2VyUmVnaXN0cmF0aW9uRGF0YSxcbiAgVXNlcldpdGhvdXRQYXNzd29yZCxcbn0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXNcIjtcbmltcG9ydCBBdXRoU2VydmljZSBmcm9tIFwiLi4vLi4vc2VydmljZXMvYXV0aC9hdXRoLnNlcnZpY2VcIjtcblxuLyoqXG4gKiBEZWNscmF0aXZlIG1lcmdpbmdcbiAqL1xuZGVjbGFyZSBtb2R1bGUgXCJleHByZXNzLXNlc3Npb25cIiB7XG4gIGludGVyZmFjZSBTZXNzaW9uIHtcbiAgICBvc2xhc2hCZVVzZXJJZDogc3RyaW5nO1xuICB9XG59XG5cbmNsYXNzIEF1dGhDb250cm9sbGVyIHtcbiAgcHJpdmF0ZSBhdXRoU2VydmljZTtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5hdXRoU2VydmljZSA9IG5ldyBBdXRoU2VydmljZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB1c2VyUmVnaXN0cmF0aW9uRGF0YSAtIGFuIG9iamVjdCB3aXRoIG5hbWUsIGVtYWlsLCBhbmQgcGFzc3dvcmQgPT4gcmVxdWlyZWQgZm9yIHJlZ2lzdHJhdGlvblxuICAgKiBAcmV0dXJucyAtIFZhbGlkYXRpb25SZXN1bHQgd2l0aCBlcnJvciBtZXNzYWdlXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlUmVnaXN0cmF0aW9uRGF0YSA9IChcbiAgICB1c2VyUmVnaXN0cmF0aW9uRGF0YTogVXNlclJlZ2lzdHJhdGlvbkRhdGEsXG4gICk6IFZhbGlkYXRpb25SZXN1bHQgPT4ge1xuICAgIGNvbnN0IHNjaGVtYSA9IEpvaS5vYmplY3Qoe1xuICAgICAgbmFtZTogSm9pLnN0cmluZygpXG4gICAgICAgIC5taW4oMylcbiAgICAgICAgLm1heCg2NClcbiAgICAgICAgLnRyaW0oKVxuICAgICAgICAucmVxdWlyZWQoKSxcbiAgICAgIGVtYWlsOiBKb2kuc3RyaW5nKClcbiAgICAgICAgLmVtYWlsKClcbiAgICAgICAgLm1heCgxMjgpXG4gICAgICAgIC50cmltKClcbiAgICAgICAgLnJlcXVpcmVkKCksXG4gICAgICBwYXNzd29yZDogSm9pLnN0cmluZygpXG4gICAgICAgIC5taW4oNilcbiAgICAgICAgLm1heCgyNTYpXG4gICAgICAgIC5yZXF1aXJlZCgpLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHNjaGVtYS52YWxpZGF0ZSh1c2VyUmVnaXN0cmF0aW9uRGF0YSk7XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB1c2VyUmVnaXN0cmF0aW9uRGF0YSAtIGVtYWlsLCBwYXNzd29yZFxuICAgKiBAcmV0dXJucyBWYWxpZGF0aW9uUmVzdWx0IHdpdGggZXJyb3IgbWVzc2FnZVxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUxvZ2luRGF0YSA9IChcbiAgICB1c2VyUmVnaXN0cmF0aW9uRGF0YTogVXNlckxvZ2luRGF0YSxcbiAgKTogVmFsaWRhdGlvblJlc3VsdCA9PiB7XG4gICAgY29uc3Qgc2NoZW1hID0gSm9pLm9iamVjdCh7XG4gICAgICBlbWFpbDogSm9pLnN0cmluZygpXG4gICAgICAgIC5lbWFpbCgpXG4gICAgICAgIC5tYXgoMTI4KVxuICAgICAgICAudHJpbSgpXG4gICAgICAgIC5yZXF1aXJlZCgpLFxuICAgICAgcGFzc3dvcmQ6IEpvaS5zdHJpbmcoKVxuICAgICAgICAubWluKDYpXG4gICAgICAgIC5tYXgoMjU2KVxuICAgICAgICAucmVxdWlyZWQoKSxcbiAgICB9KTtcblxuICAgIHJldHVybiBzY2hlbWEudmFsaWRhdGUodXNlclJlZ2lzdHJhdGlvbkRhdGEpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBUaGlzIGZ1bmN0aW9uIGhlbHBzIGluIGF0dGVzdGluZyBcInNpZFwiIGNvb2tpZSB0aGF0IHRlbGxzIHRoZSBzZXNzaW9uLUlEIGFzIGl0IGlzIHN0b3JlZCBpbiByZWRpcyBjYWNoZVxuICAgKiBTaWQgaXMgYWxzbyBhdHRhY2hlZCB0byBldmVyeSByZXF1ZXN0IHRoZXJlYWZ0ZXIuIEhlbmNlLCBwZXJzaXN0aW5nIHRoZSBsb2dpblxuICAgKiBAcGFyYW0gcmVxIC0gRXhwcmVzcyByZXF1ZXN0XG4gICAqIEBwYXJhbSBpZCAtIHVzZXJJZFxuICAgKi9cbiAgcHJpdmF0ZSBsb2dpblVzZXJCeVBlcnNpc3RpbmdDYWNoZSA9IChyZXE6IFJlcXVlc3QsIGlkOiBzdHJpbmcpID0+IHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgIHJlcS5zZXNzaW9uIS5vc2xhc2hCZVVzZXJJZCA9IGlkOyAvL3NldHRpbmcgdXNlcklkIHRvIGJlIGVxdWFsIHRvIGlkXG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSByZXEgRXhwcmVzcyByZXF1ZXN0XG4gICAqIEBwYXJhbSByZXMgRXhwcmVzcyByZXNwb25zZVxuICAgKiBAcmV0dXJucyByZXMuc3RhdHVzLmpzb24oey4uLn0pXG4gICAqL1xuICBwdWJsaWMgcmVnaXN0ZXIgPSBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgLyoqXG4gICAgICogdmFsaWRhdGluZyB1c2VyIHJlZ2lzdHJhdGlvbiBkYXRhIGFuZCBzYW5pdGl6aW5nIHRoZSByZXEgYm9keVxuICAgICAqL1xuICAgIGNvbnN0IHVzZXJSZWdpc3RyYXRpb25EYXRhOiBVc2VyUmVnaXN0cmF0aW9uRGF0YSA9IHJlcS5ib2R5O1xuXG4gICAgY29uc3QgdmFsaWRhdGlvbkVycm9yOlxuICAgICAgfCBWYWxpZGF0aW9uRXJyb3JcbiAgICAgIHwgbnVsbFxuICAgICAgfCB1bmRlZmluZWQgPSB0aGlzLnZhbGlkYXRlUmVnaXN0cmF0aW9uRGF0YShcbiAgICAgIHVzZXJSZWdpc3RyYXRpb25EYXRhLFxuICAgICkuZXJyb3I7XG5cbiAgICAvKipcbiAgICAgKiBJZiB0aGVyZSBhcmUgbm8gdmFsaWRhdGlvbiBlcnJvcnMsIHJlZ2lzdGVyIHRoZSB1c2VyXG4gICAgICogRWxzZSwgbm90aWZ5IHZpYSBBUEkgcmVzcG9uc2VcbiAgICAgKi9cbiAgICBpZiAoIXZhbGlkYXRpb25FcnJvcikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaWQgPSBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLnJlZ2lzdGVyKFxuICAgICAgICAgIHVzZXJSZWdpc3RyYXRpb25EYXRhLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vbG9nZ2luZy1pbiB0aGUgdXNlciBpbiBhZnRlciB0aGUgdXNlciBoYXMgcmVnaXN0ZXJlZFxuICAgICAgICB0aGlzLmxvZ2luVXNlckJ5UGVyc2lzdGluZ0NhY2hlKHJlcSwgaWQpO1xuXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcklkOiBpZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKHNlcnZpY2VFcnJvcikge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgY29kZSxcbiAgICAgICAgfTogU2VydmljZUVycm9yID0gc2VydmljZUVycm9yIGFzIFNlcnZpY2VFcnJvcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXNpbmcgdGhlIHJlc3BvbnNlIGNvZGUgcmVjaWV2ZWQgZnJvbSBBdXRoU2VydmljZVxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoY29kZSB8IDUwMykuanNvbih7XG4gICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICBlcnJvcjogdmFsaWRhdGlvbkVycm9yLm1lc3NhZ2UsXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gcmVxIEV4cHJlc3MgcmVxdWVzdFxuICAgKiBAcGFyYW0gcmVzIEV4cHJlc3MgcmVzcG9uc2VcbiAgICogQHJldHVybnMgcmVzLnN0YXR1cy5qc29uIC0gbWVzc2FnZSB0byBiZSBzZW50IGJhY2sgZnJvbSB0aGUgQVBJXG4gICAqL1xuICBwdWJsaWMgbG9naW4gPSBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgY29uc3QgdXNlckxvZ2luRGF0YTogVXNlckxvZ2luRGF0YSA9IHJlcS5ib2R5O1xuXG4gICAgY29uc3QgdmFsaWRhdGlvbkVycm9yOlxuICAgICAgfCBWYWxpZGF0aW9uRXJyb3JcbiAgICAgIHwgbnVsbFxuICAgICAgfCB1bmRlZmluZWQgPSB0aGlzLnZhbGlkYXRlTG9naW5EYXRhKHVzZXJMb2dpbkRhdGEpLmVycm9yO1xuXG4gICAgaWYgKCF2YWxpZGF0aW9uRXJyb3IpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXI6IFVzZXJXaXRob3V0UGFzc3dvcmQgPSBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLmxvZ2luKFxuICAgICAgICAgIHVzZXJMb2dpbkRhdGEsXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8tLWxvZ2luIGxvZ2ljLS1cbiAgICAgICAgdGhpcy5sb2dpblVzZXJCeVBlcnNpc3RpbmdDYWNoZShyZXEsIHVzZXIuaWQpO1xuXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgICAgZGF0YTogdXNlcixcbiAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuXG4gICAgICAgIC8vLS1yZXF1ZXN0IHJlc3BvbnNlLS1cbiAgICAgIH0gY2F0Y2ggKHNlcnZpY2VFcnJvcikge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgY29kZSxcbiAgICAgICAgfTogU2VydmljZUVycm9yID0gc2VydmljZUVycm9yIGFzIFNlcnZpY2VFcnJvcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXNpbmcgdGhlIHJlc3BvbnNlIGNvZGUgcmVjaWV2ZWQgZnJvbSBBdXRoU2VydmljZVxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoY29kZSB8IDUwMykuanNvbih7XG4gICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICBlcnJvcjogdmFsaWRhdGlvbkVycm9yLm1lc3NhZ2UsXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gcmVxIEV4cHJlc3MgcmVxdWVzdFxuICAgKiBAcGFyYW0gcmVzIEV4cHJlc3Mgc2Vzc2lvblxuICAgKiBAcmV0dXJucyBBIHByb21pc2UgdG8gdGVsbCBpZiB0aGUgY29va2llIGhhcyBiZWVuIGNsZWFyZWQgb3Igbm90XG4gICAqL1xuICBwdWJsaWMgbG9nb3V0ID0gKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIC8qKlxuICAgICAqIERlbGV0aW5nIHRoZSBzZXNzaW9uIGFuZCB0aHVzLCB0aGUgY29ycmVzcG9uZGluZyBjb29raWVcbiAgICAgKi9cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgIHJlcS5zZXNzaW9uIS5kZXN0cm95KGVyciA9PiB7XG4gICAgICBpZiAoIWVycikge1xuICAgICAgICByZXMuY2xlYXJDb29raWUoU0VTU0lPTl9OQU1FKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlbmRpbmcgYmFjayB0aGUgcmVzcG9uc2UgaWYgdGhlIHVzZXIgaXMgc3VjY2Vzc2Z1bGx5IGxvZ2dlZC1vdXRcbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgICAgZGF0YTogXCJMb2dnZWQtb3V0IHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMykuanNvbih7XG4gICAgICAgIGVycm9yOiBcIldlIHdlcmUgbm90IGFibGUgdG8gbG9nIHlvdSBvdXRcIixcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICBwdWJsaWMgaXNMb2dnZWRJbiA9IChyZXE6IFJlcXVlc3QpID0+ICEhcmVxLnNlc3Npb24hLm9zbGFzaEJlVXNlcklkOyAvL2lmIHRoZSB1c2VySWQgaXMgbm90IHByZXNlbnRcbn1cblxuZXhwb3J0IGRlZmF1bHQgQXV0aENvbnRyb2xsZXI7XG4iLCJpbXBvcnQgeyBOZXh0RnVuY3Rpb24sIFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCBBdXRoQ29udHJvbGxlciBmcm9tIFwiLi4vLi4vY29udHJvbGxlcnMvYXV0aC9hdXRoLmNvbnRyb2xsZXJcIjtcbmltcG9ydCB7IEdlbmVyYWxBcGlSZXNwb25zZSB9IGZyb20gXCIuLi8uLi9pbnRlcmZhY2VzXCI7XG5cbmV4cG9ydCBjb25zdCBpc0xvZ2dlZEluID0gKFxuICByZXE6IFJlcXVlc3QsXG4gIHJlczogUmVzcG9uc2UsXG4gIG5leHQ6IE5leHRGdW5jdGlvbixcbikgPT4ge1xuICBjb25zdCBhdXRoQ29udHJvbGxlciA9IG5ldyBBdXRoQ29udHJvbGxlcigpO1xuXG4gIC8vaWYgdGhlIGNvb2tpZSBpcyBmb3VuZCBpbiB0aGUgcmVxdWVzdCwgd2UgcmV0dXJuIHRoaXMgcmVzcG9uc2VcbiAgLy9pZiBhIGNvb2tpZSBpcyBhbHJlYWR5IGF0dGFjaGVkIHRvIHRoZSByZXF1ZXN0LCB0cmlnZ2VyIHRoaXNcbiAgaWYgKGF1dGhDb250cm9sbGVyLmlzTG9nZ2VkSW4ocmVxKSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNikuanNvbih7XG4gICAgICBlcnJvcjogXCJZb3UgYXJlIGFscmVhZHkgbG9nZ2VkLWluXCIsXG4gICAgICBkYXRhOiBudWxsLFxuICAgIH0gYXMgR2VuZXJhbEFwaVJlc3BvbnNlKTtcbiAgfVxuXG4gIG5leHQoKTtcbn07XG5cbi8vbWlkZGxld2FyZSBmb3IgYXV0aGVudGljYXRlZCByZXF1ZXN0c1xuZXhwb3J0IGNvbnN0IG5vdExvZ2dlZEluID0gKFxuICByZXE6IFJlcXVlc3QsXG4gIHJlczogUmVzcG9uc2UsXG4gIG5leHQ6IE5leHRGdW5jdGlvbixcbikgPT4ge1xuICBjb25zdCBhdXRoQ29udHJvbGxlciA9IG5ldyBBdXRoQ29udHJvbGxlcigpO1xuXG4gIGlmICghYXV0aENvbnRyb2xsZXIuaXNMb2dnZWRJbihyZXEpKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA2KS5qc29uKHtcbiAgICAgIGVycm9yOiBcIllvdSBhcmUgbm90IGxvZ2dlZC1pblwiLFxuICAgICAgZGF0YTogbnVsbCxcbiAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gIH1cblxuICBuZXh0KCk7XG59O1xuIiwiaW1wb3J0IHsgUm91dGVyLCBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgQXV0aENvbnRyb2xsZXIgZnJvbSBcIi4uLy4uL2NvbnRyb2xsZXJzL2F1dGgvYXV0aC5jb250cm9sbGVyXCI7XG5pbXBvcnQgeyBHZW5lcmFsQXBpUmVzcG9uc2UgfSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHtcbiAgaXNMb2dnZWRJbixcbiAgbm90TG9nZ2VkSW4sXG59IGZyb20gXCIuLi8uLi9taWRkbGV3YXJlcy9hdXRoL2F1dGgubWlkZGxld2FyZVwiO1xuXG5jbGFzcyBBdXRoUm91dGUge1xuICBwcml2YXRlIHBhdGg6IHN0cmluZyA9IFwiL1wiO1xuICBwdWJsaWMgcm91dGVyOiBSb3V0ZXI7XG4gIHByaXZhdGUgYXV0aENvbnRyb2xsZXI7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHRoaXMucm91dGVyID0gUm91dGVyKCk7XG4gICAgdGhpcy5hdXRoQ29udHJvbGxlciA9IG5ldyBBdXRoQ29udHJvbGxlcigpO1xuXG4gICAgLy9pbml0aWFsaXppbmcgYWxsIHRoZSBhdXRoZW50aWNhdGlvbiByb3V0ZXNcbiAgICB0aGlzLmluaXRpYWxpemVSb3V0ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplUm91dGUgPSAoKTogdm9pZCA9PiB7XG4gICAgLy9iYXNlIHJvdXRlIHRvIGNoZWNrIHJvdXRlIGhlYWx0aFxuICAgIHRoaXMucm91dGVyLmdldChgJHt0aGlzLnBhdGh9YCwgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgZGF0YTogXCJVc2VyIGF1dGggcm91dGUgLSBoZWFsdGh5XCIsXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfSk7XG5cbiAgICAvL3Bvc3Qgcm91dGUgdG8gcmVnaXN0ZXIgdGhlIHVzZXJcbiAgICB0aGlzLnJvdXRlci5wb3N0KFxuICAgICAgYCR7dGhpcy5wYXRofXJlZ2lzdGVyYCxcbiAgICAgIGlzTG9nZ2VkSW4sXG4gICAgICAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICAgIC8vcmVxdWVzdCBmb3J3YXJkaW5nIHRvIGhhbmRsZSB0aGUgcmVxdWVzdCBlbGVtZW50cyBpbiB0aGUgQXV0aENvbnRyb2xsZXJcbiAgICAgICAgdGhpcy5hdXRoQ29udHJvbGxlci5yZWdpc3RlcihyZXEsIHJlcyk7XG4gICAgICB9LFxuICAgICk7XG5cbiAgICAvL3Bvc3Qgcm91dGUgdG8gbG9naW4gdGhlIHVzZXJcbiAgICB0aGlzLnJvdXRlci5wb3N0KFxuICAgICAgYCR7dGhpcy5wYXRofWxvZ2luYCxcbiAgICAgIGlzTG9nZ2VkSW4sIC8vYXR0YWNoaW5nIGEgbWlkZGxld2FyZSB3aXRoIHRoZSBsb2dpbiByZXF1ZXN0IHRoYXQgd291bGQgcHJldmVudCB1c2VyIGZyb20gY3JlYXRpbmcgbXVsdGlwbGUgc2Vzc2lvbnNcbiAgICAgIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgICAgLy9yZXF1ZXN0IGZvcndhcmRpbmcgdG8gaGFuZGxlIHRoZSByZXF1ZXN0IGVsZW1lbnRzIGluIHRoZSBBdXRoQ29udHJvbGxlclxuXG4gICAgICAgIHRoaXMuYXV0aENvbnRyb2xsZXIubG9naW4ocmVxLCByZXMpO1xuICAgICAgfSxcbiAgICApO1xuXG4gICAgLy9wb3N0IHJvdXRlIHRvIGxvZ291dCB0aGUgdXNlclxuICAgIHRoaXMucm91dGVyLnBvc3QoXG4gICAgICBgJHt0aGlzLnBhdGh9bG9nb3V0YCxcbiAgICAgIG5vdExvZ2dlZEluLCAvL2F0dGFjaGluZyBhIG1pZGRsZXdhcmUgd2l0aCB0aGUgbG9nb3V0IHRoYXQgd291bGQgcHJldmVudCBsb2dvdXQgaWYgbm90IGxvZ2dlZC1pblxuICAgICAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICAvL3JlcXVlc3QgZm9yd2FyZGluZyB0byBoYW5kbGUgdGhlIHJlcXVlc3QgZWxlbWVudHMgaW4gdGhlIEF1dGhDb250cm9sbGVyXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy5hdXRoQ29udHJvbGxlci5sb2dvdXQocmVxLCByZXMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMykuanNvbih7XG4gICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICk7XG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IEF1dGhSb3V0ZTtcbiIsImltcG9ydCBBcHAgZnJvbSBcIi4vYXBwXCI7XG5jb25zdCBhcHAgPSBuZXcgQXBwKCk7XG5cbmFwcC5saXN0ZW4oKTtcblxuXG5cblxuXG5cbi8vIGltcG9ydCBleHByZXNzLCB7IEFwcGxpY2F0aW9uIH0gZnJvbSBcImV4cHJlc3NcIjtcbi8vIGltcG9ydCBjb3JzIGZyb20gXCJjb3JzXCI7XG4vLyBpbXBvcnQgaGVsbWV0IGZyb20gXCJoZWxtZXRcIjtcbi8vIGltcG9ydCBtb3JnYW4gZnJvbSBcIm1vcmdhblwiO1xuLy8gaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuLy8gaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbi8vIGltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJyZWRpc1wiO1xuLy8gaW1wb3J0IHNlc3Npb24gZnJvbSBcImV4cHJlc3Mtc2Vzc2lvblwiO1xuLy8gaW1wb3J0IGNvbm5lY3RSZWRpcywgeyBSZWRpc1N0b3JlIH0gZnJvbSBcImNvbm5lY3QtcmVkaXNcIjtcbi8vIGltcG9ydCB7XG4vLyAgIE5PREVfRU5WLFxuLy8gICBQT1JULFxuLy8gICBSRURJU19PUFRJT05TLFxuLy8gICBTRVNTSU9OX09QVElPTlMsXG4vLyB9IGZyb20gXCIuL2NvbmZpZ1wiO1xuLy8gaW1wb3J0IHsgUmVkaXNDbGllbnRUeXBlIH0gZnJvbSBcIkByZWRpcy9jbGllbnRcIjtcblxuLy8gY2xhc3MgQXBwIHtcbi8vICAgcHJpdmF0ZSBhcHA6IEFwcGxpY2F0aW9uO1xuLy8gICBwcml2YXRlIHBvcnQ6IG51bWJlcjtcbi8vICAgcHJpdmF0ZSBsb2dQYXRoOiBzdHJpbmcgPSBwYXRoLmpvaW4oXG4vLyAgICAgX19kaXJuYW1lLFxuLy8gICAgIFwiLi5cIixcbi8vICAgICBcImxvZ3NcIixcbi8vICAgICBcImFjY2Vzcy5sb2dcIixcbi8vICAgKTtcbi8vICAgcHJpdmF0ZSByZWRpc1N0b3JlOiBSZWRpc1N0b3JlO1xuLy8gICBwcml2YXRlIHJlZGlzQ2xpZW50OiBSZWRpc0NsaWVudFR5cGU7XG5cbi8vICAgY29uc3RydWN0b3IgKCkge1xuLy8gICAgIHRoaXMuYXBwID0gZXhwcmVzcygpO1xuLy8gICAgIHRoaXMucG9ydCA9ICtQT1JUISB8fCA0MDAwO1xuLy8gICAgIHRoaXMucmVkaXNTdG9yZSA9IGNvbm5lY3RSZWRpcyhzZXNzaW9uKTtcbi8vICAgICB0aGlzLnJlZGlzQ2xpZW50ID0gY3JlYXRlQ2xpZW50KFJFRElTX09QVElPTlMpO1xuXG4vLyAgICAgdGhpcy5pbml0aWFsaXplTWlkZGxld2FyZXMoKTtcbi8vICAgICB0aGlzLmhhbmRsZU1pc2NSb3V0ZXMoKTtcbi8vICAgfVxuXG4vLyAgIHB1YmxpYyBsaXN0ZW4gKCkge1xuLy8gICAgIHRoaXMuYXBwLmxpc3Rlbih0aGlzLnBvcnQsICgpID0+IHtcbi8vICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4vLyAgICAgICBjb25zb2xlLmxvZyhgU2VydmVyIGlzIHVwIG9uIHRoZSBwb3J0OiAke3RoaXMucG9ydH1gKTtcbi8vICAgICB9KTtcbi8vICAgfVxuXG4vLyAgIHByaXZhdGUgaW5pdGlhbGl6ZU1pZGRsZXdhcmVzICgpIHtcbi8vICAgICB0aGlzLmFwcC51c2UoY29ycygpKTtcbi8vICAgICB0aGlzLmFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuXG4vLyAgICAgLyoqXG4vLyAgICAgICogU2VjdXJpdHkgaGVhZGVycyB0byBiZSBhdHRhY2hlZCB3aXRoIHJlcXVlc3RzXG4vLyAgICAgICovXG4vLyAgICAgdGhpcy5hcHAudXNlKGhlbG1ldCgpKTtcblxuLy8gICAgIC8qKlxuLy8gICAgICAqIEZvciBsb2cgcmVsYXRlZCBzZXJ2aWNlcyAtIG9ubHkgZm9yIGRldiBzZXJ2ZXJcbi8vICAgICAgKi9cbi8vICAgICBpZiAoTk9ERV9FTlYgPT0gXCJkZXZlbG9wbWVudFwiIHx8IE5PREVfRU5WID09IFwidGVzdFwiKSB7XG4vLyAgICAgICBjb25zdCBhY2Nlc3NMb2dTdHJlYW06IGZzLldyaXRlU3RyZWFtID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0oXG4vLyAgICAgICAgIHRoaXMubG9nUGF0aCxcbi8vICAgICAgICAge1xuLy8gICAgICAgICAgIGZsYWdzOiBcImFcIixcbi8vICAgICAgICAgfSxcbi8vICAgICAgICk7XG4vLyAgICAgICB0aGlzLmFwcC51c2UoXG4vLyAgICAgICAgIG1vcmdhbihcImNvbW1vblwiLCB7XG4vLyAgICAgICAgICAgc3RyZWFtOiBhY2Nlc3NMb2dTdHJlYW0sXG4vLyAgICAgICAgIH0pLFxuLy8gICAgICAgKTtcbi8vICAgICB9XG4vLyAgIH1cblxuLy8gICBwcml2YXRlIGhhbmRsZU1pc2NSb3V0ZXMgPSAoKSA9PiB7XG4vLyAgICAgLyoqXG4vLyAgICAgICogQmFzZSByb3V0ZSAtIHRvIGNoZWNrIEFQSSBoZWFsdGhcbi8vICAgICAgKi9cbi8vICAgICB0aGlzLmFwcC5nZXQoXCIvXCIsIChyZXEsIHJlcykgPT4ge1xuLy8gICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xuLy8gICAgICAgICBlcnJvcjogbnVsbCxcbi8vICAgICAgICAgZGF0YToge1xuLy8gICAgICAgICAgIHNlcnZlcjogXCJCYXNlLUhlYWx0aHlcIixcbi8vICAgICAgICAgfSxcbi8vICAgICAgIH0pO1xuLy8gICAgIH0pO1xuXG4vLyAgICAgLyoqXG4vLyAgICAgICogSGFuZGxpbmcgYWxsIHVuZGVmaW5lZCByb3V0ZXNcbi8vICAgICAgKi9cbi8vICAgICB0aGlzLmFwcC5hbGwoXCIqXCIsIChyZXEsIHJlcykgPT4ge1xuLy8gICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuLy8gICAgICAgICBlcnJvcjogXCJSZXF1ZXN0ZWQgcm91dGUgZG9lc24ndCBleGlzdCAtIDQwNFwiLFxuLy8gICAgICAgICBkYXRhOiBudWxsLFxuLy8gICAgICAgfSk7XG4vLyAgICAgfSk7XG4vLyAgIH07XG5cbi8vICAgcHJpdmF0ZSBjb25maWd1cmVSZWRpcyA9ICgpID0+IHtcbi8vICAgICB0aGlzLmFwcC51c2UoXG4vLyAgICAgICBzZXNzaW9uKHtcbi8vICAgICAgICAgLi4uU0VTU0lPTl9PUFRJT05TLFxuLy8gICAgICAgICBzdG9yZTogbmV3IHRoaXMucmVkaXNTdG9yZSh7IGNsaWVudDogdGhpcy5yZWRpc0NsaWVudCB9KSxcbi8vICAgICAgIH0pLFxuLy8gICAgICk7XG4vLyAgIH07XG4vLyB9XG5cbi8vIGV4cG9ydCBkZWZhdWx0IEFwcDtcbiIsImltcG9ydCBleHByZXNzLCB7XG4gIEFwcGxpY2F0aW9uLFxuICBOZXh0RnVuY3Rpb24sXG4gIFJlcXVlc3QsXG4gIFJlc3BvbnNlLFxufSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IGNvcnMgZnJvbSBcImNvcnNcIjtcbmltcG9ydCBoZWxtZXQgZnJvbSBcImhlbG1ldFwiO1xuaW1wb3J0IG1vcmdhbiBmcm9tIFwibW9yZ2FuXCI7XG5pbXBvcnQgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHNlc3Npb24gZnJvbSBcImV4cHJlc3Mtc2Vzc2lvblwiO1xuaW1wb3J0IHsgTk9ERV9FTlYsIFBPUlQsIFNFU1NJT05fT1BUSU9OUyB9IGZyb20gXCIuL2NvbmZpZ1wiO1xuaW1wb3J0IENvbmZpZ3VyZVJlZGlzIGZyb20gXCIuL3NlcnZpY2VzL3JlZGlzL3JlZGlzLnNlcnZpY2VcIjtcbmltcG9ydCBBdXRoUm91dGUgZnJvbSBcIi4vcm91dGVzL2F1dGgvYXV0aC5yb3V0ZVwiO1xuaW1wb3J0IHsgR2VuZXJhbEFwaVJlc3BvbnNlIH0gZnJvbSBcIi4vaW50ZXJmYWNlc1wiO1xuXG5jbGFzcyBBcHAge1xuICBwcml2YXRlIGFwcDogQXBwbGljYXRpb247XG4gIHByaXZhdGUgcG9ydDogbnVtYmVyO1xuICBwcml2YXRlIGxvZ1BhdGg6IHN0cmluZyA9IHBhdGguam9pbihcbiAgICBfX2Rpcm5hbWUsXG4gICAgXCIuLlwiLFxuICAgIFwibG9nc1wiLFxuICAgIFwiYWNjZXNzLmxvZ1wiLFxuICApO1xuICBwcml2YXRlIHJlZGlzU3RvcmU7XG4gIHByaXZhdGUgdXNlckF1dGhSb3V0ZTtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5hcHAgPSBleHByZXNzKCk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICB0aGlzLnBvcnQgPSArUE9SVCEgfHwgNDAwMDtcblxuICAgIC8vY29uZmlndXJpbmcgcmVkaXMgYW5kIGZldGNoaW5nIHRoZSB2YWx1ZSBvZiByZWRpc1N0b3JlIHRoYXQgaXMgbmV3bHkgY29uZmlndXJlZCB3aXRoIGV4cHJlc3Mtc2Vzc2lvblxuICAgIHRoaXMucmVkaXNTdG9yZSA9IG5ldyBDb25maWd1cmVSZWRpcygpLnJlZGlzU3RvcmU7XG4gICAgdGhpcy51c2VyQXV0aFJvdXRlID0gbmV3IEF1dGhSb3V0ZSgpO1xuXG4gICAgdGhpcy5jb25maWd1cmVFeHByZXNzU2Vzc2lvbk1pZGRsZXdhcmUoKTsgLy9tdXN0IHJlbWFpbiBvbiBUT1BcbiAgICB0aGlzLmluaXRpYWxpemVNaWRkbGV3YXJlcygpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZVJvdXRlcygpO1xuICAgIHRoaXMuaGFuZGxlTWlzY1JvdXRlcygpO1xuICB9XG5cbiAgcHVibGljIGxpc3RlbiA9ICgpOiB2b2lkID0+IHtcbiAgICB0aGlzLmFwcC5saXN0ZW4odGhpcy5wb3J0LCAoKSA9PiB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgY29uc29sZS5sb2coYFNlcnZlciBpcyB1cCBvbiB0aGUgcG9ydDogJHt0aGlzLnBvcnR9YCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFRvIGhhbmRsZSBhbGwgbWlkZGxld2FyZS1yZWxhdGVkIHBhcnRzIC0gbWFraW5nIGl0IG1vZHVsYXIgdG8gbWFrZSBpdCBlYXNpZXIgdG8gdGVzdFxuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplTWlkZGxld2FyZXMgPSAoKTogdm9pZCA9PiB7XG4gICAgdGhpcy5hcHAudXNlKGNvcnMoKSk7XG4gICAgdGhpcy5hcHAudXNlKGV4cHJlc3MuanNvbigpKTtcblxuICAgIC8qKlxuICAgICAqIFNlY3VyaXR5IGhlYWRlcnMgdG8gYmUgYXR0YWNoZWQgd2l0aCByZXF1ZXN0c1xuICAgICAqL1xuICAgIHRoaXMuYXBwLnVzZShoZWxtZXQoKSk7XG5cbiAgICAvKipcbiAgICAgKiBGb3IgbG9nIHJlbGF0ZWQgc2VydmljZXMgLSBvbmx5IGZvciBkZXYgc2VydmVyXG4gICAgICovXG4gICAgaWYgKE5PREVfRU5WID09IFwiZGV2ZWxvcG1lbnRcIiB8fCBOT0RFX0VOViA9PSBcInRlc3RcIikge1xuICAgICAgY29uc3QgYWNjZXNzTG9nU3RyZWFtOiBmcy5Xcml0ZVN0cmVhbSA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKFxuICAgICAgICB0aGlzLmxvZ1BhdGgsXG4gICAgICAgIHtcbiAgICAgICAgICBmbGFnczogXCJhXCIsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgICAgdGhpcy5hcHAudXNlKFxuICAgICAgICBtb3JnYW4oXCJjb21tb25cIiwge1xuICAgICAgICAgIHN0cmVhbTogYWNjZXNzTG9nU3RyZWFtLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVJvdXRlcyA9ICgpOiB2b2lkID0+IHtcbiAgICB0aGlzLmFwcC51c2UoXCIvYXV0aFwiLCB0aGlzLnVzZXJBdXRoUm91dGUucm91dGVyKTtcbiAgfTtcblxuICBwcml2YXRlIGhhbmRsZU1pc2NSb3V0ZXMgPSAoKTogdm9pZCA9PiB7XG4gICAgLyoqXG4gICAgICogQmFzZSByb3V0ZSAtIHRvIGNoZWNrIEFQSSBoZWFsdGhcbiAgICAgKi9cbiAgICB0aGlzLmFwcC5nZXQoXCIvXCIsIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzZXJ2ZXI6IFwiQmFzZS1IZWFsdGh5XCIsXG4gICAgICAgIH0sXG4gICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGluZyBhbGwgdW5kZWZpbmVkIHJvdXRlc1xuICAgICAqL1xuICAgIHRoaXMuYXBwLmFsbChcIipcIiwgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBlcnJvcjogXCJSZXF1ZXN0ZWQgcm91dGUgZG9lc24ndCBleGlzdCAtIDQwNFwiLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgfSBhcyBHZW5lcmFsQXBpUmVzcG9uc2UpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5hcHAudXNlKFxuICAgICAgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBlcnJvcjogXCJTb21ldGhpbmcgYnJva2Ugb24gb3VyIGVuZCFcIixcbiAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICB9IGFzIEdlbmVyYWxBcGlSZXNwb25zZSk7XG4gICAgICB9LFxuICAgICk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyaW5nIGEgbWlkZGxld2FyZSBmb3IgZXhwcmVzcyBzZXNzaW9uIHRvIHdvcmsgd2l0aCByZWRpcyBjYWNoZVxuICAgKi9cbiAgcHJpdmF0ZSBjb25maWd1cmVFeHByZXNzU2Vzc2lvbk1pZGRsZXdhcmUgPSAoKTogdm9pZCA9PiB7XG4gICAgdGhpcy5hcHAudXNlKFxuICAgICAgc2Vzc2lvbih7XG4gICAgICAgIC4uLlNFU1NJT05fT1BUSU9OUyxcblxuICAgICAgICAvL21ha2luZyB1c2Ugb2YgcmVkaXNTdG9yZSBpbnN0YW50aWF0ZWQgZnJvbSBjYWNoZSBzZXJ2aWNlXG4gICAgICAgIHN0b3JlOiB0aGlzLnJlZGlzU3RvcmUsXG4gICAgICB9KSxcbiAgICApO1xuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBBcHA7XG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZSIsImdldHRlciIsIl9fZXNNb2R1bGUiLCJkIiwiYSIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyZXF1aXJlIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1BPUlQiLCJSRURJU19IT1NUIiwiUkVESVNfUEFTU1dPUkQiLCJSRURJU19PUFRJT05TIiwicG9ydCIsImhvc3QiLCJwYXNzd29yZCIsIlBPU1RHUkVTUUxfVVNFUiIsIlBPU1RHUkVTUUxfUEFTU1dPUkQiLCJQT1NUR1JFU1FMX1BPUlQiLCJQT1NUR1JFU1FMX0hPU1QiLCJEQVRBQkFTRV9VUkwiLCJTRVNTSU9OX1NFQ1JFVCIsIlNFU1NJT05fTkFNRSIsIlNFU1NJT05fVElNRU9VVCIsIlNFU1NJT05fT1BUSU9OUyIsInNlY3JldCIsIm5hbWUiLCJjb29raWUiLCJtYXhBZ2UiLCJzZWN1cmUiLCJyZXNhdmUiLCJzYXZlVW5pbml0aWFsaXplZCIsInJvbGxpbmciLCJQT1JUIiwiY29uZmlnIiwiQ29uZmlndXJlUmVkaXMiLCJ0aGlzIiwiUmVkaXNTdG9yZSIsImNvbm5lY3RSZWRpcyIsInNlc3Npb24iLCJyZWRpc0NsaWVudCIsIlJlZGlzIiwib24iLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJjbGllbnQiLCJpIiwiQXV0aFNlcnZpY2UiLCJnZW5TYWx0Iiwic2FsdCIsImhhc2giLCJoYXNoZWRQYXNzd29yZCIsInVzZXJQYXNzd29yZCIsImRiUGFzc3dvcmQiLCJjb21wYXJlIiwiZW1haWwiLCJpbmNsdWRlU2hvcnRjdXRzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwcmlzbWEiLCJ1c2VyIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiaW5jbHVkZSIsInNob3J0Y3V0cyIsImRhdGEiLCJnZXRVc2VyRnJvbUVtYWlsIiwiY29kZSIsImVuY3J5cHRQYXNzd29yZCIsImNyZWF0ZSIsImlkIiwiY29tcGFyZVBhc3N3b3JkIiwidXNlcldpdGhvdXRQYXNzd29yZCIsIlByaXNtYUNsaWVudCIsIkF1dGhDb250cm9sbGVyIiwidXNlclJlZ2lzdHJhdGlvbkRhdGEiLCJKb2kiLCJtaW4iLCJtYXgiLCJ0cmltIiwicmVxdWlyZWQiLCJ2YWxpZGF0ZSIsInJlcSIsIm9zbGFzaEJlVXNlcklkIiwicmVzIiwiYm9keSIsInZhbGlkYXRpb25FcnJvciIsInZhbGlkYXRlUmVnaXN0cmF0aW9uRGF0YSIsImF1dGhTZXJ2aWNlIiwicmVnaXN0ZXIiLCJsb2dpblVzZXJCeVBlcnNpc3RpbmdDYWNoZSIsInN0YXR1cyIsImpzb24iLCJ1c2VySWQiLCJtZXNzYWdlIiwidXNlckxvZ2luRGF0YSIsInZhbGlkYXRlTG9naW5EYXRhIiwibG9naW4iLCJkZXN0cm95IiwiZXJyIiwiY2xlYXJDb29raWUiLCJpc0xvZ2dlZEluIiwibmV4dCIsIm5vdExvZ2dlZEluIiwiQXV0aFJvdXRlIiwicm91dGVyIiwicGF0aCIsInBvc3QiLCJhdXRoQ29udHJvbGxlciIsImxvZ291dCIsIlJvdXRlciIsImluaXRpYWxpemVSb3V0ZSIsIkFwcCIsIl9fZGlybmFtZSIsImFwcCIsImxpc3RlbiIsInVzZSIsImNvcnMiLCJleHByZXNzIiwiaGVsbWV0IiwidXNlckF1dGhSb3V0ZSIsInNlcnZlciIsImFsbCIsInN0b3JlIiwicmVkaXNTdG9yZSIsImNvbmZpZ3VyZUV4cHJlc3NTZXNzaW9uTWlkZGxld2FyZSIsImluaXRpYWxpemVNaWRkbGV3YXJlcyIsImluaXRpYWxpemVSb3V0ZXMiLCJoYW5kbGVNaXNjUm91dGVzIl0sInNvdXJjZVJvb3QiOiIifQ==